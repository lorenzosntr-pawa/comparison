# Milestone v1.9: Event Details UX

**Status:** SHIPPED 2026-02-05
**Phases:** 48-52
**Total Plans:** 10 (5 original + 5 FIX plans)

## Overview

Transform the event details page into a powerful market exploration tool with filtering, grouping, and actionable summary metrics. Added tabbed market navigation using BetPawa's category taxonomy, fuzzy search, competitor comparison mode, sticky navigation, and polished empty states.

## Phases

### Phase 48: Event Summary Redesign

**Goal**: Replace current summary with useful metrics - market counts per bookmaker, mapping success rate, best odds indicators
**Depends on**: Previous milestone complete
**Plans**: 1 plan + 2 FIX plans

Plans:

- [x] 48-01: Redesign summary section with Market Coverage, Mapping Quality, and categorized Best Odds
- [x] 48-01-FIX: Fix 5 UAT issues (market count accuracy, typography, Key Markets card removal)
- [x] 48-01-FIX2: Apply market deduplication to summary-section counts

**Details:**
- Added "Market Coverage" card showing market count per bookmaker with color-coded bars
- Added "Mapping Quality" card showing total matched competitor markets with badges
- Added "Competitive Position" with category breakdown (Popular/Goals/Handicaps/Other)
- Fixed Betpawa market count to only count markets with actual odds
- Applied market deduplication logic consistent with market-grid
- Changed to 3-column layout after removing Key Markets card

### Phase 49: Market Grouping System

**Goal**: Organize markets using Betpawa's group categories (Main, Goals, Corners, etc.) with tabbed navigation
**Depends on**: Phase 48
**Plans**: 1 plan + 2 FIX plans

Plans:

- [x] 49-01: Tabbed market view with category grouping
- [x] 49-01-FIX: Fix missing market category tabs (popular, combos, specials)
- [x] 49-01-FIX2: Change market_group to market_groups JSON array for multi-tab support

**Details:**
- Added `market_groups` column (JSON array) to MarketOdds and CompetitorMarketOdds
- Extract all non-"all" tabs from BetPawa tabs array during scraping
- Created tabbed navigation with pill-style buttons and market count badges
- Markets appear in ALL their category tabs (not just primary)
- Unknown groups handled dynamically (inserted alphabetically before "other")

### Phase 50: Market Filtering

**Goal**: Filter markets by bookmaker, competitor selector to choose comparison target, text search to find markets by name
**Depends on**: Phase 49
**Plans**: 1 plan

Plans:

- [x] 50-01: Market filter bar with fuzzy search and competitor selector

**Details:**
- Created MarketFilterBar component with search input and competitor dropdown
- Implemented fuzzy subsequence matching (e.g., "o25" matches "Over 2.5 Goals")
- Dynamic column reordering - selected competitor moves adjacent to Betpawa
- Search, competitor filter, and tab filtering work together

### Phase 51: Navigation UX

**Goal**: Sticky header/filters that stay visible while scrolling, quick jump navigation to specific market groups
**Depends on**: Phase 50
**Plans**: 1 plan + 1 FIX plan

Plans:

- [x] 51-01: Sticky navigation and scroll-to-top button
- [x] 51-01-FIX: Fix scroll container targeting (5 UAT issues resolved)

**Details:**
- Sticky navigation header using fixed positioning (CSS sticky doesn't work with overflow containers)
- Scroll-to-top floating button appears after scrolling 400px
- Placeholder div prevents layout shift when header becomes fixed
- Fixed root cause: scroll listener was targeting wrong element (outer SidebarInset instead of inner main)
- Added `data-scroll-container` attribute for reliable scroll element targeting

### Phase 52: Polish & Integration

**Goal**: Ensure all features work together smoothly, edge cases handled, UX polish
**Depends on**: Phase 51
**Plans**: 1 plan

Plans:

- [x] 52-01: Extract shared utilities, align summary categories with tabs, improve empty states

**Details:**
- Created `lib/market-utils.ts` with shared `mergeMarketOutcomes`, `buildDeduplicatedMarkets`, `marketHasOdds`
- Eliminated ~80 lines of duplicated code between market-grid and summary-section
- Summary categories now use actual `market_groups` from data (not keyword heuristics)
- Added context-aware empty state messages based on active filters
- Added clear button (X) to search input

---

## Milestone Summary

**Key Decisions:**

- Market group from BetPawa tabs: Extract non-"all" tabs as market categories (accurate grouping)
- Multi-group JSON array: Store all tabs for multi-category membership
- Fuzzy subsequence matching: Query chars in order for intuitive partial matching
- Dynamic column reordering: Selected competitor adjacent to Betpawa
- Fixed positioning over CSS sticky: Works with overflow containers
- data-scroll-container attribute: Reliable scroll element targeting in nested layouts
- Shared market utilities module: Eliminated ~80 lines of duplication
- Categories from data not heuristics: Perfect alignment between summary and tabs

**Issues Resolved:**

- 48-01 UAT: Market count accuracy, typography consistency, Key Markets card removal
- 48-01 UAT: Market deduplication consistency between summary and grid
- 49-01 UAT: Missing market category tabs (popular, combos, specials)
- 49-01 UAT: Markets only appearing in primary tab (changed to multi-group arrays)
- 51-01 UAT: Scroll container targeting wrong element (5 issues: sticky header, scroll-to-top, button position, layout shift, shadow)

**Issues Deferred:**

- ISS-002: Comprehensive market mapping still open (enhancement, large effort)

**Technical Debt Incurred:**

- None significant

---

_For current project status, see .planning/ROADMAP.md_
