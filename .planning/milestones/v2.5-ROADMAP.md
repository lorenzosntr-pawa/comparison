# Milestone v2.5: Odds Availability Tracking

**Status:** SHIPPED 2026-02-11
**Phases:** 87-92
**Total Plans:** 6

## Overview

Track when odds/events become unavailable across platforms, display appropriately with strikethrough styling and tooltips, and visualize availability transitions in history charts.

## Phases

### Phase 87: Investigation & Schema Design

**Goal**: Analyze current data flow and design availability storage approach
**Depends on**: v2.4 complete
**Plans**: 1 plan

Plans:
- [x] 87-01: Investigate patterns and design schema

**Details:**
Discovered markets disappear over time (15-56% presence). Designed unavailable_at timestamp approach with cache-level detection. Selected Option B: nullable timestamp column on MarketOdds tables.

### Phase 88: Backend Availability Tracking

**Goal**: Implement detection logic in scraping pipeline, storage with `unavailable_at` timestamp
**Depends on**: Phase 87
**Plans**: 1 plan

Plans:
- [x] 88-01: Schema, cache, and detection integration

**Details:**
Created Alembic migration adding `unavailable_at` column, updated ORM models, added `unavailable_at` field to CachedMarket with `is_available` property, created availability_detection.py module, integrated into EventCoordinator.

### Phase 89: API & Cache Changes

**Goal**: Add availability state to API responses and cache updates
**Depends on**: Phase 88
**Plans**: 1 plan

Plans:
- [x] 89-01: API availability endpoints

**Details:**
Added `available: bool = True` and `unavailable_since: datetime | None = None` to InlineOdds and MarketOddsDetail schemas. Updated all 4 API response builders to extract and pass availability data.

### Phase 90: Odds Comparison UI

**Goal**: Strikethrough styling, "Unavailable since X" tooltips, dash for never_offered
**Depends on**: Phase 89
**Plans**: 1 plan

Plans:
- [x] 90-01: OddsValue availability styling

**Details:**
Three-state availability rendering: available (normal odds), unavailable (strikethrough dash + tooltip), never_offered (plain dash). Created formatUnavailableSince() and getMarketAvailabilityState() utilities.

### Phase 91: Event Details UI

**Goal**: Same styling applied to Event Details page for consistency
**Depends on**: Phase 90
**Plans**: 1 plan

Plans:
- [x] 91-01: OddsBadge availability styling

**Details:**
Extended OddsBadge to handle availability props with Tooltip. Updated MarketRow to extract and propagate availability data. Wrapped MarketGrid with TooltipProvider.

### Phase 92: History Charts

**Goal**: Dotted/dashed lines for unavailable periods, availability transitions in dialog
**Depends on**: Phase 91
**Plans**: 1 plan

Plans:
- [x] 92-01: History charts availability visualization

**Details:**
Added `available` and `unavailable_at` fields to OddsHistoryPoint and MarginHistoryPoint schemas. Created splitByAvailability helper for dual-line rendering. Dashed lines (strokeDasharray="5 5") for unavailable periods. Tooltip shows "(unavailable)" suffix.

---

## Milestone Summary

**Decimal Phases:**
- None

**Key Decisions:**
- Decision: Option B unavailable_at timestamp (Rationale: Timestamp tells us WHEN, enables tooltips)
- Decision: Detection at cache layer (Rationale: Compare previous cache to new scrape)
- Decision: UI distinction dash vs strikethrough (Rationale: Differentiate never_offered from became_unavailable)
- Decision: Dashed overlay line approach (Rationale: Simpler than gradient masking, no SVG complexity)

**Issues Resolved:**
- None (clean implementation)

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- None

---

_For current project status, see .planning/ROADMAP.md_
