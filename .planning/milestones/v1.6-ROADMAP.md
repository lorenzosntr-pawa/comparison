# Milestone v1.6: Event Matching Accuracy

**Status:** ✅ SHIPPED 2026-01-29
**Phases:** 34-35 (including decimal 34.1)
**Total Plans:** 3

## Overview

Fix SportRadar ID-based event matching across Sporty, Betpawa, and Bet9ja — investigation report first, then targeted fixes. Audit revealed system was 99.9% accurate; issues were in API query layer, not matching logic.

## Phases

### Phase 34: Investigation & Matching Audit Report

**Goal**: Deep dive into SportRadar ID extraction and matching pipeline, produce findings document identifying specific bugs
**Depends on**: Previous milestone complete
**Plans**: 1 plan

Plans:
- [x] 34-01: Code audit + SQL diagnostics + findings report

**Details:**
- Audited ID extraction code for all 3 platforms (BetPawa, SportyBet, Bet9ja)
- Ran comprehensive SQL diagnostics on 5,333 competitor events
- Discovered matching is 99.9% accurate (2,350/2,352 Bet9ja, 1,668/1,668 SportyBet)
- Identified root cause of 2 unlinked events (timing: scraped before BetPawa existed)
- Closed 4 out of 5 hypothesized bugs as non-issues
- Created AUDIT-FINDINGS.md with 450 lines of SQL evidence

### Phase 34.1: API/UI Data Flow Audit (INSERTED)

**Goal**: Investigate why frontend shows incorrect/stale data despite healthy backend matching (99.9% accuracy)
**Depends on**: Phase 34
**Plans**: 1 plan
**Trigger**: UAT of Phase 34 revealed frontend displays bad data while backend is healthy

Plans:
- [x] 34.1-01: Trace data flow from DB → API → Frontend, identify where accuracy degrades

**Details:**
- Audited `/events` and `/palimpsest` API endpoints with SQL query verification
- Identified API-001: `/palimpsest/coverage` inflates competitor_only_count by 92% (254 vs 132)
- Identified API-002: Event detail uses legacy odds system (506 events vs 2400+ in new system)
- Confirmed frontend has no bugs - UI correctly displays what API provides
- Resolved UAT-001 root cause

### Phase 35: Apply Remediation Query

**Goal**: Fix 2 timing-affected events with one-time SQL query, optionally add periodic re-matching job
**Depends on**: Phase 34
**Scope**: Minimal — audit found only 2 events affected (not major rework)
**Plans**: 1 plan

Plans:
- [x] 35-01: Coverage stats fix (API-001) + timing remediation SQL

**Details:**
- Fixed API-001: Coverage stats now use `COUNT(DISTINCT sportradar_id)` instead of raw row count
- Reduced competitor_only_count from 252 to 131 (was 92% inflated)
- Match rate now accurate at 83.86% (was incorrectly showing ~75%)
- Remediated 2 timing-affected orphaned events with one-time SQL
- 0 matchable events remain unlinked

---

## Milestone Summary

**Decimal Phases:**

- Phase 34.1: API/UI Data Flow Audit (inserted after Phase 34 for urgent UAT issue)

**Key Decisions:**

- The event matching system is healthy — 99.9% accurate, no refactoring needed
- 23-26% unmatched rate is correct behavior (competitor-only events that BetPawa doesn't offer)
- API bugs identified, not frontend issues — UI correctly displays what API provides
- One-time SQL fix for timing-affected events (not a migration or periodic job)

**Issues Resolved:**

- API-001: Coverage count inflation fixed with DISTINCT SR ID counting
- 2 timing-orphaned events linked to BetPawa events
- UAT-001: Root cause traced to API layer, not frontend

**Issues Deferred:**

- API-002: Event detail uses legacy odds architecture — deferred to future milestone

**Technical Debt Incurred:**

- None — all fixes were clean implementations

---

_For current project status, see .planning/ROADMAP.md_
