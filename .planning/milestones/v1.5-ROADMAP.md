# Milestone v1.5: Scraping Observability

**Status:** âœ… SHIPPED 2026-01-28
**Phases:** 31-33.1
**Total Plans:** 4

## Overview

Make scraping progress transparent, failures visible, and stale runs impossible. Added backend watchdog for hung scrapes, connection loss detection with auto-recovery, per-platform progress events with real counts and timing, and fixed scheduler interval display.

## Phases

### Phase 31: Backend Heartbeat & Stale Run Detection

**Goal**: Background monitor that auto-fails hung scrapes stuck in RUNNING status
**Depends on**: Previous milestone complete
**Plans**: 1 plan

Plans:
- [x] 31-01: Backend Heartbeat & Stale Run Detection (2026-01-27)

**Details:**
- Created `stale_detection.py` module with configurable timeout threshold
- Registered `detect_stale_runs` APScheduler job running every 2 minutes
- Auto-transitions RUNNING runs exceeding timeout to FAILED status
- Startup recovery hook marks any leftover RUNNING runs as FAILED on server boot
- Broadcaster cleanup for stale run SSE connections

### Phase 32: Connection Loss Logging

**Goal**: Frontend SSE disconnect detection, logging, and failed-state recovery
**Depends on**: Phase 31
**Plans**: 1 plan

Plans:
- [x] 32-01: Connection Loss Logging (2026-01-27)

**Details:**
- Added CONNECTION_FAILED status to scrape run model
- Backend detects SSE client disconnect and marks run with connection_failed status
- Frontend displays connection_failed status with distinct UI treatment
- Auto-rescrape triggered on page reload when connection_failed run detected

### Phase 33: Detailed Per-Platform Progress Messages

**Goal**: Enrich orchestrator progress events with real counts and timing per bookmaker
**Depends on**: Phase 32
**Plans**: 1 plan

Plans:
- [x] 33-01: Per-Platform Progress Events (2026-01-28)

**Details:**
- Backend emits per-platform progress events with event counts and elapsed time
- Frontend displays per-bookmaker sub-steps in live progress UI
- Shows which bookmaker is active, how many events found, and duration
- Fixed SSE stream closing prematurely on per-platform completion

### Phase 33.1: Fix Scheduler Interval Display (INSERTED)

**Goal**: Fix job ID mismatch causing scheduler UI to show 2-minute watchdog interval instead of actual scrape interval
**Depends on**: Phase 33
**Plans**: 1 plan

Plans:
- [x] 33.1-01: Fix Scheduler Interval Display (2026-01-28)

**Details:**
- Frontend referenced stale job ID `'scrape_odds'` instead of `'scrape_all_platforms'`
- `jobs[0]` index resolved to wrong job (watchdog instead of scrape)
- Fixed job ID references in scheduler-control.tsx and recent-runs.tsx
- Scheduler control and recent runs now display correct scrape interval from settings

---

## Milestone Summary

**Decimal Phases:**
- Phase 33.1: Fix Scheduler Interval Display (inserted after Phase 33 for ISS-003 bug fix)

**Key Decisions:**
- 2-minute watchdog interval for stale detection (balance between responsiveness and overhead)
- CONNECTION_FAILED as distinct status (not reusing FAILED, enables different UI treatment)
- Auto-rescrape on recovery (user doesn't need to manually retry)
- Per-platform events via existing SSE infrastructure (no WebSocket needed)

**Issues Resolved:**
- ISS-003: Scheduler interval display showing watchdog interval instead of scrape interval
- Stale runs stuck in RUNNING status after crashes/disconnects
- SSE stream closing prematurely on per-platform completion

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- None significant

---

_For current project status, see .planning/ROADMAP.md_
