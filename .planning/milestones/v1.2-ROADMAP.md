# Milestone v1.2: Settings & Retention

**Status:** âœ… SHIPPED 2026-01-26
**Phases:** 19.1-22
**Total Plans:** 8

## Overview

Persistent configuration that survives page refresh/server restart with configurable history retention and automatic data cleanup.

## Phases

### Phase 19.1: Fix Sidebar Menu (INSERTED)

**Goal**: Fix sidebar overlay behavior for desktop
**Depends on**: Phase 19
**Plans**: 1 plan

Plans:
- [x] 19.1-01: Sidebar overlay with backdrop

**Details:**
- Desktop sidebar now overlays content with backdrop dimming
- Clicking backdrop closes sidebar
- Uses offcanvas mode instead of icon mode
- Smooth opacity transition on backdrop

### Phase 20: Settings Schema & API

**Goal**: Add history retention setting to existing settings infrastructure
**Depends on**: Previous milestone complete
**Plans**: 1 plan

Plans:
- [x] 20-01: Add history_retention_days setting

**Details:**
- Added history_retention_days column to Settings model (default 7)
- Created Alembic migration for the column
- Extended Pydantic schemas with validation (1-90 days)
- Updated settings API routes

### Phase 21: Settings Persistence Integration

**Goal**: Replace in-memory/hardcoded values with database reads
**Depends on**: Phase 20
**Plans**: 1 plan

Plans:
- [x] 21-01: Sync settings from DB at startup

**Details:**
- Scheduler syncs interval from DB at startup
- sync_settings_on_startup() function in app lifespan
- Frontend types updated with historyRetentionDays

### Phase 22: History Retention

**Goal**: Configurable data retention policy and cleanup job
**Depends on**: Phase 21
**Plans**: 5 plans

Plans:
- [x] 22-01: Retention settings model and schemas
- [x] 22-02: Cleanup service and run history
- [x] 22-03: Cleanup scheduler and API endpoints
- [x] 22-04: Settings UI redesign
- [x] 22-05: Manage Data dialog

**Details:**
- Retention settings: enabled, days, last_cleanup_at
- CleanupService with get_stats, preview_cleanup, execute_cleanup
- CleanupRun model tracking cleanup history
- Cleanup scheduler job running daily at 2 AM UTC
- API endpoints: GET /cleanup/stats, POST /cleanup/preview, POST /cleanup/execute, GET /cleanup/history
- Settings UI redesigned to compact 4-row grid layout
- Manage Data dialog with Overview, Cleanup, and History tabs

---

## Milestone Summary

**Decimal Phases:**
- Phase 19.1: Fix Sidebar Menu (inserted after Phase 19 for urgent UX fix)

**Key Decisions:**
- Default retention of 7 days for frequently changing odds data
- Validation range 1-90 days to prevent extremes
- Sync settings after start_scheduler() not before
- Preview-before-delete pattern for destructive operations
- Tabbed dialog for complex data management

**Issues Resolved:**
- Sidebar menu overlaying content without backdrop fixed
- Settings not persisting across server restarts fixed
- No way to manage historical data fixed

**Issues Deferred:**
- WebSocket real-time updates (removed from v1.2 scope)
- Silent retry on scraper failures
- Historical trend visualization UI

**Technical Debt Incurred:**
- None significant

---

_For current project status, see .planning/ROADMAP.md_
