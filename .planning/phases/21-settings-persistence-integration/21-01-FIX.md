---
phase: 21-settings-persistence-integration
plan: 01-FIX
type: fix
---

<objective>
Fix 1 UAT issue from plan 21-01.

Source: 21-01-ISSUES.md
Priority: 1 blocker, 0 major, 0 minor
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

**Issues being fixed:**
@.planning/phases/21-settings-persistence-integration/21-01-ISSUES.md

**Original plan for reference:**
@.planning/phases/21-settings-persistence-integration/21-01-PLAN.md

**Root cause:**
Phase 20 created migration `a7b3c1d4e8f2_add_history_retention_setting.py` but it was never applied to the database. The Phase 20 summary explicitly noted: "Migration needs to be applied when database is available: `alembic upgrade head`"

**Migration file:**
@alembic/versions/a7b3c1d4e8f2_add_history_retention_setting.py
</context>

<tasks>

<task type="auto">
  <name>Fix UAT-001: Apply pending history_retention_days migration</name>
  <files>Database schema (no code changes)</files>
  <action>
Run the pending Alembic migration to add the history_retention_days column:

```bash
alembic upgrade head
```

This will apply migration a7b3c1d4e8f2 which adds:
- `history_retention_days` column to settings table
- Server default of 7 days

No code changes needed - the migration already exists from Phase 20.
  </action>
  <verify>
1. Migration completes without errors
2. Database has the column: `SELECT history_retention_days FROM settings;`
3. Server starts without "column does not exist" error
4. GET /api/settings returns historyRetentionDays field
  </verify>
  <done>Database schema matches model, server starts cleanly, settings API works</done>
</task>

</tasks>

<verification>
Before declaring fix complete:
- [ ] Alembic migration applied successfully
- [ ] Server starts without column errors
- [ ] sync_settings_on_startup() works (check logs)
- [ ] GET /api/settings returns all fields including historyRetentionDays
</verification>

<success_criteria>
- UAT-001 resolved (database column exists)
- Server starts without errors
- Settings persistence works as designed
- Ready for re-verification
</success_criteria>

<output>
After completion, create `.planning/phases/21-settings-persistence-integration/21-01-FIX-SUMMARY.md`
</output>
