---
phase: 94-coverage-page
plan: 01
type: execute
---

<objective>
Improve Coverage page UX with stable summary cards, pagination, and navigation shortcuts.

Purpose: Make Coverage page more usable with consistent metrics, manageable tournament lists, and quick navigation to related pages.
Output: Enhanced Coverage page with stable stats, paginated tournament table, and clickable navigation.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Key files:**
@web/src/features/coverage/index.tsx
@web/src/features/coverage/components/tournament-stats-cards.tsx
@web/src/features/coverage/components/tournament-table.tsx
@web/src/features/coverage/components/event-rows.tsx

**Routes for navigation:**
- `/odds-comparison/:id` - Event detail page
- `/historical-analysis/:tournamentId` - Tournament historical analysis

**Established patterns:**
- useNavigate from react-router for programmatic navigation
- Button with ghost variant for action icons
- lucide-react icons (ExternalLink, BarChart2, ChevronLeft, ChevronRight)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Stable Tournament Summary Cards</name>
  <files>web/src/features/coverage/index.tsx</files>
  <action>
Change TournamentStatsCards to receive ALL tournaments (unfiltered) instead of filteredTournaments.

Current code passes filteredTournaments which changes when country filter is applied:
```tsx
<TournamentStatsCards
  tournaments={filteredTournaments}
  isLoading={eventsPending}
/>
```

Change to:
```tsx
<TournamentStatsCards
  tournaments={eventsData?.tournaments ?? []}
  isLoading={eventsPending}
/>
```

This makes the tournament summary cards (Total Tournaments, Matched, BetPawa Only, SportyBet Gaps, Bet9ja Gaps) show consistent values regardless of country filter selection.

The filtered tournament count already shows in the header as "X events in Y countries" so users still see the filtered context.
  </action>
  <verify>
1. Build passes: `cd web && npm run build`
2. Load Coverage page, observe Tournament summary cards show totals
3. Apply country filter, verify Tournament summary cards do NOT change
4. Verify event count in header still updates with filter
  </verify>
  <done>TournamentStatsCards shows stable totals, unaffected by country filter</done>
</task>

<task type="auto">
  <name>Task 2: Add Tournament Table Pagination</name>
  <files>web/src/features/coverage/components/tournament-table.tsx</files>
  <action>
Add client-side pagination to TournamentTable with 15 tournaments per page.

1. Add state for current page: `const [currentPage, setCurrentPage] = useState(1)`
2. Define PAGE_SIZE constant: `const PAGE_SIZE = 15`
3. Calculate paginated tournaments:
```tsx
const totalPages = Math.ceil(tournaments.length / PAGE_SIZE)
const paginatedTournaments = tournaments.slice(
  (currentPage - 1) * PAGE_SIZE,
  currentPage * PAGE_SIZE
)
```

4. Reset to page 1 when tournaments array changes (use useEffect):
```tsx
useEffect(() => {
  setCurrentPage(1)
}, [tournaments.length])
```

5. Replace `tournaments.map` with `paginatedTournaments.map` in render

6. Add pagination controls below the table (before closing div):
```tsx
{totalPages > 1 && (
  <div className="flex items-center justify-between px-4 py-3 border-t">
    <span className="text-sm text-muted-foreground">
      Page {currentPage} of {totalPages} ({tournaments.length} tournaments)
    </span>
    <div className="flex gap-2">
      <Button
        variant="outline"
        size="sm"
        onClick={() => setCurrentPage((p) => Math.max(1, p - 1))}
        disabled={currentPage === 1}
      >
        <ChevronLeft className="h-4 w-4 mr-1" />
        Previous
      </Button>
      <Button
        variant="outline"
        size="sm"
        onClick={() => setCurrentPage((p) => Math.min(totalPages, p + 1))}
        disabled={currentPage === totalPages}
      >
        Next
        <ChevronRight className="h-4 w-4 ml-1" />
      </Button>
    </div>
  </div>
)}
```

7. Add imports: `useState, useEffect` from react, `Button` from @/components/ui/button, `ChevronLeft, ChevronRight` from lucide-react
  </action>
  <verify>
1. Build passes: `cd web && npm run build`
2. Load Coverage page with many tournaments
3. Verify only 15 tournaments shown per page
4. Verify pagination controls appear when > 15 tournaments
5. Verify Previous/Next buttons work correctly
6. Verify page resets to 1 when changing filters
7. Verify expanded tournaments stay expanded on same page
  </verify>
  <done>Tournament table shows 15 per page with working pagination controls</done>
</task>

<task type="auto">
  <name>Task 3: Add Navigation Shortcuts</name>
  <files>web/src/features/coverage/components/event-rows.tsx, web/src/features/coverage/components/tournament-table.tsx</files>
  <action>
Add clickable navigation to event detail and tournament historical analysis.

**Part A: Event Rows → Odds Comparison**

In event-rows.tsx:
1. Add import: `import { useNavigate } from 'react-router'`
2. Add navigate hook inside component: `const navigate = useNavigate()`
3. Add ExternalLink icon import: `import { Check, X, ExternalLink } from 'lucide-react'`
4. Make each event row clickable with cursor-pointer
5. Add onClick handler to navigate to event detail: `onClick={() => navigate(`/odds-comparison/${event.id}`)}`
6. Add visual indicator icon in the last TableCell (currently empty):
```tsx
<TableCell className="text-right pr-4">
  <ExternalLink className="h-3.5 w-3.5 text-muted-foreground" />
</TableCell>
```

**Part B: Tournament Rows → Historical Analysis**

In tournament-table.tsx:
1. Add import: `import { useNavigate } from 'react-router'`
2. Add navigate hook inside component: `const navigate = useNavigate()`
3. Add BarChart2 icon import from lucide-react
4. Add a new Actions column header: `<TableHead className="w-[80px]">Actions</TableHead>`
5. Add action button in tournament row (after Total cell, inside the row but before EventRows):
```tsx
<TableCell className="text-center">
  <Button
    variant="ghost"
    size="sm"
    className="h-7 px-2"
    onClick={(e) => {
      e.stopPropagation()
      navigate(`/historical-analysis/${tournament.tournament_id}`)
    }}
    title="View historical analysis"
  >
    <BarChart2 className="h-4 w-4" />
  </Button>
</TableCell>
```
6. Add empty TableCell in skeleton loading rows for the Actions column
7. Add empty TableCell in EventRows for the Actions column alignment

The stopPropagation prevents the tournament row click (expand/collapse) from firing.
  </action>
  <verify>
1. Build passes: `cd web && npm run build`
2. Load Coverage page, expand a tournament
3. Click an event row → navigates to /odds-comparison/:id
4. Click chart icon on tournament row → navigates to /historical-analysis/:tournamentId
5. Verify tournament expand/collapse still works when clicking elsewhere on row
  </verify>
  <done>Events navigate to odds comparison, tournaments have historical analysis button</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `cd web && npm run build` succeeds without errors
- [ ] Tournament stats cards show stable totals (unaffected by filters)
- [ ] Pagination works with > 15 tournaments
- [ ] Event rows navigate to odds comparison on click
- [ ] Tournament rows have working historical analysis button
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Coverage page is more usable with stable metrics, pagination, and navigation
  </success_criteria>

<output>
After completion, create `.planning/phases/94-coverage-page/94-01-SUMMARY.md`:

# Phase 94-01: Coverage Page Improvements Summary

**[Substantive one-liner]**

## Accomplishments

- [Key outcomes]

## Files Created/Modified

- `file` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

[Ready for Phase 95 or note any blockers]
</output>
