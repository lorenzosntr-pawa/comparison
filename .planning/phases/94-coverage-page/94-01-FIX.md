---
phase: 94-coverage-page
plan: 94-01-FIX
type: fix
---

<objective>
Fix 2 UAT issues from plan 94-01.

Source: 94-01-ISSUES.md
Priority: 0 critical, 1 major, 1 minor
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

**Issues being fixed:**
@.planning/phases/94-coverage-page/94-01-ISSUES.md

**Original plan for reference:**
@.planning/phases/94-coverage-page/94-01-PLAN.md

**Key files:**
@web/src/features/coverage/index.tsx
@web/src/features/coverage/components/tournament-stats-cards.tsx
@web/src/features/coverage/components/tournament-table.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix UAT-001 - Stable Tournament Summary Cards</name>
  <files>web/src/features/coverage/index.tsx</files>
  <action>
Investigate and fix why TournamentStatsCards values change when country filter is applied.

**Root cause investigation:**
The code currently passes `eventsData?.tournaments ?? []` to TournamentStatsCards. This should be stable. However, possible issues:
1. The `?? []` creates new array reference every render when eventsData is undefined during loading
2. React Query may be re-fetching causing tournaments to change temporarily

**Fix approach:**
1. Create a stable reference for all tournaments using useMemo:
```tsx
const allTournaments = useMemo(
  () => eventsData?.tournaments ?? [],
  [eventsData?.tournaments]
)
```

2. Pass `allTournaments` to TournamentStatsCards instead of inline `eventsData?.tournaments ?? []`

3. Verify the component only re-renders when the actual data changes, not when filters change
  </action>
  <verify>
1. Build passes: `cd web && npm run build`
2. Load Coverage page, note summary card values
3. Apply country filter (e.g., Nigeria only)
4. Verify summary card values remain exactly the same
5. Clear filter, verify cards still show same totals
  </verify>
  <done>Summary cards show stable values unaffected by country filter selection</done>
</task>

<task type="auto">
  <name>Task 2: Fix UAT-002 - Bookmaker Column Alignment</name>
  <files>web/src/features/coverage/components/tournament-table.tsx</files>
  <action>
Fix the visual alignment of bookmaker column values in the tournament table.

**Root cause:**
The PlatformCell component renders different widths depending on whether count > 0:
- With count: Check icon + number (variable width based on digits)
- Without count: Just X icon (narrower)

This causes misalignment between rows.

**Fix approach:**
1. Update PlatformCell to use consistent centering with `justify-center`:
```tsx
function PlatformCell({ count }: { count: number }) {
  if (count > 0) {
    return (
      <div className="flex items-center justify-center gap-1 text-green-600">
        <Check className="h-4 w-4" />
        <span className="text-sm font-medium tabular-nums">{count}</span>
      </div>
    )
  }

  return (
    <div className="flex items-center justify-center text-orange-500">
      <X className="h-4 w-4" />
    </div>
  )
}
```

2. Add `tabular-nums` class to ensure consistent number width
3. Ensure the TableCell uses consistent centering
  </action>
  <verify>
1. Build passes: `cd web && npm run build`
2. Load Coverage page
3. Visual inspection: All bookmaker columns (BetPawa, SportyBet, Bet9ja) have values aligned vertically
4. Check marks and numbers are centered within their columns
5. X marks are centered the same way
  </verify>
  <done>Bookmaker column values are properly aligned in all rows</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd web && npm run build` succeeds without errors
- [ ] UAT-001: Summary cards remain stable when country filter changes
- [ ] UAT-002: Bookmaker values are visually aligned in columns
</verification>

<success_criteria>
- All UAT issues from 94-01-ISSUES.md addressed
- Build passes without errors
- Ready for re-verification
</success_criteria>

<output>
After completion, create `.planning/phases/94-coverage-page/94-01-FIX-SUMMARY.md`
</output>
