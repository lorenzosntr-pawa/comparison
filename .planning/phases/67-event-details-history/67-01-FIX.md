---
phase: 67-event-details-history
plan: 01-FIX
type: fix
---

<objective>
Fix 2 UAT issues from plan 67-01.

Source: 67-01-ISSUES.md
Priority: 0 critical, 1 major, 1 minor
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

**Issues being fixed:**
@.planning/phases/67-event-details-history/67-01-ISSUES.md

**Original plan for reference:**
@.planning/phases/67-event-details-history/67-01-PLAN.md

**Fix reference (66-02 applied same fixes to Odds Comparison page):**
@.planning/phases/66-odds-comparison-history/66-02-SUMMARY.md

**Key files from 66-02-FIX:**
@web/src/features/matches/components/match-table.tsx
@web/src/features/matches/components/history-dialog.tsx

**Files to fix:**
@web/src/features/matches/components/market-grid.tsx
</context>

<tasks>

<task type="auto">
  <name>Fix UAT-001: Competitor history data not shown in Event Details dialog</name>
  <files>web/src/features/matches/components/market-grid.tsx</files>
  <action>
The issue is that MarketGrid doesn't pass `allBookmakers` correctly to HistoryDialog, unlike match-table.tsx which was fixed in 66-02.

Review match-table.tsx to see how it builds allBookmakers:
- It extracts available bookmakers from the event's markets_by_bookmaker data
- Passes allBookmakers to HistoryDialog for comparison mode

Apply the same pattern to market-grid.tsx:
1. Check how handleOddsClick builds allBookmakers from marketsByBookmaker
2. Ensure it's passed correctly to HistoryDialog
3. Verify HistoryDialogState includes allBookmakers array

The handleOddsClick handler should already be building allBookmakers from marketsByBookmaker - verify it matches the match-table.tsx pattern. If the HistoryDialogState type or props are missing allBookmakers, add them.

Check if the issue is:
- allBookmakers not being built correctly (marketsByBookmaker mapping)
- allBookmakers not being passed to HistoryDialog
- HistoryDialog not receiving or using allBookmakers prop correctly for Event Details

The fix should mirror what was done in match-table.tsx in 66-02-FIX.
  </action>
  <verify>
1. `cd web && npx tsc --noEmit` passes
2. Open Event Details, click on SportyBet or Bet9ja odds - should show history data
3. Comparison mode should work with multiple bookmakers
  </verify>
  <done>Competitor history (SportyBet, Bet9ja) displays correctly in Event Details HistoryDialog</done>
</task>

<task type="auto">
  <name>Fix UAT-002: Chart mouse tracking not smooth</name>
  <files>web/src/features/matches/components/odds-line-chart.tsx, web/src/features/matches/components/margin-line-chart.tsx</files>
  <action>
Investigate the chart UX issue with mouse tracking. The issue reported:
- Mouse tracking over chart lines doesn't look smooth
- Movement visualization looks weird

Check recharts Tooltip configuration:
1. Look at `<Tooltip>` component props in both chart files
2. Consider adding `cursor={{ strokeDasharray: '3 3' }}` for smoother cursor line
3. Check if `isAnimationActive={false}` on Tooltip would help with perceived smoothness
4. Consider adding `allowEscapeViewBox={{ x: false, y: false }}` to prevent tooltip jumping

If the issue is with line animation:
- Check if `<Line isAnimationActive={false} dot={false} />` helps
- Lines should have `type="monotone"` for smoother curves

If the issue is minimal and only cosmetic, document findings but may defer larger UX overhaul.
  </action>
  <verify>
1. Open HistoryDialog and hover over chart lines
2. Tooltip should track smoothly without jumping
3. Movement visualization should feel natural
  </verify>
  <done>Chart mouse tracking behavior improved or documented as expected recharts behavior</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All major issues fixed (UAT-001)
- [ ] Minor issues fixed or documented as deferred
- [ ] `cd web && npx tsc --noEmit` passes
- [ ] `cd web && npm run build` succeeds
</verification>

<success_criteria>
- All UAT issues from 67-01-ISSUES.md addressed
- Competitor history works in Event Details page
- Tests pass
- Ready for re-verification
</success_criteria>

<output>
After completion, create `.planning/phases/67-event-details-history/67-01-FIX-SUMMARY.md`
</output>
