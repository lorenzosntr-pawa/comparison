---
phase: 95-historical-analysis
plan: 01
type: execute
---

<objective>
Polish the Historical Analysis page with professional bookmaker styling and filtering options.

Purpose: Improve usability by adding tournament/country filters and upgrading the bookmaker toggle UI to a professional pill/chip design with brand colors.
Output: Updated filter bar with pill-style bookmaker buttons, tournament search input, and country multi-select filter.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Source files:**
@web/src/features/historical-analysis/index.tsx
@web/src/features/historical-analysis/components/filter-bar.tsx
@web/src/features/historical-analysis/components/bookmaker-filter.tsx
@web/src/features/historical-analysis/components/tournament-list.tsx
@web/src/features/historical-analysis/hooks/use-tournaments.ts

**Pattern reference (Command + Popover multi-select):**
@web/src/features/matches/components/match-filters.tsx

**Established patterns:**
- Command + Popover pattern for searchable multi-select comboboxes (v1.3)
- BOOKMAKER_COLORS constant for brand styling (v2.4 Phase 86)
- Client-side filtering from loaded data (tournaments have country field)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Professional bookmaker pill buttons</name>
  <files>web/src/features/historical-analysis/components/bookmaker-filter.tsx</files>
  <action>
Restyle the BookmakerFilter buttons to use pill/chip design with brand colors:

1. When selected: solid brand color background (BOOKMAKER_COLORS), white text
2. When unselected: transparent background, brand color border, brand color text
3. Use rounded-full for pill shape
4. Betpawa always selected (no change to logic)

Replace the current Button component usage with styled div/button elements using cn() for conditional classes. Keep the existing BOOKMAKER_COLORS constant and toggle logic.

Style approach:
- Selected: `bg-[color] text-white border-[color]`
- Unselected: `bg-transparent text-[color] border-[color] hover:bg-[color]/10`
- All: `rounded-full px-3 py-1.5 text-sm font-medium border transition-colors cursor-pointer`
- Betpawa: Always selected state, no hover effects (cursor-default)

Remove the small colored dot indicator since the button itself will have brand color.
  </action>
  <verify>npm run dev, visit /historical-analysis, verify bookmaker buttons show as pills with brand colors (blue for Betpawa, green for SportyBet, orange for Bet9ja). Toggle SportyBet/Bet9ja and verify selected/unselected states work.</verify>
  <done>Bookmaker buttons render as colored pills. Selected = solid brand color background + white text. Unselected = brand color border + brand color text. Betpawa always solid blue.</done>
</task>

<task type="auto">
  <name>Task 2: Tournament search filter</name>
  <files>web/src/features/historical-analysis/components/filter-bar.tsx, web/src/features/historical-analysis/index.tsx</files>
  <action>
Add a tournament name search input that filters the tournament list client-side:

1. In index.tsx:
   - Add state: `const [searchQuery, setSearchQuery] = useState('')`
   - Pass to FilterBar as props: `searchQuery`, `onSearchChange`
   - Pass to TournamentList as prop: `searchQuery`

2. In filter-bar.tsx:
   - Add props: `searchQuery: string`, `onSearchChange: (query: string) => void`
   - Add Input field with placeholder "Search tournaments..."
   - Position between Quick Select and Bookmakers sections
   - Style: w-[200px]

3. In tournament-list.tsx:
   - Add prop: `searchQuery: string`
   - Filter tournaments by name (case-insensitive includes)
   - Apply filter before mapping to TournamentCard
  </action>
  <verify>npm run dev, visit /historical-analysis, type "premier" in search box, verify only tournaments with "premier" in name appear. Clear search and verify all tournaments return.</verify>
  <done>Tournament search input filters the list by name. Case-insensitive partial matching works. Empty search shows all tournaments.</done>
</task>

<task type="auto">
  <name>Task 3: Country multi-select filter</name>
  <files>web/src/features/historical-analysis/components/filter-bar.tsx, web/src/features/historical-analysis/index.tsx, web/src/features/historical-analysis/components/tournament-list.tsx</files>
  <action>
Add a country filter using Command + Popover pattern (copy from match-filters.tsx):

1. In index.tsx:
   - Add state: `const [selectedCountries, setSelectedCountries] = useState<string[]>([])`
   - Pass to FilterBar and TournamentList

2. In filter-bar.tsx:
   - Add props: `selectedCountries: string[]`, `onCountriesChange: (countries: string[]) => void`
   - Add prop: `availableCountries: string[]` (extracted from tournaments in parent)
   - Create country Popover with Command component (copy pattern from match-filters.tsx lines 202-260)
   - Show "All countries" when none selected, or "{n} countries" when selected
   - Include "Clear all" and "Select all" buttons in footer

3. In index.tsx, extract unique countries from tournaments:
   ```
   const availableCountries = useMemo(() => {
     if (!tournaments) return []
     const countries = new Set<string>()
     tournaments.forEach(t => { if (t.country) countries.add(t.country) })
     return Array.from(countries).sort()
   }, [tournaments])
   ```

4. In tournament-list.tsx:
   - Add prop: `selectedCountries: string[]`
   - Filter tournaments by country when selectedCountries.length > 0
   - Apply filter before/after search filter

Import from @/components/ui: Popover, PopoverTrigger, PopoverContent, Command, CommandInput, CommandList, CommandEmpty, CommandGroup, CommandItem, Checkbox. Import ChevronsUpDown from lucide-react.
  </action>
  <verify>npm run dev, visit /historical-analysis with data loaded. Click country filter, verify dropdown with searchable country list. Select "England", verify only English tournaments shown. Select multiple countries, verify count badge updates. Clear all and verify all tournaments return.</verify>
  <done>Country filter with searchable multi-select works. Selecting countries filters tournament list. "Clear all" and "Select all" buttons function. Count badge shows number of selected countries.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Bookmaker pills show brand colors (blue/green/orange)
- [ ] Tournament search filters list by name
- [ ] Country filter filters list by country
- [ ] All filters can be combined (search + country + bookmaker)
- [ ] Empty results show appropriate empty state message
</verification>

<success_criteria>
- All 3 tasks completed
- All verification checks pass
- No TypeScript errors
- Filter bar looks professional with pill buttons and consistent styling
</success_criteria>

<output>
After completion, create `.planning/phases/95-historical-analysis/95-01-SUMMARY.md`
</output>
