---
phase: 28-table-restructure
plan: 01
type: execute
---

<objective>
Restructure the Matches table from bookmakers-as-columns to bookmakers-as-rows for better odds comparison.

Purpose: Enable easy vertical scanning to compare odds across bookmakers for each outcome
Output: Refactored match-table.tsx with 3 rows per match, rowspan layout, and simplified column structure
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/28-table-restructure/28-CONTEXT.md

**Key file to modify:**
@web/src/features/matches/components/match-table.tsx

**Current structure:**
- Single row per match
- Columns: Match, Kickoff, Tournament, Region, then markets (1X2, O/U, BTTS) with bookmakers as sub-columns
- Match name displays as "Home Team" / "vs Away Team" (two lines)

**Target structure (from CONTEXT.md):**
- 3 rows per match (one per bookmaker: BP, SB, B9)
- Column order: Region → Tournament → Kickoff → Match → Bookmaker → 1 → X → 2
- First 4 columns use rowspan=3 to span all bookmaker rows
- Match name format: "Team A - Team B" (single line)
- Only 1X2 market outcomes for now (O/U and BTTS removed - simplifies table)

**Phase 29 scope (NOT this phase):**
- Double Chance market columns (1X, X2, 12)
- Per-market margin calculations
</context>

<tasks>

<task type="auto">
  <name>Task 1: Restructure table to bookmakers-as-rows layout</name>
  <files>web/src/features/matches/components/match-table.tsx</files>
  <action>
Refactor MatchTable component for new layout:

**Header changes:**
- New column order: Region, Tournament, Kickoff, Match, Bookmaker, 1, X, 2
- Remove market grouping headers (1X2, O/U, BTTS) - now just show 1X2 outcomes directly
- Remove bookmaker sub-headers (BP, SB, B9) - bookmaker becomes a cell per row
- Simple header: Region | Tournament | Kickoff | Match | Bookmaker | 1 | X | 2

**Body changes - each match becomes 3 rows:**
- First row: rowspan=3 for Region, Tournament, Kickoff, Match cells + bookmaker + odds for first bookmaker
- Second row: bookmaker + odds for second bookmaker (no match info cells)
- Third row: bookmaker + odds for third bookmaker (no match info cells)

**Match name format:**
- Change from "Home Team" / "vs Away Team" (two lines) to "Team A - Team B" (single line with hyphen separator)

**Visual grouping:**
- Add border between match groups (bottom border on third row of each match)
- Maintain hover and click behavior (navigate to match detail)
- Keep competitor-only event styling (orange left border)

**Color coding:**
- Keep existing OddsValue color coding logic (green/red based on comparison to Betpawa)
- comparisonData logic stays the same, just applied to the new row structure

**Simplify MARKET_CONFIG:**
- Only keep '3743' (1X2) config since we only show 1, X, 2 columns
- Remove '5000' (O/U) and '3795' (BTTS) - not displayed in this restructured table

**Handle excludeBetpawa prop:**
- When excludeBetpawa=true (competitor-only view), show only 2 rows per match (SB, B9)
- Rowspan becomes 2 instead of 3
  </action>
  <verify>npm run dev in web/ starts without errors, matches page loads</verify>
  <done>Table renders with 3 rows per match (2 for competitor-only), rowspan layout for match info, correct column order, "Team A - Team B" format</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Restructured matches table with bookmakers-as-rows layout</what-built>
  <how-to-verify>
    1. Run: cd web && npm run dev
    2. Visit: http://localhost:5173/matches (or port shown in terminal)
    3. Verify table structure:
       - Each match shows 3 stacked rows (one per bookmaker)
       - Region, Tournament, Kickoff, Match columns span all 3 rows vertically
       - Bookmaker column shows BP, SB, B9 labels (one per row)
       - 1, X, 2 columns show odds for each bookmaker
    4. Verify match name format: "Team A - Team B" (single line with hyphen)
    5. Verify column order (left to right): Region → Tournament → Kickoff → Match → Bookmaker → 1 → X → 2
    6. Verify visual grouping: rows for same match feel like one unit
    7. Test hover: entire match group should highlight
    8. Test click: clicking any row for a match navigates to match detail
    9. Switch to "Competitors Only" toggle: verify 2 rows per match (SB, B9 only)
    10. Verify color coding still works (green/red highlights on odds)
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `cd web && npm run build` succeeds without errors
- [ ] Table displays 3 rows per match (2 for competitor-only)
- [ ] Rowspan layout correctly groups match info columns
- [ ] Match name format is "Team A - Team B"
- [ ] Column order matches spec: Region → Tournament → Kickoff → Match → Bookmaker → 1 → X → 2
- [ ] Navigation to match detail works
- [ ] Color coding for odds comparison works
</verification>

<success_criteria>

- Table restructured from bookmakers-as-columns to bookmakers-as-rows
- Visual grouping makes it easy to compare odds vertically
- All existing functionality preserved (navigation, filtering, color coding)
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/28-table-restructure/28-01-SUMMARY.md`
</output>
