---
phase: 14-scraping-logging-workflow
plan: 02-FIX
type: fix
---

<objective>
Fix 2 UAT issues from plan 14-02.

Source: 14-02-ISSUES.md
Priority: 0 critical, 0 major, 2 minor
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

**Issues being fixed:**
@.planning/phases/14-scraping-logging-workflow/14-02-ISSUES.md

**Original plan for reference:**
@.planning/phases/14-scraping-logging-workflow/14-02-PLAN.md

**Key source files:**
@src/scraping/schemas.py
@src/scraping/orchestrator.py
@src/market_mapping/types/sportybet.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix UAT-001 - Reorder Platform enum so BetPawa is first</name>
  <files>src/scraping/schemas.py</files>
  <action>
The Platform enum order determines scrape execution order when using `list(Platform)`.
Current order: SPORTYBET, BETPAWA, BET9JA
Expected order: BETPAWA, SPORTYBET, BET9JA (BetPawa must be first as canonical source)

Reorder the Platform enum members:
```python
class Platform(StrEnum):
    """Supported betting platforms."""

    BETPAWA = "betpawa"      # Must be first - canonical source for SportRadar IDs
    SPORTYBET = "sportybet"
    BET9JA = "bet9ja"
```

This is a simple reorder - no values change, just member declaration order.
  </action>
  <verify>python -c "from src.scraping.schemas import Platform; print([p.value for p in Platform])" should output ['betpawa', 'sportybet', 'bet9ja']</verify>
  <done>Platform enum reordered with BETPAWA first, scrape execution order now matches expected workflow</done>
</task>

<task type="auto">
  <name>Task 2: Fix UAT-002 - Make optional fields optional in SportybetMarket schema</name>
  <files>src/market_mapping/types/sportybet.py</files>
  <action>
The SportyBet API returns some markets without certain fields (lastOddsChangeTime, group, groupId, title, name).
The Pydantic model marks these as required, causing validation errors for every such market.

Make these fields optional with sensible defaults:

1. Change `group: str` to `group: str | None = None`
2. Change `group_id: str` to `group_id: str | None = None`
3. Change `title: str` to `title: str | None = None`
4. Change `name: str` to `name: str | None = None`
5. Change `last_odds_change_time: int` to `last_odds_change_time: int | None = None`

This allows markets with missing fields to be parsed instead of failing validation.
The downstream mapping code should handle None values gracefully (already does for most cases).
  </action>
  <verify>python -c "from src.market_mapping.types.sportybet import SportybetMarket; m = SportybetMarket(id='1', product=3, desc='test', status=0, market_guide='', favourite=0, outcomes=[], far_near_odds=0, source_type='BET_RADAR', banned=False); print('OK')"</verify>
  <done>SportybetMarket schema accepts markets with missing optional fields, validation errors eliminated</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `python -c "from src.scraping.schemas import Platform; print([p.value for p in Platform])"` outputs betpawa first
- [ ] `python -c "from src.market_mapping.types.sportybet import SportybetMarket"` succeeds without errors
- [ ] Backend starts without import errors: `python -c "from src.scraping.orchestrator import ScrapingOrchestrator"`
</verification>

<success_criteria>
- All UAT issues from 14-02-ISSUES.md addressed
- Platform enum has BETPAWA first
- SportybetMarket accepts markets with missing optional fields
- No new import or runtime errors introduced
- Ready for re-verification
</success_criteria>

<output>
After completion, create `.planning/phases/14-scraping-logging-workflow/14-02-FIX-SUMMARY.md`
</output>
