---
phase: 103-mapping-dashboard
plan: 03
type: execute
---

<objective>
Add recent changes feed and platform coverage charts to the Mapping Dashboard.

Purpose: Show mapping activity history and visual breakdown of coverage by platform.
Output: RecentChanges component and PlatformCoverageChart component integrated into dashboard
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/103-mapping-dashboard/103-02-SUMMARY.md

# Chart patterns to follow:
@web/src/features/historical-analysis/components/time-to-kickoff-chart.tsx
@web/src/features/historical-analysis/components/difference-bar-chart.tsx

# Component patterns:
@web/src/features/coverage/components/stats-cards.tsx
@web/src/features/mappings/index.tsx

**Tech stack available:** recharts (LineChart, BarChart, PieChart), TanStack Query, shadcn/ui Card
**Established patterns:** ResponsiveContainer wrapper, 200px default height, Tooltip with hsl theming
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create RecentChanges component</name>
  <files>web/src/features/mappings/hooks/use-audit-log.ts, web/src/features/mappings/components/recent-changes.tsx, web/src/features/mappings/components/index.ts, web/src/features/mappings/index.tsx</files>
  <action>
1. Create useAuditLog hook:
   - useQuery with queryKey ['mapping-audit-log', { page: 1, pageSize: 10 }]
   - Fetches GET /api/mappings/audit-log?page=1&page_size=10
   - Returns { data, isLoading }

2. Create RecentChanges component:
   - Card with header "Recent Changes"
   - List of audit entries (max 10):
     - Each entry shows: action badge (CREATE/UPDATE/DELETE), canonical_id, time ago
     - Action badges: CREATE=green, UPDATE=blue, DELETE/DEACTIVATE=red
   - "View All" link at bottom (placeholder, no destination yet)
   - Empty state: "No changes yet" message
   - Skeleton loading state with 5 placeholder rows

3. Integrate into MappingDashboard:
   - Add RecentChanges component below stats cards
   - Use 2-column grid on large screens: charts left, recent changes right

Use date-fns formatDistanceToNow for "time ago" display.
Use Badge component from shadcn/ui for action badges.
  </action>
  <verify>
Dashboard shows recent changes list with action badges and timestamps
  </verify>
  <done>
Recent changes component displays audit entries with color-coded actions and relative timestamps
  </done>
</task>

<task type="auto">
  <name>Task 2: Create PlatformCoverageChart component</name>
  <files>web/src/features/mappings/components/platform-coverage-chart.tsx, web/src/features/mappings/components/index.ts, web/src/features/mappings/index.tsx</files>
  <action>
1. Create PlatformCoverageChart component:
   - Uses recharts BarChart (horizontal bars)
   - Shows mapping counts per platform: BetPawa, SportyBet, Bet9ja
   - Data from useMappingStats (by_platform field)
   - Height: 200px with ResponsiveContainer
   - Colors: BetPawa blue (#3b82f6), SportyBet green (#22c55e), Bet9ja orange (#f97316)
   - XAxis: platform names, YAxis: count

2. Wrap in Card with header "Platform Coverage"

3. Add tooltip showing exact count and percentage of total

4. Integrate into MappingDashboard layout:
   - Grid layout below stats cards
   - Left column: PlatformCoverageChart
   - Right column: RecentChanges

Follow established recharts patterns:
- ResponsiveContainer for responsiveness
- Tooltip with hsl(var(--popover)) background
- CartesianGrid with strokeDasharray="3 3"
  </action>
  <verify>
Dashboard shows horizontal bar chart with 3 platform bars and correct counts
  </verify>
  <done>
Platform coverage chart displays all 3 platforms with counts and proper styling
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Dashboard with recent changes and platform coverage chart</what-built>
  <how-to-verify>
    1. Run: npm run dev (in web/ folder)
    2. Navigate to /mappings
    3. Verify: Stats cards at top
    4. Verify: Platform coverage chart shows 3 bars (BetPawa, SportyBet, Bet9ja)
    5. Verify: Hover on bars shows tooltip with count
    6. Verify: Recent changes list shows audit entries (if any exist)
    7. Verify: Responsive layout - chart and changes side by side on large screens
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Recent changes displays audit log entries with badges
- [ ] Platform coverage chart renders with correct data
- [ ] Tooltips work on hover
- [ ] Layout is responsive (stacked on mobile, side-by-side on desktop)
- [ ] No TypeScript errors
</verification>

<success_criteria>

- Recent changes feed working with action badges
- Platform coverage bar chart rendering
- Dashboard layout complete with stats, chart, and feed
- Human verification approved
</success_criteria>

<output>
After completion, create `.planning/phases/103-mapping-dashboard/103-03-SUMMARY.md`
</output>
