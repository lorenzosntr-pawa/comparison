---
phase: 90-odds-comparison-ui
plan: 01
type: execute
---

<objective>
Apply availability styling to the Odds Comparison page (match-table.tsx).

Purpose: Users need to visually distinguish between markets that were never offered vs markets that became unavailable over time.
Output: Odds cells display three states: normal odds, strikethrough with tooltip for unavailable, plain dash for never offered.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context (availability infrastructure):
@.planning/phases/87-investigation-schema-design/87-01-SUMMARY.md
@.planning/phases/88-backend-availability-tracking/88-01-SUMMARY.md
@.planning/phases/89-api-availability-endpoints/89-01-SUMMARY.md

# Key source files to modify:
@web/src/types/api.ts
@web/src/features/matches/components/match-table.tsx
@web/src/features/matches/components/odds-badge.tsx

**API provides:** `available: bool = True` and `unavailable_since: datetime | None = None` on InlineOdds and MarketOddsDetail schemas.

**UI distinction (from Phase 87 DISCOVERY.md):**
- `null` market (never offered): Plain dash "-"
- `available=false` (became unavailable): Strikethrough dash with tooltip showing "Unavailable since X"
- `available=true`: Normal odds display (no change)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add availability fields to TypeScript API types</name>
  <files>web/src/types/api.ts</files>
  <action>
Add two fields to InlineOdds interface (around line 199-210):
- `available: boolean` (true when market is offered, false when became unavailable)
- `unavailable_since: string | null` (ISO timestamp when market became unavailable, null if available)

Add same two fields to MarketOddsDetail interface (around line 305-318) for consistency with event detail page (Phase 91).

Use optional fields with defaults matching backend: `available?: boolean` (default true), `unavailable_since?: string | null` (default null) to maintain backward compatibility with existing API responses that might not include these fields yet.

Document the three states in JSDoc:
- available=true, unavailable_since=null: Market currently offered
- available=false, unavailable_since=timestamp: Market became unavailable at that time
- Market not in response at all: Never offered (shown as dash)
  </action>
  <verify>TypeScript compiles without errors: `cd web && npx tsc --noEmit`</verify>
  <done>InlineOdds and MarketOddsDetail have available/unavailable_since fields with JSDoc</done>
</task>

<task type="auto">
  <name>Task 2: Create availability display utilities</name>
  <files>web/src/features/matches/lib/market-utils.ts</files>
  <action>
Add two utility functions to market-utils.ts:

1. `formatUnavailableSince(isoTimestamp: string): string`
   - Takes ISO timestamp string
   - Returns human-readable format: "Unavailable since Jan 15, 10:30 AM"
   - Use Intl.DateTimeFormat for locale-aware formatting
   - Keep format concise for tooltip display

2. `getMarketAvailabilityState(market: InlineOdds | null | undefined): 'available' | 'unavailable' | 'never_offered'`
   - Returns 'never_offered' if market is null/undefined
   - Returns 'unavailable' if market.available === false
   - Returns 'available' otherwise
   - This centralizes the three-state logic for reuse

Export both functions from market-utils.ts.
  </action>
  <verify>TypeScript compiles: `cd web && npx tsc --noEmit`</verify>
  <done>formatUnavailableSince and getMarketAvailabilityState exported from market-utils.ts</done>
</task>

<task type="auto">
  <name>Task 3: Update OddsValue component with availability styling</name>
  <files>web/src/features/matches/components/match-table.tsx</files>
  <action>
Modify OddsValue component (around line 169) to handle availability states:

1. Add new props to OddsValue:
   - `available?: boolean` (default true)
   - `unavailableSince?: string | null` (default null)

2. Update rendering logic:
   - If `available === false`: Show strikethrough dash "-" with Tooltip showing "Unavailable since {formatted_time}"
   - If `odds === null`: Show plain dash "-" (never offered, no tooltip) - this is existing behavior
   - If `available === true` (or undefined): Show normal odds display - existing behavior

3. Import Tooltip components from '@/components/ui/tooltip'

4. Import formatUnavailableSince from '../lib/market-utils'

5. Update getOutcomeOdds function to also return availability state:
   - Return type becomes `{ odds: number | null, available: boolean, unavailableSince: string | null }`
   - Extract available and unavailable_since from market object
   - Fallback to available=true, unavailableSince=null if fields not present

6. Update all OddsValue usages in the table rows to pass availability props

Styling for unavailable state:
- Text: `text-muted-foreground line-through` (gray + strikethrough)
- Content: "-" dash character
- Tooltip: "Unavailable since {date}" using formatUnavailableSince
  </action>
  <verify>
1. TypeScript compiles: `cd web && npx tsc --noEmit`
2. Manual test: Start dev server, navigate to Odds Comparison page, verify odds display
  </verify>
  <done>
- OddsValue shows normal odds for available markets
- OddsValue shows strikethrough dash with tooltip for unavailable markets
- OddsValue shows plain dash for never-offered markets (null odds)
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `cd web && npx tsc --noEmit` passes
- [ ] `cd web && npm run build` succeeds
- [ ] Odds Comparison page loads without errors
- [ ] Available markets show normal odds display
- [ ] Unavailable markets show strikethrough "-" with tooltip
- [ ] Never-offered markets show plain "-" without tooltip
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Three availability states render correctly on Odds Comparison page
  </success_criteria>

<output>
After completion, create `.planning/phases/90-odds-comparison-ui/90-01-SUMMARY.md`
</output>
