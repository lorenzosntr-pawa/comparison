---
phase: 25-include-started-toggle
plan: 01
type: execute
---

<objective>
Add toggle to exclude in-play/started events with filtered summary cards.

Purpose: Give users a clean pre-match view focused on upcoming events, with toggle to include in-play when needed.
Output: Working "Include Started" toggle that filters both events and stats cards.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/25-include-started-toggle/25-CONTEXT.md
@.planning/phases/24-country-filters-ux/24-01-SUMMARY.md

# Key source files:
@web/src/lib/api.ts
@web/src/features/coverage/hooks/use-coverage.ts
@web/src/features/coverage/components/filter-bar.tsx
@web/src/features/coverage/index.tsx
@src/api/routes/palimpsest.py

**Tech stack available:** React, TanStack Query v5, shadcn/ui with Switch component
**Established patterns:** Filters state in page component, hooks accept params, api.ts builds query params

**API status:** Both `/palimpsest/coverage` and `/palimpsest/events` already accept `include_started` query parameter (defaults to false). Frontend just needs to wire it up.

**CONTEXT.md requirements:**
- Toggle in header row, right corner, near event count display
- Default: hide started events (toggle off)
- All cards update dynamically when toggle changes
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire include_started through API client and hooks</name>
  <files>web/src/lib/api.ts, web/src/features/coverage/hooks/use-coverage.ts</files>
  <action>
1. In api.ts:
   - Update `getCoverage` to accept optional `params?: { includeStarted?: boolean }` and append `include_started` query param when true
   - Update `getPalimpsestEvents` params to include `include_started?: boolean` and append to searchParams when true

2. In use-coverage.ts:
   - Add `includeStarted?: boolean` to `useCoverage()` - accept as param, add to queryKey, pass to api.getCoverage()
   - Add `include_started?: boolean` to `UsePalimpsestEventsParams` interface
   - Pass include_started to api.getPalimpsestEvents()
  </action>
  <verify>TypeScript compiles without errors: `cd web && npx tsc --noEmit`</verify>
  <done>Both hooks accept includeStarted param and pass to API. Types are correct.</done>
</task>

<task type="auto">
  <name>Task 2: Add Include Started toggle to coverage page</name>
  <files>web/src/features/coverage/components/filter-bar.tsx, web/src/features/coverage/index.tsx</files>
  <action>
1. In filter-bar.tsx:
   - Add `includeStarted: boolean` to `CoverageFilters` interface (export it)

2. In index.tsx:
   - Add `includeStarted: false` to DEFAULT_FILTERS
   - Add Switch toggle in header row (right side, before event count) with Label "Include Started"
   - Import Switch from @/components/ui/switch and Label from @/components/ui/label
   - Pass `includeStarted: filters.includeStarted` to both useCoverage() and usePalimpsestEvents()
   - Toggle updates filters.includeStarted via setFilters

Layout for header section:
```tsx
<div className="flex items-center justify-between">
  <h1 className="text-2xl font-bold">Coverage Comparison</h1>
  <div className="flex items-center gap-4">
    {/* Toggle */}
    <div className="flex items-center gap-2">
      <Switch
        id="include-started"
        checked={filters.includeStarted}
        onCheckedChange={(checked) => setFilters({...filters, includeStarted: checked})}
      />
      <Label htmlFor="include-started" className="text-sm text-muted-foreground">
        Include Started
      </Label>
    </div>
    {/* Event count */}
    {eventsData && (
      <span className="text-sm text-muted-foreground">
        {filteredEventCount} events...
      </span>
    )}
  </div>
</div>
```
  </action>
  <verify>
1. Run dev server: `cd web && npm run dev`
2. Visit /coverage page
3. Toggle should appear in header row, right side
4. Default: toggle OFF (hiding started events)
5. Toggle ON: event count and stats cards should update (may increase if there are started events)
6. TypeScript compiles: `cd web && npx tsc --noEmit`
  </verify>
  <done>Toggle visible in header, stats cards and event list update when toggled, default is OFF (hide started)</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `cd web && npx tsc --noEmit` passes
- [ ] Toggle appears in header row, right side near event count
- [ ] Default state is OFF (started events hidden)
- [ ] Toggling ON shows started events and updates all stats cards
- [ ] Country filter and availability filter still work alongside include started toggle
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Toggle updates both stats cards and tournament table
- Default state correctly hides started events
</success_criteria>

<output>
After completion, create `.planning/phases/25-include-started-toggle/25-01-SUMMARY.md`
</output>
