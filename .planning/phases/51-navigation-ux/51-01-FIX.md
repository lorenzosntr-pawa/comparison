---
phase: 51-navigation-ux
plan: 01-FIX
type: fix
---

<objective>
Fix 5 UAT issues from plan 51-01.

Source: 51-01-ISSUES.md
Priority: 1 blocker, 2 major, 1 minor, 1 cosmetic

**Root cause identified:** The implementation targets the wrong scroll container. The app has two nested `<main>` elements:
1. Outer `<main>` from SidebarInset (flex container, no scroll)
2. Inner `<main className="overflow-auto">` (actual scroll container)

`document.querySelector('main')` returns the first (wrong) one, so scroll events never fire.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

**Issues being fixed:**
@.planning/phases/51-navigation-ux/51-01-ISSUES.md

**Original plan for reference:**
@.planning/phases/51-navigation-ux/51-01-PLAN.md

**Key files:**
@web/src/features/matches/components/market-grid.tsx
@web/src/components/layout/app-layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add data attribute to correct scroll container</name>
  <files>web/src/components/layout/app-layout.tsx</files>
  <action>
Add a data attribute to the inner `<main>` element in app-layout.tsx to make it uniquely selectable.

Change line 21 from:
```tsx
<main className="flex-1 overflow-auto p-4">
```

To:
```tsx
<main data-scroll-container className="flex-1 overflow-auto p-4">
```

This allows market-grid.tsx to query `document.querySelector('[data-scroll-container]')` instead of `document.querySelector('main')`, ensuring it targets the correct scrollable element.
  </action>
  <verify>npm run build succeeds; grep for data-scroll-container in app-layout.tsx shows it's added</verify>
  <done>The scrollable main element has a unique data attribute for querying</done>
</task>

<task type="auto">
  <name>Task 2: Fix scroll listener to target correct container</name>
  <files>web/src/features/matches/components/market-grid.tsx</files>
  <action>
Fix the scroll listener in market-grid.tsx to use the new data attribute:

1. Update the useEffect at ~line 300 to query with data attribute:
   Change: `const scrollContainer = document.querySelector('main')`
   To: `const scrollContainer = document.querySelector('[data-scroll-container]')`

2. Update the scrollToTop function at ~line 320 similarly:
   Change: `const scrollContainer = document.querySelector('main')`
   To: `const scrollContainer = document.querySelector('[data-scroll-container]')`

3. Update the getScrollContainerRect function at ~line 382 similarly:
   Change: `const scrollContainer = document.querySelector('main')`
   To: `const scrollContainer = document.querySelector('[data-scroll-container]')`

This fixes UAT-001 (sticky header), UAT-002 (scroll-to-top button), UAT-004 (layout shift), and UAT-005 (shadow) since they all depend on the scroll listener working.
  </action>
  <verify>npm run build succeeds; all three querySelector calls use [data-scroll-container]</verify>
  <done>All scroll-related queries target the correct scroll container via data attribute</done>
</task>

<task type="auto">
  <name>Task 3: Adjust scroll-to-top button position</name>
  <files>web/src/features/matches/components/market-grid.tsx</files>
  <action>
Fix UAT-003: Move the scroll-to-top button higher to avoid overlap with API icon in bottom-right corner.

Find the Button component (around line 466-474) and change its positioning:

From:
```tsx
className="fixed bottom-6 right-6 shadow-lg transition-opacity duration-200"
```

To:
```tsx
className="fixed bottom-20 right-6 shadow-lg transition-opacity duration-200"
```

The change from `bottom-6` (24px) to `bottom-20` (80px) positions the button above the API icon which occupies the bottom-right corner.
  </action>
  <verify>npm run build succeeds; button class shows bottom-20</verify>
  <done>Scroll-to-top button positioned above API icon conflict area</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Fixed sticky navigation with correct scroll container targeting and repositioned scroll-to-top button</what-built>
  <how-to-verify>
    1. Run: npm run dev (from web/ directory)
    2. Visit: http://localhost:5173/matches (or port shown)
    3. Click any match to view event details with markets
    4. **Test UAT-001 fix:** Scroll down - tabs/filters should stay sticky at top
    5. **Test UAT-002 fix:** After scrolling ~400px, scroll-to-top button should appear
    6. **Test UAT-003 fix:** Button should be positioned above API icon (not overlapping)
    7. **Test UAT-004 fix:** Scroll slowly - no content jumping when header becomes sticky
    8. **Test UAT-005 fix:** Shadow should appear under sticky header when scrolled
    9. Click scroll-to-top button - should smoothly return to top
  </how-to-verify>
  <resume-signal>Type "approved" if all issues fixed, or describe remaining problems</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All 5 UAT issues addressed
- [ ] `npm run build` succeeds without errors
- [ ] Sticky header works (UAT-001)
- [ ] Scroll-to-top button appears (UAT-002)
- [ ] Button doesn't overlap API icon (UAT-003)
- [ ] No layout shift when scrolling (UAT-004)
- [ ] Shadow appears on sticky header (UAT-005)
</verification>

<success_criteria>
- All UAT issues from 51-01-ISSUES.md resolved
- Build passes
- Ready for re-verification
</success_criteria>

<output>
After completion, create `.planning/phases/51-navigation-ux/51-01-FIX-SUMMARY.md`
</output>
