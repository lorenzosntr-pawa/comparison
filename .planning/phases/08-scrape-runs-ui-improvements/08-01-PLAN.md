---
phase: 08-scrape-runs-ui-improvements
plan: 01
type: execute
---

<objective>
Activate the existing SSE streaming infrastructure to display real-time per-platform progress during active scrapes.

Purpose: The useScrapeProgress hook exists but is unused. This plan connects it to the UI for live progress visibility.
Output: LiveProgressPanel component showing real-time per-platform progress bars, integrated into detail page and dashboard widget.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./08-01-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-scrape-runs-ui-improvements/08-CONTEXT.md

# Prior phase (SSE streaming infrastructure):
@.planning/phases/07.2-scraping-performance/07.2-02-SUMMARY.md
@.planning/phases/07.2-scraping-performance/07.2-03-SUMMARY.md

# Key files to understand:
@web/src/features/dashboard/hooks/use-scrape-progress.ts
@web/src/features/scrape-runs/detail.tsx
@web/src/features/scrape-runs/components/platform-breakdown.tsx
@web/src/features/dashboard/components/recent-runs.tsx

**Tech stack available:** React 19, TanStack Query v5, shadcn/ui, EventSource SSE
**Established patterns:**
- AsyncGenerator pattern for SSE streaming from FastAPI
- useScrapeProgress hook pattern for EventSource consumption
- Feature-based folder structure (components/hooks/index.ts)
- shadcn Progress component available for progress bars

**From 08-CONTEXT.md:**
- Per-platform progress bars with independent event counts on Scrape Runs page
- Single overall progress bar in dashboard widget
- Clean, card-based layout consistent with existing UI
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LiveProgressPanel component</name>
  <files>web/src/features/scrape-runs/components/live-progress.tsx, web/src/features/scrape-runs/components/index.ts</files>
  <action>
Create LiveProgressPanel component that consumes useScrapeProgress hook and displays real-time per-platform progress:

1. Import useScrapeProgress from dashboard hooks
2. Show 3 platform progress bars (betpawa, sportybet, bet9ja):
   - Use shadcn Progress component with platform-specific colors (betpawa=green, sportybet=blue, bet9ja=orange)
   - Show phase text (scraping/storing/completed/failed)
   - Show event count as it updates
   - Calculate progress percentage: (current platform index / total platforms * 100) for overall, or phase-based for individual
3. Show overall progress at top with current step text (e.g., "Scraping SportyBet...")
4. Handle connection state (connected/disconnected indicator)
5. Handle error state gracefully
6. Auto-hide or show completion state when scrape finishes

Props:
- onComplete?: () => void - callback when scrape finishes (for query invalidation)
- showOnlyWhenActive?: boolean - only render when scrape is running

Export from components/index.ts.

Use same color scheme as PlatformBreakdown component for consistency.
  </action>
  <verify>Component file exists, exports correctly from index.ts, TypeScript compiles without errors</verify>
  <done>LiveProgressPanel component created with per-platform progress bars consuming useScrapeProgress SSE stream</done>
</task>

<task type="auto">
  <name>Task 2: Integrate LiveProgressPanel into ScrapeRunDetailPage</name>
  <files>web/src/features/scrape-runs/detail.tsx</files>
  <action>
Modify ScrapeRunDetailPage to show LiveProgressPanel when viewing an active scrape run:

1. Import LiveProgressPanel from components
2. Add logic to detect if run is "running" status
3. When status is "running":
   - Show LiveProgressPanel prominently at top (above the summary card)
   - Hide or dim the static PlatformBreakdown section (it shows stale data during active scrape)
4. When status is not "running":
   - Show normal PlatformBreakdown (historical data)
   - Don't show LiveProgressPanel (or show "No active scrape" if preferred)
5. On completion callback, refetch the run detail to update static view

The detail page should seamlessly transition from live progress to historical breakdown when scrape completes.
  </action>
  <verify>Navigate to /scrape-runs/{id} for a running scrape, verify live progress bars animate and update in real-time</verify>
  <done>ScrapeRunDetailPage shows LiveProgressPanel during active scrapes, transitions to static view on completion</done>
</task>

<task type="auto">
  <name>Task 3: Add live progress indicator to dashboard RecentRuns widget</name>
  <files>web/src/features/dashboard/components/recent-runs.tsx</files>
  <action>
Enhance RecentRuns dashboard widget to show simplified live progress when a scrape is active:

1. Import useScrapeProgress hook
2. Add a conditional section at top of the card when scrape is active:
   - Show single overall progress bar (shadcn Progress)
   - Show current platform name and event count
   - Simple text like "Scraping SportyBet... (42 events)"
   - Use subtle animation/pulse to indicate live activity
3. When no scrape active, show normal recent runs list (existing behavior)
4. Keep the card compact - don't make it dramatically taller
5. On completion, invalidate recent runs query to show updated list

This gives at-a-glance scrape status on the dashboard without needing to navigate to detail page.
  </action>
  <verify>View dashboard during active scrape, verify progress bar animates and shows current platform/event count</verify>
  <done>Dashboard RecentRuns widget shows live progress indicator during active scrapes</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd web && npm run build` succeeds without errors
- [ ] LiveProgressPanel renders per-platform progress bars with correct colors
- [ ] ScrapeRunDetailPage shows live progress for running scrapes
- [ ] Dashboard widget shows simplified live indicator during active scrape
- [ ] Progress updates in real-time as SSE events arrive
- [ ] Graceful fallback when no scrape is active
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Live progress visible on both detail page (detailed) and dashboard (summary)
- Progress bars animate smoothly during scrape
- Transitions cleanly from live to historical view on completion
</success_criteria>

<output>
After completion, create `.planning/phases/08-scrape-runs-ui-improvements/08-01-SUMMARY.md`
</output>
