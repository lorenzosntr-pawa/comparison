---
phase: 65-history-dialog-component
plan: 01
type: execute
---

<objective>
Create reusable popup dialog component for viewing historical odds and margin data.

Purpose: Enable users to click on odds/margins and see price movement charts in a popup.
Output: HistoryDialog component that combines shadcn Dialog with Phase 64's chart components.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase providing chart components:
@.planning/phases/64-chart-library-integration/64-01-SUMMARY.md

# Key files from Phase 64 (available components and hooks):
@web/src/features/matches/components/odds-line-chart.tsx
@web/src/features/matches/components/margin-line-chart.tsx
@web/src/features/matches/hooks/use-odds-history.ts
@web/src/features/matches/hooks/use-margin-history.ts

# Dialog component from shadcn:
@web/src/components/ui/dialog.tsx

# API types for history data:
@web/src/types/api.ts

**Tech stack available:** recharts, TanStack Query, shadcn/ui Dialog, date-fns
**Established patterns:**
- recharts Tooltip formatter with typeof check for undefined values
- Query key includes all filter params for proper cache invalidation
- shadcn Dialog with controlled open/onOpenChange props
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create HistoryDialog component with tabs</name>
  <files>web/src/features/matches/components/history-dialog.tsx</files>
  <action>
Create HistoryDialog component with:

**Props interface:**
```typescript
interface HistoryDialogProps {
  open: boolean
  onOpenChange: (open: boolean) => void
  eventId: number
  marketId: string
  bookmakerSlug: string
  marketName: string
  bookmakerName: string
}
```

**Structure:**
- Use Dialog, DialogContent, DialogHeader, DialogTitle from shadcn
- Add Tabs from shadcn for switching between "Odds" and "Margin" views
- Default tab: "odds"
- Wider dialog: use `max-w-2xl` class on DialogContent for chart visibility

**Data fetching:**
- Use useOddsHistory hook with `enabled: open && activeTab === 'odds'`
- Use useMarginHistory hook with `enabled: open && activeTab === 'margin'`
- This ensures data only fetches when dialog is open AND that tab is active

**Content by tab:**
- Odds tab: Render OddsLineChart with `data={oddsHistory.data?.history ?? []}`, `showMargin={true}` to overlay margin line
- Margin tab: Render MarginLineChart with `data={marginHistory.data?.history ?? []}`

**States to handle:**
- Loading: Show Skeleton placeholder while data loads
- Empty: Use chart component's built-in empty state (shows "No data" message)
- Error: Show error message with retry option

**Dialog title:** "{marketName} - {bookmakerName}"

Do NOT add time range filters (keep simple for now - future enhancement).
  </action>
  <verify>
TypeScript compiles: `cd web && npx tsc --noEmit`
  </verify>
  <done>
HistoryDialog component exists with tabs switching between OddsLineChart and MarginLineChart
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Tabs component and export HistoryDialog</name>
  <files>web/src/components/ui/tabs.tsx, web/src/features/matches/components/index.ts</files>
  <action>
**Step 1: Add shadcn Tabs component (if not exists)**
Run: `cd web && npx shadcn@latest add tabs --yes`

This adds Tabs, TabsList, TabsTrigger, TabsContent primitives.

**Step 2: Export HistoryDialog from matches components index**
Add to web/src/features/matches/components/index.ts:
```typescript
export { HistoryDialog } from './history-dialog'
```
  </action>
  <verify>
- Tabs component exists: `ls web/src/components/ui/tabs.tsx`
- Build succeeds: `cd web && npm run build`
  </verify>
  <done>
- Tabs UI component available in project
- HistoryDialog exported and importable from matches components
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `cd web && npx tsc --noEmit` passes without errors
- [ ] `cd web && npm run build` succeeds
- [ ] HistoryDialog component exists with Odds/Margin tabs
- [ ] Component uses existing chart components from Phase 64
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- HistoryDialog is reusable (controlled props, configurable context)
- Ready for Phase 66-67 integration into Odds Comparison and Event Details pages
</success_criteria>

<output>
After completion, create `.planning/phases/65-history-dialog-component/65-01-SUMMARY.md`:

# Phase 65 Plan 01: History Dialog Component Summary

**[Substantive one-liner]**

## Accomplishments

- [Key outcomes]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

[Ready for Phase 66: Odds Comparison History]
</output>
