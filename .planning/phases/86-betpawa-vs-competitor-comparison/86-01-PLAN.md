---
phase: 86-betpawa-vs-competitor-comparison
plan: 01
type: execute
---

<objective>
Add bookmaker filter controls and multi-column margin display to tournament cards.

Purpose: Enable users to compare Betpawa margins against competitors at a glance on the Historical Analysis page.
Output: Bookmaker toggle in filter bar, tournament cards with Betpawa | SportyBet | Bet9ja columns.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/86-betpawa-vs-competitor-comparison/86-CONTEXT.md

# Prior phase context
@.planning/phases/85.1-historical-analysis-card-margins/85.1-01-SUMMARY.md

# Source files
@web/src/features/historical-analysis/index.tsx
@web/src/features/historical-analysis/components/filter-bar.tsx
@web/src/features/historical-analysis/components/tournament-list.tsx
@web/src/features/historical-analysis/hooks/use-tournaments.ts

**Tech stack available:**
- React 19, TanStack Query v5, shadcn/ui, Tailwind v4, recharts
- Toggle component from shadcn/ui for bookmaker selection

**Established patterns:**
- FilterBar component with date range and quick presets
- MarginMetrics interface already has `competitorAvgMargin` field
- DeltaDisplay for color-coded margin changes

**Constraining decisions:**
- Brand colors: Betpawa blue (#3b82f6), SportyBet green (#22c55e), Bet9ja orange (#f97316)
- All bookmakers shown by default
- Gray "—" for missing data
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create BookmakerFilter toggle component</name>
  <files>web/src/features/historical-analysis/components/bookmaker-filter.tsx, web/src/features/historical-analysis/components/index.ts</files>
  <action>
Create a reusable BookmakerFilter component with toggle buttons for Betpawa, SportyBet, Bet9ja.

Structure:
- Props: `selected: string[]`, `onChange: (selected: string[]) => void`
- Use shadcn Toggle or Button components with variant="outline" for unselected, "default" for selected
- Display bookmaker name with colored dot indicator (brand colors)
- Betpawa always enabled (not toggleable) since it's the reference
- All competitors on by default

Brand colors as constants:
```typescript
export const BOOKMAKER_COLORS = {
  betpawa: '#3b82f6',    // Blue
  sportybet: '#22c55e',  // Green
  bet9ja: '#f97316',     // Orange
} as const
```

Export from components/index.ts.
  </action>
  <verify>TypeScript compiles without errors: `cd web && npx tsc --noEmit`</verify>
  <done>BookmakerFilter component exported, accepts selected/onChange props, displays colored toggle buttons</done>
</task>

<task type="auto">
  <name>Task 2: Add BookmakerFilter to FilterBar with state</name>
  <files>web/src/features/historical-analysis/components/filter-bar.tsx, web/src/features/historical-analysis/index.tsx</files>
  <action>
Extend FilterBar to include BookmakerFilter:

1. Add props to FilterBar:
   - `selectedBookmakers: string[]`
   - `onBookmakersChange: (selected: string[]) => void`

2. Add BookmakerFilter to the filter bar layout (after date inputs).

3. In HistoricalAnalysisPage (index.tsx):
   - Add `selectedBookmakers` state initialized to `['betpawa', 'sportybet', 'bet9ja']`
   - Pass state and setter to FilterBar
   - Pass selectedBookmakers to TournamentList (for next task)

4. Update TournamentList props to accept `selectedBookmakers: string[]` (used in Task 3).
  </action>
  <verify>App compiles and filter bar shows bookmaker toggles: `cd web && npm run build`</verify>
  <done>FilterBar displays bookmaker toggles, clicking toggles updates state, TournamentList receives selected bookmakers</done>
</task>

<task type="auto">
  <name>Task 3: Update tournament cards with multi-bookmaker columns</name>
  <files>web/src/features/historical-analysis/components/tournament-list.tsx</files>
  <action>
Redesign MarketBreakdown to show bookmaker columns:

1. Update MarketBreakdown props to accept `selectedBookmakers: string[]`.

2. Change layout from 2-column grid to table-like structure:
   ```
   Market    | Betpawa | SportyBet | Bet9ja
   1X2       | 5.2%    | 4.8%      | 5.0%
   O/U 2.5   | 6.1%    | 5.9%      | —
   ```

3. For each tracked market:
   - Show Betpawa avgMargin (always)
   - Show competitor avgMargin for selected bookmakers
   - Use "—" with text-muted-foreground for missing data
   - Apply brand color to column headers (small colored dot or text)

4. Add competitive indicator badge showing +/- vs best competitor:
   - If Betpawa is lower (better), show green badge "-X.X%"
   - If Betpawa is higher (worse), show red badge "+X.X%"
   - Only show for 1X2 market (primary comparison)

5. Filter columns based on selectedBookmakers prop.

6. Pass selectedBookmakers from TournamentList to TournamentCard to MarketBreakdown.

Note: The hook already provides `competitorAvgMargin` which is the best (lowest) competitor margin. For individual bookmaker columns, we need to extend the data. For now, use competitorAvgMargin as "Best Competitor" column until Plan 86-02 extends the hook.
  </action>
  <verify>App builds and tournament cards show multi-column layout: `cd web && npm run build`</verify>
  <done>Tournament cards show Betpawa column + competitor columns based on filter, competitive badge shows +/- difference</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Bookmaker filter in filter bar and multi-column tournament cards</what-built>
  <how-to-verify>
    1. Run: npm run dev (in web directory)
    2. Visit: http://localhost:5173/historical-analysis
    3. Verify: Filter bar shows Bookmaker section with toggle buttons
    4. Toggle: Click SportyBet/Bet9ja toggles to hide/show columns
    5. Cards: Each tournament card shows multi-column margin breakdown
    6. Check: Missing data shows "—" placeholder
    7. Badge: 1X2 row shows +/- competitive indicator
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd web && npm run build` succeeds
- [ ] BookmakerFilter component toggles correctly
- [ ] Tournament cards show bookmaker columns
- [ ] Filtering hides/shows correct columns
- [ ] Competitive badge shows correct +/- value
</verification>

<success_criteria>

- All tasks completed
- Bookmaker filter in filter bar with toggle state
- Tournament cards display multi-column margins
- User can toggle competitors on/off
- Visual verification approved
</success_criteria>

<output>
After completion, create `.planning/phases/86-betpawa-vs-competitor-comparison/86-01-SUMMARY.md`
</output>
