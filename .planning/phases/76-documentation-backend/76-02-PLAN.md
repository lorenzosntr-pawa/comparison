---
phase: 76-documentation-backend
plan: 02
type: execute
---

<objective>
Add comprehensive docstrings to data layer modules including database models and market mapping library.

Purpose: Document the core data structures and transformation logic that underpins the entire application.
Output: All data layer Python files with PEP 257 compliant docstrings for modules, classes, and functions.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/codebase/CONVENTIONS.md
@.planning/codebase/ARCHITECTURE.md

**Documentation standard (from CONVENTIONS.md):**
- Module docstring at file start
- Function docstrings with `Args:`, `Returns:`, `Raises:` sections
- Follow PEP 257 conventions
- For SQLAlchemy models: document table purpose and key relationships

**Files to document:**

Database Layer (13 files):
- src/db/base.py
- src/db/engine.py
- src/db/models/bookmaker.py
- src/db/models/cleanup_run.py
- src/db/models/competitor.py
- src/db/models/event.py
- src/db/models/event_scrape_status.py
- src/db/models/odds.py
- src/db/models/scrape.py
- src/db/models/settings.py
- src/db/models/sport.py
- src/db/models/__init__.py
- src/db/__init__.py

Market Mapping (18 files):
- src/market_mapping/mappers/bet9ja.py
- src/market_mapping/mappers/sportybet.py
- src/market_mapping/mappers/unified.py
- src/market_mapping/mappers/__init__.py
- src/market_mapping/mappings/market_ids.py
- src/market_mapping/mappings/__init__.py
- src/market_mapping/types/bet9ja.py
- src/market_mapping/types/betpawa.py
- src/market_mapping/types/competitors.py
- src/market_mapping/types/errors.py
- src/market_mapping/types/mapped.py
- src/market_mapping/types/normalized.py
- src/market_mapping/types/sportybet.py
- src/market_mapping/types/__init__.py
- src/market_mapping/utils/bet9ja_parser.py
- src/market_mapping/utils/specifier_parser.py
- src/market_mapping/utils/__init__.py
- src/market_mapping/__init__.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Document database models</name>
  <files>src/db/base.py, src/db/engine.py, src/db/models/bookmaker.py, src/db/models/cleanup_run.py, src/db/models/competitor.py, src/db/models/event.py, src/db/models/event_scrape_status.py, src/db/models/odds.py, src/db/models/scrape.py, src/db/models/settings.py, src/db/models/sport.py</files>
  <action>
Add or enhance docstrings for all database layer files:

1. **Module docstrings** - Describe what models/utilities the file contains
2. **SQLAlchemy model class docstrings** - Document:
   - Table purpose and what entity it represents
   - Key relationships (one-to-many, many-to-one)
   - Important constraints (unique, foreign keys)
   - Usage context (when/where this model is created/queried)

3. **Engine/session utilities** - Document:
   - get_db() dependency function
   - Session factory configuration
   - Connection pool settings

Format for SQLAlchemy models:
```python
class Event(Base):
    """Matched event across betting platforms.

    Represents a sporting event that has been matched across multiple
    bookmakers using SportRadar ID. Links to tournament for categorization
    and to EventBookmaker for platform-specific data.

    Attributes:
        id: Primary key
        tournament_id: FK to tournaments table
        name: Display name (e.g., "Arsenal vs Chelsea")
        home_team: Home team name
        away_team: Away team name
        kickoff: Event start time (UTC)
        sportradar_id: Cross-platform matching key (unique)

    Relationships:
        tournament: Parent Tournament (many-to-one)
        bookmaker_links: EventBookmaker entries (one-to-many)
    """
```

Do NOT change any functional code - only add/enhance docstrings.
  </action>
  <verify>python -m py_compile src/db/models/event.py src/db/models/odds.py src/db/models/competitor.py src/db/engine.py</verify>
  <done>All 11 database files have module docstrings, all model classes document their purpose, attributes, and relationships</done>
</task>

<task type="auto">
  <name>Task 2: Document market mapping library</name>
  <files>src/market_mapping/mappers/bet9ja.py, src/market_mapping/mappers/sportybet.py, src/market_mapping/mappers/unified.py, src/market_mapping/mappings/market_ids.py, src/market_mapping/types/bet9ja.py, src/market_mapping/types/betpawa.py, src/market_mapping/types/competitors.py, src/market_mapping/types/errors.py, src/market_mapping/types/mapped.py, src/market_mapping/types/normalized.py, src/market_mapping/types/sportybet.py, src/market_mapping/utils/bet9ja_parser.py, src/market_mapping/utils/specifier_parser.py</files>
  <action>
Add or enhance docstrings for all market mapping files:

1. **Mapper modules** - Document:
   - Module purpose (transform X platform data to Betpawa format)
   - Main entry point function
   - Error handling patterns (MappingResult return type)

2. **Type definitions** - Document:
   - TypedDict and dataclass purposes
   - Field meanings and expected values
   - Platform-specific quirks (e.g., Bet9ja key format)

3. **Mapping data** - Document:
   - market_ids.py: Explain the MARKET_MAPPINGS structure
   - How to add new mappings
   - Lookup functions (find_by_betpawa_id, etc.)

4. **Utility functions** - Document:
   - Specifier parsing (handicap lines, totals)
   - Bet9ja key parsing
   - Args/Returns for all functions

Format for mappers:
```python
def map_sportybet_to_betpawa(market: SportybetMarket) -> MappingResult:
    """Transform SportyBet market data to Betpawa format.

    Looks up the market in MARKET_MAPPINGS by sportybet_id, parses any
    specifiers (handicap, total), and maps outcomes to Betpawa taxonomy.

    Args:
        market: Raw SportyBet market data with id, name, specifier, outcomes

    Returns:
        MappingResult with either:
        - success=True, data=MappedMarket
        - success=False, error=MappingError (UNKNOWN_MARKET, INVALID_SPECIFIER, etc.)

    Example:
        >>> result = map_sportybet_to_betpawa(sportybet_1x2_market)
        >>> if result.success:
        ...     print(result.data.betpawa_market_id)
    """
```

Do NOT change any functional code - only add/enhance docstrings.
  </action>
  <verify>python -m py_compile src/market_mapping/mappers/unified.py src/market_mapping/mappers/sportybet.py src/market_mapping/mappings/market_ids.py</verify>
  <done>All 13 market mapping files have module docstrings, all mapper functions document Args/Returns/Raises, type definitions explain their purpose</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `python -m py_compile src/db/**/*.py src/market_mapping/**/*.py` - All files compile
- [ ] Spot check: src/db/models/event.py has Event class docstring with Attributes and Relationships
- [ ] Spot check: src/market_mapping/mappers/sportybet.py has function docstrings with Args/Returns
- [ ] Spot check: src/market_mapping/mappings/market_ids.py explains MARKET_MAPPINGS structure
</verification>

<success_criteria>

- All 31 data layer files have module-level docstrings
- All SQLAlchemy models have class docstrings documenting purpose and relationships
- All mapper functions have docstrings with Args/Returns/Raises
- All TypedDict/dataclass types have docstrings explaining their purpose
- No functional code changes - documentation only
- All files compile without errors
</success_criteria>

<output>
After completion, create `.planning/phases/76-documentation-backend/76-02-SUMMARY.md`
</output>
