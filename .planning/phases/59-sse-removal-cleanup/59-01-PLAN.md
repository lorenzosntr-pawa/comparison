---
phase: 59-sse-removal-cleanup
plan: 01
type: execute
domain: api
---

<objective>
Remove SSE endpoints from backend and delete SSE-only frontend files.

Purpose: Clean up SSE infrastructure now that WebSocket is the primary transport for real-time updates.
Output: Backend without SSE endpoints, frontend without SSE-only files.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/58-websocket-ui-migration/58-02-SUMMARY.md

**Key files:**
@src/api/routes/scrape.py
@web/src/features/dashboard/hooks/use-scrape-progress.ts
@web/src/features/dashboard/hooks/index.ts
@web/src/features/scrape-runs/components/live-progress.tsx

**Prior decisions:**
- Phase 58: WebSocket-first with SSE fallback established
- Phase 57: WebSocket infrastructure complete with connection manager, message protocol, and bridge

**Context:**
SSE endpoints to remove:
- GET /scrape/stream (lines 146-343) - triggers new scrape with SSE streaming
- GET /scrape/runs/{run_id}/progress (lines 737-807) - observes existing scrape via SSE

SSE-only frontend files to delete:
- web/src/features/dashboard/hooks/use-scrape-progress.ts (uses /api/scrape/stream directly)
- web/src/features/scrape-runs/components/live-progress.tsx (uses /api/scrape/stream directly)

Keep (used by WebSocket):
- ProgressBroadcaster in broadcaster.py - WebSocket bridge subscribes to it
- /scrape/runs/active endpoint - used to discover active scrapes
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove SSE endpoints from backend</name>
  <files>src/api/routes/scrape.py</files>
  <action>
Remove two SSE endpoints from scrape.py:

1. Remove the `stream_scrape` function (GET /scrape/stream):
   - Located around lines 146-343
   - This is the SSE endpoint that triggers a new scrape and streams progress
   - The WebSocket bridge in run_scrape_background() should be kept but will be moved to a different trigger mechanism

2. Remove the `observe_scrape_progress` function (GET /scrape/runs/{run_id}/progress):
   - Located around lines 737-807
   - This is the SSE endpoint that observes an existing scrape
   - WebSocket handles this now via scrape_progress topic

3. Remove unused imports after deletion:
   - `StreamingResponse` from fastapi.responses (check if still needed by other endpoints)
   - Any SSE-specific imports

4. Keep the `get_active_scrapes` endpoint (GET /scrape/runs/active) - still useful

5. Keep the `trigger_scrape` endpoint (POST /scrape) - synchronous API trigger
  </action>
  <verify>
- `python -c "from src.api.routes.scrape import router; print('Import OK')"` succeeds
- `grep -c "text/event-stream" src/api/routes/scrape.py` returns 0
- `grep -c "StreamingResponse" src/api/routes/scrape.py` returns 0 (if no other use)
  </verify>
  <done>SSE endpoints removed from scrape.py, file still valid Python with no SSE references</done>
</task>

<task type="auto">
  <name>Task 2: Delete SSE-only frontend files and update exports</name>
  <files>
web/src/features/dashboard/hooks/use-scrape-progress.ts
web/src/features/dashboard/hooks/index.ts
web/src/features/scrape-runs/components/live-progress.tsx
  </files>
  <action>
1. Delete web/src/features/dashboard/hooks/use-scrape-progress.ts:
   - This file contains only SSE code using /api/scrape/stream
   - The useScrapeProgress hook from this file is NOT the same as scrape-runs/hooks/use-scrape-progress.ts

2. Update web/src/features/dashboard/hooks/index.ts:
   - Remove: `export { useScrapeProgress } from './use-scrape-progress'`
   - Remove: `export type { ScrapeProgress } from './use-scrape-progress'`
   - Keep other exports unchanged

3. Delete web/src/features/scrape-runs/components/live-progress.tsx:
   - This file is entirely SSE-based, using /api/scrape/stream
   - Check for imports - if used anywhere, note for next plan

4. Check if live-progress.tsx is imported anywhere:
   - Search for `import.*live-progress` or `LiveProgressPanel`
   - If found, note the files for 59-02 to update
  </action>
  <verify>
- `ls web/src/features/dashboard/hooks/use-scrape-progress.ts 2>/dev/null` returns "not found"
- `ls web/src/features/scrape-runs/components/live-progress.tsx 2>/dev/null` returns "not found"
- `grep -c "use-scrape-progress" web/src/features/dashboard/hooks/index.ts` returns 0
- `npx tsc --noEmit 2>&1 | head -20` shows no import errors for deleted files
  </verify>
  <done>SSE-only files deleted, index.ts updated, no broken imports</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Backend: `python -c "from src.api.routes.scrape import router"` succeeds
- [ ] Backend: No "text/event-stream" in scrape.py
- [ ] Frontend: Deleted files no longer exist
- [ ] Frontend: index.ts updated to remove deleted exports
- [ ] TypeScript: `npx tsc --noEmit` passes (no import errors)
</verification>

<success_criteria>
- SSE endpoints removed from backend
- SSE-only frontend files deleted
- Index exports updated
- No broken imports
- Ready for 59-02 (frontend simplification)
</success_criteria>

<output>
After completion, create `.planning/phases/59-sse-removal-cleanup/59-01-SUMMARY.md`
</output>
