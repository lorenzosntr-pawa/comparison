---
phase: 19-palimpsest-comparison-page
plan: 02
type: execute
---

<objective>
Add summary stat cards and filtering UI to the Coverage Comparison page.

Purpose: Display coverage landscape at a glance with filtering controls.
Output: Stat cards showing coverage metrics, functional filter controls.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/19-palimpsest-comparison-page/19-CONTEXT.md
@.planning/phases/19-palimpsest-comparison-page/19-01-SUMMARY.md

**Key files:**
@web/src/features/coverage/index.tsx
@web/src/features/coverage/hooks/use-coverage.ts
@web/src/features/dashboard/components/stats-cards.tsx
@web/src/features/matches/components/match-filters.tsx
@web/src/components/ui/card.tsx
@web/src/components/ui/input.tsx
@web/src/components/ui/select.tsx

**Tech stack available:**
- shadcn/ui Card, Input, Select components
- TanStack Query hooks from 19-01

**Established patterns:**
- Stats cards on dashboard use Card with CardHeader/CardContent
- Filters use controlled state with onChange handlers
- Reset filters on filter change (like matches page resets page)

**From CONTEXT.md:**
- Summary stat cards at top showing coverage percentages, absolute counts, gap counts
- Gap counts should be per-competitor (SportyBet gaps, Bet9ja gaps)
- Coverage status filter: All / BetPawa has / BetPawa missing
- Country/region filter
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create summary stat cards component</name>
  <files>web/src/features/coverage/components/stats-cards.tsx, web/src/features/coverage/components/index.ts</files>
  <action>
Create CoverageStatsCards component that displays coverage statistics:

Layout: Grid of 4-5 stat cards in a row (grid-cols-2 md:grid-cols-4 lg:grid-cols-5)

Cards to display:
1. **Total Events** - coverage.total_events with neutral styling
2. **Matched** - coverage.matched_count + match_rate% in green styling
3. **BetPawa Only** - coverage.betpawa_only_count in blue styling
4. **SportyBet Gaps** - by_platform['sportybet'].unmatched_events in orange styling
5. **Bet9ja Gaps** - by_platform['bet9ja'].unmatched_events in orange styling

Each card uses shadcn Card component:
- CardHeader with title (text-sm text-muted-foreground)
- CardContent with large number (text-2xl font-bold)
- Optional subtext for percentage/context

Props: { coverage: CoverageStats, isLoading?: boolean }
When isLoading, show Skeleton in place of numbers.

Export from components/index.ts barrel file.
  </action>
  <verify>cd web && npm run build passes</verify>
  <done>Stats cards component renders coverage metrics with appropriate styling</done>
</task>

<task type="auto">
  <name>Task 2: Create filter bar component with coverage and search filters</name>
  <files>web/src/features/coverage/components/filter-bar.tsx, web/src/features/coverage/components/index.ts</files>
  <action>
Create CoverageFilterBar component for filtering events:

Props:
- filters: { availability: 'all' | 'matched' | 'betpawa-only' | 'competitor-only', search: string, country?: string }
- onFiltersChange: (filters) => void
- countries?: string[] (for country filter options)

Layout: flex row with gap-4, items-center

Filter controls:
1. **Availability filter** - Button group (like matches page mode toggle):
   - All Events
   - Matched
   - BetPawa Only
   - Gaps (competitor-only)
   Use existing button group pattern from matches page.

2. **Search input** - Input with placeholder "Search tournaments or teams..."
   - Width: w-64 or flex-1 with max-w-xs
   - Debounce not needed (query refetches on change)

3. **Country filter** (optional, show if countries prop provided) - Select dropdown
   - Options: "All Countries" + unique countries from data
   - Width: w-48

Export from components/index.ts.
  </action>
  <verify>cd web && npm run build passes</verify>
  <done>Filter bar renders with availability toggle, search input, and optional country filter</done>
</task>

<task type="auto">
  <name>Task 3: Integrate stats cards and filters into coverage page</name>
  <files>web/src/features/coverage/index.tsx, web/src/features/coverage/hooks/use-coverage.ts</files>
  <action>
Update CoveragePage to use new components:

1. Add filter state:
   - useState for filters object: { availability, search, country }
   - Default: { availability: 'all', search: '', country: undefined }

2. Update usePalimpsestEvents hook call:
   - Pass filters as query params
   - Ensure hook refetches when filters change (include in queryKey)

3. Extract unique countries from tournaments data for country filter dropdown

4. Page layout:
   ```
   <div className="space-y-6">
     <div className="flex items-center justify-between">
       <h1>Coverage Comparison</h1>
       <span>{total} events</span>
     </div>

     <CoverageStatsCards coverage={data.coverage} isLoading={isPending} />

     <CoverageFilterBar
       filters={filters}
       onFiltersChange={setFilters}
       countries={uniqueCountries}
     />

     {/* Tournament table placeholder for next plan */}
     <div>Tournament data: {data?.tournaments.length} tournaments</div>
   </div>
   ```

5. Handle loading and error states appropriately
  </action>
  <verify>cd web && npm run dev, navigate to /coverage, verify stats cards show data and filters work</verify>
  <done>Coverage page displays stats cards and functional filter controls</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd web && npm run build` succeeds without errors
- [ ] Stats cards display coverage metrics from API
- [ ] Availability filter toggles work and refetch data
- [ ] Search input filters events
- [ ] Country filter dropdown shows unique countries (if implemented)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Stats cards show accurate coverage data
- Filters modify the events query
</success_criteria>

<output>
After completion, create `.planning/phases/19-palimpsest-comparison-page/19-02-SUMMARY.md`
</output>
