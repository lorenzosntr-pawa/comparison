---
phase: 19-palimpsest-comparison-page
plan: 03
type: execute
---

<objective>
Build tournament comparison table with three-column layout and expandable event rows.

Purpose: Enable users to see coverage gaps at a glance with drill-down capability.
Output: Interactive tournament table with visual coverage indicators and expandable event details.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/19-palimpsest-comparison-page/19-CONTEXT.md
@.planning/phases/19-palimpsest-comparison-page/19-01-SUMMARY.md
@.planning/phases/19-palimpsest-comparison-page/19-02-SUMMARY.md

**Key files:**
@web/src/features/coverage/index.tsx
@web/src/features/coverage/components/index.ts
@web/src/components/ui/table.tsx
@web/src/features/matches/components/match-table.tsx

**Tech stack available:**
- shadcn/ui Table components
- Lucide icons (ChevronDown, ChevronRight, Check, X)

**From CONTEXT.md:**
- Three-column layout: BetPawa | SportyBet | Bet9ja
- Click tournament row to expand and show events
- Color-coded: green = matched, red/orange = missing
- Gaps immediately visible, not hidden behind filters
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create tournament table component with three-column layout</name>
  <files>web/src/features/coverage/components/tournament-table.tsx, web/src/features/coverage/components/index.ts</files>
  <action>
Create TournamentTable component displaying tournaments with platform coverage:

Props:
- tournaments: TournamentGroup[]
- isLoading?: boolean

Table structure:
```
| Tournament          | BetPawa  | SportyBet | Bet9ja  | Total |
|---------------------|----------|-----------|---------|-------|
| ▶ Premier League    | ✓ 12     | ✓ 10      | ✓ 8     | 12    |
| ▼ La Liga           | ✓ 8      | ✓ 6       | ✗ 0     | 10    |
|   └ Event rows when expanded...                              |
```

Column headers:
- Tournament (with expand chevron space)
- BetPawa (count of events with betpawa in platforms)
- SportyBet (count of events with sportybet in platforms)
- Bet9ja (count of events with bet9ja in platforms)
- Total Events

Row styling:
- Clickable rows (cursor-pointer, hover:bg-muted/50)
- Expand/collapse chevron icon (ChevronRight when collapsed, ChevronDown when expanded)
- Platform cells show:
  - ✓ + count in green if platform has events (text-green-600)
  - ✗ in red/orange if platform has 0 events (text-orange-500)

Use useState to track expanded tournament IDs (Set<number>).
Toggle expansion on row click.

Loading state: Show Skeleton rows when isLoading.
  </action>
  <verify>cd web && npm run build passes</verify>
  <done>Tournament table renders with three-column platform layout and expandable rows</done>
</task>

<task type="auto">
  <name>Task 2: Create event rows component for expanded tournaments</name>
  <files>web/src/features/coverage/components/event-row.tsx, web/src/features/coverage/components/index.ts</files>
  <action>
Create EventRows component for displaying events within expanded tournament:

Props:
- events: PalimpsestEvent[]
- isExpanded: boolean

Render nothing if !isExpanded.

When expanded, render event rows as nested table rows:
```
|   Home vs Away      | BetPawa | SportyBet | Bet9ja | Kickoff     |
|---------------------|---------|-----------|--------|-------------|
|   Man Utd vs Arsenal| ✓       | ✓         | ✓      | Jan 25, 15:00|
|   Liverpool vs City | ✗       | ✓         | ✓      | Jan 25, 17:30|
```

For each event:
- Indent with padding-left or margin-left to show hierarchy
- Name: "{home_team} vs {away_team}"
- Platform cells:
  - ✓ (Check icon) in green if platform in event.platforms
  - ✗ (X icon) in orange if platform not in event.platforms
- Kickoff: Format datetime nicely (e.g., "Jan 25, 15:00")

Row styling based on availability:
- "matched": Normal background
- "betpawa-only": Subtle blue left border (border-l-2 border-l-blue-500/30)
- "competitor-only": Subtle orange left border (border-l-2 border-l-orange-500/30)

Use framer-motion or CSS transitions for smooth expand/collapse (optional - skip if adds complexity).
  </action>
  <verify>cd web && npm run build passes</verify>
  <done>Event rows render with platform indicators and availability styling</done>
</task>

<task type="auto">
  <name>Task 3: Integrate tournament table into coverage page</name>
  <files>web/src/features/coverage/index.tsx</files>
  <action>
Update CoveragePage to include the tournament table:

1. Import TournamentTable from components

2. Replace placeholder with TournamentTable:
   ```tsx
   <TournamentTable
     tournaments={data?.tournaments ?? []}
     isLoading={isPending}
   />
   ```

3. Add empty state handling:
   - If data loaded but tournaments.length === 0, show "No events found" message
   - Style consistently with other pages

4. Ensure filters affect the table:
   - usePalimpsestEvents should already pass filters
   - Table should re-render when data changes

Final page layout:
```
Coverage Comparison                    [X events]

[Stats Cards Row - 5 cards]

[Filter Bar - Availability | Search | Country]

[Tournament Table]
| Tournament      | BetPawa | SportyBet | Bet9ja | Total |
| ▶ Premier League| ✓ 12    | ✓ 10      | ✓ 8    | 12    |
| ▼ La Liga       | ✓ 8     | ✓ 6       | ✗ 0    | 10    |
|   Event 1...    |         |           |        |       |
|   Event 2...    |         |           |        |       |
```
  </action>
  <verify>cd web && npm run build passes, npm run dev shows table with data</verify>
  <done>Coverage page displays complete tournament table with filtering</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Coverage Comparison page with stats cards, filters, and expandable tournament table</what-built>
  <how-to-verify>
    1. Run: cd web && npm run dev
    2. Start API: cd .. && python -m src.api.app (if not running)
    3. Navigate to: http://localhost:5173/coverage
    4. Verify stats cards:
       - Total Events, Matched, BetPawa Only, SportyBet Gaps, Bet9ja Gaps display
       - Numbers match API response
    5. Test filters:
       - Click availability toggles (All, Matched, BetPawa Only, Gaps)
       - Type in search box, results filter
    6. Test tournament table:
       - Three platform columns visible (BetPawa, SportyBet, Bet9ja)
       - Green ✓ for platforms with events, orange ✗ for missing
       - Click tournament row to expand
       - Event rows appear with platform indicators
       - Competitor-only events have orange left border
    7. Confirm overall UX:
       - Layout is clear and readable
       - Gaps are immediately visible (not hidden)
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd web && npm run build` succeeds without errors
- [ ] Tournament table displays with three platform columns
- [ ] Expandable rows work (click to expand/collapse)
- [ ] Platform indicators show green ✓ or orange ✗
- [ ] Event rows have appropriate styling based on availability
- [ ] Human verification checkpoint passed
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Human verified the coverage page works correctly
- Phase 19 complete - v1.1 Palimpsest Comparison milestone ready for final review
</success_criteria>

<output>
After completion, create `.planning/phases/19-palimpsest-comparison-page/19-03-SUMMARY.md`
</output>
