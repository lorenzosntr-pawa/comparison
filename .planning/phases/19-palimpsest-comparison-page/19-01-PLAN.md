---
phase: 19-palimpsest-comparison-page
plan: 01
type: execute
---

<objective>
Set up Coverage Comparison page foundation with feature folder, API integration, and navigation.

Purpose: Establish the page infrastructure so subsequent plans can focus on UI components.
Output: Working page shell accessible via sidebar navigation, with data fetching hooks ready.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-palimpsest-comparison-page/19-CONTEXT.md
@.planning/phases/17-palimpsest-api-endpoints/17-01-SUMMARY.md
@.planning/phases/17-palimpsest-api-endpoints/17-02-SUMMARY.md

**Key files:**
@src/api/schemas/palimpsest.py
@src/api/routes/palimpsest.py
@web/src/lib/api.ts
@web/src/types/api.ts
@web/src/components/layout/app-sidebar.tsx
@web/src/App.tsx
@web/src/features/matches/index.tsx
@web/src/features/matches/hooks/use-matches.ts

**Tech stack available:**
- TanStack Query v5 with polling
- shadcn/ui with Tailwind v4
- React Router

**Established patterns:**
- Feature folders in web/src/features/ with index.tsx + components/ + hooks/
- API methods in web/src/lib/api.ts using fetchJson helper
- TypeScript types in web/src/types/api.ts
- Navigation in app-sidebar.tsx with navItems array

**Constraining decisions:**
- Phase 17: Palimpsest API endpoints at /api/palimpsest/coverage and /api/palimpsest/events
- Phase 17: Events grouped by tournament with coverage stats
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add TypeScript types and API methods for palimpsest endpoints</name>
  <files>web/src/types/api.ts, web/src/lib/api.ts</files>
  <action>
Add TypeScript interfaces matching the Pydantic schemas from src/api/schemas/palimpsest.py:

In web/src/types/api.ts, add:
- PlatformCoverage: { platform, total_events, matched_events, unmatched_events, match_rate }
- TournamentCoverage: { total, matched, betpawa_only, competitor_only }
- CoverageStats: { total_events, matched_count, betpawa_only_count, competitor_only_count, match_rate, by_platform: PlatformCoverage[] }
- PalimpsestEvent: { id, sportradar_id, name, home_team, away_team, kickoff, tournament_name, tournament_country, sport_name, availability, platforms: string[] }
- TournamentGroup: { tournament_id, tournament_name, tournament_country, sport_name, coverage: TournamentCoverage, events: PalimpsestEvent[] }
- PalimpsestEventsResponse: { coverage: CoverageStats, tournaments: TournamentGroup[] }

In web/src/lib/api.ts, add:
- getCoverage(): Promise<CoverageStats> - GET /palimpsest/coverage
- getPalimpsestEvents(params?: { availability?, platforms?, sport_id?, search?, sort? }): Promise<PalimpsestEventsResponse> - GET /palimpsest/events

Follow existing fetchJson pattern. Use URLSearchParams for query params like getEvents does.
  </action>
  <verify>TypeScript compiles without errors: cd web && npm run build</verify>
  <done>Types match Pydantic schemas, API methods callable</done>
</task>

<task type="auto">
  <name>Task 2: Create coverage feature folder with hooks and page shell</name>
  <files>web/src/features/coverage/index.tsx, web/src/features/coverage/hooks/use-coverage.ts, web/src/features/coverage/hooks/index.ts, web/src/features/coverage/components/index.ts</files>
  <action>
Create feature folder structure following matches/ pattern:

web/src/features/coverage/
├── index.tsx              # CoveragePage component
├── components/
│   └── index.ts           # Barrel export (empty for now)
└── hooks/
    ├── index.ts           # Barrel export
    └── use-coverage.ts    # TanStack Query hooks

In use-coverage.ts:
- useCoverage() - useQuery for GET /palimpsest/coverage, refetch every 60s
- usePalimpsestEvents(params) - useQuery for GET /palimpsest/events with params

Follow use-matches.ts pattern for query key structure and staleTime.

In index.tsx:
- Create CoveragePage component with basic shell:
  - Page title "Coverage Comparison"
  - Loading skeleton when data loading
  - Error display on error
  - Placeholder text "Coverage data will appear here" when data loaded
- Use useCoverage() and usePalimpsestEvents() hooks
- Export CoveragePage as named export
  </action>
  <verify>cd web && npm run build passes</verify>
  <done>Feature folder exists with working hooks and basic page component</done>
</task>

<task type="auto">
  <name>Task 3: Add navigation and routing for coverage page</name>
  <files>web/src/components/layout/app-sidebar.tsx, web/src/App.tsx</files>
  <action>
In app-sidebar.tsx:
- Import GitCompareArrows from lucide-react (or GitCompare if not available)
- Add nav item: { title: 'Coverage', url: '/coverage', icon: GitCompareArrows }
- Position after "Odds Comparison" and before "Scrape Runs" in navItems array

In App.tsx:
- Import CoveragePage from '@/features/coverage'
- Add route: <Route path="/coverage" element={<CoveragePage />} />
- Position with other feature routes

Note: Use "Coverage" as the short nav title (not "Coverage Comparison") to fit sidebar width.
  </action>
  <verify>cd web && npm run dev, navigate to /coverage in browser, page loads without errors</verify>
  <done>Coverage page accessible via sidebar navigation at /coverage</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd web && npm run build` succeeds without errors
- [ ] Navigate to /coverage shows page shell
- [ ] Coverage nav item appears in sidebar between Odds Comparison and Scrape Runs
- [ ] useCoverage and usePalimpsestEvents hooks fetch data from API
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Coverage page accessible and data fetching works
</success_criteria>

<output>
After completion, create `.planning/phases/19-palimpsest-comparison-page/19-01-SUMMARY.md`
</output>
