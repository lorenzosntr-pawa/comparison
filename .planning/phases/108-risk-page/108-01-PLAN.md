---
phase: 108-risk-page
plan: 01
type: execute
domain: frontend
---

<objective>
Create the Risk Monitoring page with status tabs, filters, and an alert table with expandable rows.

Purpose: Provide users with a dedicated interface to view, filter, and manage risk alerts detected during odds scraping.
Output: Working Risk Monitoring page at /risk-monitoring with tabs, filters, table, and acknowledge functionality.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase summaries (Phase 105-107 built alert detection and API):
@.planning/phases/105-investigation-schema/105-01-SUMMARY.md
@.planning/phases/106-backend-alert-detection/106-01-SUMMARY.md
@.planning/phases/107-alert-api/107-01-SUMMARY.md
@.planning/phases/107-alert-api/107-02-SUMMARY.md

# Backend API endpoints available (from Phase 107):
@src/api/routes/alerts.py
@src/api/schemas/alerts.py

# Frontend patterns to follow:
@web/src/features/storage/index.tsx
@web/src/features/storage/hooks/use-storage.ts
@web/src/routes.tsx

**Tech stack available:**
- TanStack Query v5 for data fetching
- shadcn/ui components (Card, Table, Badge, Tabs, Button, DropdownMenu)
- React Router for navigation
- date-fns for formatting

**Established patterns:**
- Feature folder structure: features/{name}/ with components/, hooks/, index.tsx
- TanStack Query hooks with queryKey arrays
- useMutation with queryClient.invalidateQueries for optimistic updates
- camelCase API responses (backend uses to_camel alias)

**API Endpoints (from Phase 107):**
- GET /alerts?status=&severity=&limit=&offset= → RiskAlertsResponse (alerts[], newCount, acknowledgedCount, pastCount)
- GET /alerts/stats → RiskAlertStatsResponse (byStatus, bySeverity, byType)
- PATCH /alerts/{id} → RiskAlertResponse (acknowledge/unacknowledge)

**Alert fields:**
id, eventId, bookmakerSlug, marketId, marketName, line, outcomeName, alertType, severity, changePercent, oldValue, newValue, competitorDirection, detectedAt, acknowledgedAt, status, eventKickoff
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create risk-monitoring feature hooks and types</name>
  <files>web/src/features/risk-monitoring/hooks/use-alerts.ts, web/src/features/risk-monitoring/hooks/index.ts</files>
  <action>
Create the risk-monitoring feature folder and hooks:

1. Create directory structure:
   - web/src/features/risk-monitoring/
   - web/src/features/risk-monitoring/hooks/

2. Create use-alerts.ts with:
   - TypeScript interfaces: RiskAlert, RiskAlertsResponse, AlertStats, AlertFilters
   - useAlerts(filters: AlertFilters) hook:
     - queryKey: ['alerts', filters] to include all filter params
     - queryFn: GET /alerts with status, severity, alertType, limit, offset as query params
     - Return type includes alerts array and status counts
   - useAlertStats() hook:
     - queryKey: ['alerts', 'stats']
     - queryFn: GET /alerts/stats
   - useAcknowledgeAlert() mutation:
     - mutationFn: PATCH /alerts/{id} with { acknowledged: true/false }
     - onSuccess: invalidateQueries(['alerts']) to refresh list

3. Create hooks/index.ts barrel export

Follow patterns from use-storage.ts (TanStack Query, api.get/api.patch, queryClient.invalidateQueries).
  </action>
  <verify>npx tsc --noEmit passes without errors in web/ directory</verify>
  <done>Hooks compile without errors and export correctly from index.ts</done>
</task>

<task type="auto">
  <name>Task 2: Create RiskMonitoringPage with tabs, filters, and table</name>
  <files>web/src/features/risk-monitoring/index.tsx, web/src/features/risk-monitoring/components/alert-table.tsx, web/src/features/risk-monitoring/components/index.ts, web/src/routes.tsx</files>
  <action>
Create the main page component:

1. Create index.tsx (RiskMonitoringPage):
   - Page title "Risk Monitoring" with total alert count badge
   - Status tabs using shadcn Tabs: "New ({count})", "Acknowledged ({count})", "Past ({count})"
   - Active tab sets status filter
   - Filter row with dropdowns: Severity (All/Warning/Elevated/Critical), Type (All/Price Change/Direction Disagreement/Availability)
   - Use useAlerts hook with current filters
   - Render AlertTable component with alerts data
   - Loading state with Skeleton
   - Empty state when no alerts match filters
   - Pagination at bottom (simple "Load more" or page numbers)

2. Create components/alert-table.tsx:
   - Table with columns: Event, Market, Type, Change%, Severity, Detected, Actions
   - Each row expandable (click to expand/collapse) showing full details:
     - Bookmaker, Old Value → New Value, Outcome Name, Competitor Direction (if applicable)
     - Event kickoff time, Acknowledged at (if applicable)
   - Severity badges: Warning (yellow), Elevated (orange), Critical (red)
   - Alert type badges: Price Change, Direction Disagreement, Availability
   - Actions column: Acknowledge button (or "Acknowledged" badge if already acknowledged)
   - Acknowledge button calls useAcknowledgeAlert mutation
   - Expandable row pattern: useState for expandedRows Set<number>, toggle on row click

3. Create components/index.ts barrel export

4. Update routes.tsx:
   - Import RiskMonitoringPage from '@/features/risk-monitoring'
   - Add route: <Route path="/risk-monitoring" element={<RiskMonitoringPage />} />

5. Add sidebar link (in appropriate layout component if it exists, or note for Phase 110)

Style using existing patterns: shadcn Card for container, Table for data, Badge for status indicators, Button for actions.
  </action>
  <verify>npm run dev starts without errors, navigate to /risk-monitoring shows the page structure</verify>
  <done>Risk Monitoring page renders with tabs, filters visible, and table structure (may be empty if no alerts exist yet)</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Risk Monitoring page with status tabs, filters, and alert table</what-built>
  <how-to-verify>
    1. Run: cd web && npm run dev
    2. Visit: http://localhost:5173/risk-monitoring
    3. Verify: Page loads with "Risk Monitoring" title
    4. Verify: Three tabs visible (New, Acknowledged, Past) with counts (may be 0)
    5. Verify: Filter dropdowns for Severity and Type are present
    6. Verify: Table structure shows with column headers
    7. Verify: Switching tabs changes the displayed alerts
    8. If alerts exist: Click a row to expand and see details
    9. If alerts exist: Click Acknowledge button and confirm it updates
    10. Check browser console for any errors
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `cd web && npx tsc --noEmit` passes without errors
- [ ] `cd web && npm run dev` starts without errors
- [ ] /risk-monitoring route loads the page
- [ ] Tabs switch and filter the displayed alerts
- [ ] Filters (severity, type) narrow results appropriately
- [ ] Table rows can expand to show details
- [ ] Acknowledge button updates alert status (if alerts exist)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript or runtime errors
- Risk Monitoring page functional with tabs, filters, and table
- User can acknowledge alerts through the UI
</success_criteria>

<output>
After completion, create `.planning/phases/108-risk-page/108-01-SUMMARY.md`:

# Phase 108 Plan 01: Risk Monitoring Page Summary

**[Substantive one-liner]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `web/src/features/risk-monitoring/hooks/use-alerts.ts` - TanStack Query hooks
- `web/src/features/risk-monitoring/index.tsx` - Main page component
- `web/src/features/risk-monitoring/components/alert-table.tsx` - Table with expandable rows
- `web/src/routes.tsx` - Added /risk-monitoring route

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase complete, ready for Phase 109: Real-Time Updates
</output>
