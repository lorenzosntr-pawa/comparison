---
phase: 22-history-retention
plan: 04
type: execute
---

<objective>
Redesign Settings page with compact 4-row layout including retention settings and cleanup controls.

Purpose: More efficient use of space with all settings visible, adding new retention configuration.
Output: Redesigned Settings page with compact cards and new retention/cleanup controls.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/22-history-retention/22-CONTEXT.md

# Key files
@web/src/features/settings/index.tsx
@web/src/features/settings/components/interval-selector.tsx
@web/src/features/settings/components/platform-toggles.tsx
@web/src/features/settings/hooks/use-settings.ts
@web/src/types/api.ts

**From 22-CONTEXT.md - Settings Page Layout (4 rows, compact cards):**
- Row 1: Scheduler control | Scraping interval (2 compact cards)
- Row 2: Platform selection (full-width card, bookmakers displayed horizontally)
- Row 3: Odds retention | Match retention (2 compact cards)
- Row 4: Cleanup frequency | Manage Data button

**Current state:**
- 3 large cards in single column
- Cards have CardHeader with title/description + CardContent
- Need to make more compact while maintaining usability
</context>

<tasks>

<task type="auto">
  <name>Task 1: Redesign settings layout to compact 4-row grid</name>
  <files>web/src/features/settings/index.tsx, web/src/features/settings/components/platform-toggles.tsx</files>
  <action>
Update web/src/features/settings/index.tsx:

1. Replace single-column grid with 4-row layout:
```tsx
<div className="space-y-4">
  <h1 className="text-2xl font-bold">Settings</h1>

  {/* Row 1: Scheduler + Interval */}
  <div className="grid grid-cols-2 gap-4">
    <CompactCard title="Scheduler" description="Pause/resume scraping">
      <SchedulerControl />
    </CompactCard>
    <CompactCard title="Interval" description="Scrape frequency">
      <IntervalSelector />
    </CompactCard>
  </div>

  {/* Row 2: Platforms (full width) */}
  <Card>
    <CardHeader className="pb-3">
      <CardTitle className="text-base">Platforms</CardTitle>
    </CardHeader>
    <CardContent className="pt-0">
      <PlatformToggles horizontal />
    </CardContent>
  </Card>

  {/* Row 3: Retention settings */}
  <div className="grid grid-cols-2 gap-4">
    <CompactCard title="Odds Retention" description="Days to keep snapshots">
      <RetentionSelector field="oddsRetentionDays" />
    </CompactCard>
    <CompactCard title="Match Retention" description="Days to keep matches">
      <RetentionSelector field="matchRetentionDays" />
    </CompactCard>
  </div>

  {/* Row 4: Cleanup + Manage */}
  <div className="grid grid-cols-2 gap-4">
    <CompactCard title="Cleanup" description="Auto-cleanup frequency">
      <CleanupFrequencySelector />
    </CompactCard>
    <CompactCard title="Data" description="View and manage stored data">
      <ManageDataButton />
    </CompactCard>
  </div>
</div>
```

2. Create CompactCard component (inline or separate file):
```tsx
function CompactCard({ title, description, children }) {
  return (
    <Card>
      <CardHeader className="pb-2 pt-4 px-4">
        <CardTitle className="text-base">{title}</CardTitle>
        <CardDescription className="text-xs">{description}</CardDescription>
      </CardHeader>
      <CardContent className="px-4 pb-4 pt-0">
        {children}
      </CardContent>
    </Card>
  )
}
```

3. Update PlatformToggles to support horizontal prop:
- When horizontal=true, display toggles in a flex row instead of column
- Use flex-wrap for smaller screens
  </action>
  <verify>cd web && npx tsc --noEmit</verify>
  <done>Settings page has compact 4-row layout. Existing components adapted for compact display.</done>
</task>

<task type="auto">
  <name>Task 2: Create retention and cleanup control components</name>
  <files>web/src/features/settings/components/retention-selector.tsx, web/src/features/settings/components/cleanup-frequency-selector.tsx, web/src/features/settings/components/manage-data-button.tsx, web/src/features/settings/components/index.ts, web/src/features/settings/hooks/use-settings.ts</files>
  <action>
Create web/src/features/settings/components/retention-selector.tsx:
```tsx
interface RetentionSelectorProps {
  field: 'oddsRetentionDays' | 'matchRetentionDays'
}

export function RetentionSelector({ field }: RetentionSelectorProps) {
  const { settings, updateSettings, isUpdating } = useSettings()

  const options = [7, 14, 30, 60, 90, 180, 365]
  const value = settings?.[field] ?? 30

  return (
    <Select
      value={String(value)}
      onValueChange={(v) => updateSettings({ [field]: Number(v) })}
      disabled={isUpdating}
    >
      <SelectTrigger className="w-full">
        <SelectValue />
      </SelectTrigger>
      <SelectContent>
        {options.map((days) => (
          <SelectItem key={days} value={String(days)}>
            {days} days
          </SelectItem>
        ))}
      </SelectContent>
    </Select>
  )
}
```

Create web/src/features/settings/components/cleanup-frequency-selector.tsx:
- Similar pattern with options: 6, 12, 24, 48, 72, 168 hours
- Display as "6 hours", "12 hours", "1 day", "2 days", "3 days", "1 week"

Create web/src/features/settings/components/manage-data-button.tsx:
```tsx
export function ManageDataButton() {
  const [open, setOpen] = useState(false)

  return (
    <>
      <Button variant="outline" className="w-full" onClick={() => setOpen(true)}>
        <Database className="mr-2 h-4 w-4" />
        Manage Data
      </Button>
      <ManageDataDialog open={open} onOpenChange={setOpen} />
    </>
  )
}
```
Note: ManageDataDialog will be created in Plan 22-05. For now, create a placeholder that just shows "Coming soon".

Update use-settings.ts to handle new fields if needed.

Export all new components from index.ts.
  </action>
  <verify>cd web && npx tsc --noEmit</verify>
  <done>Retention selectors, cleanup frequency selector, and manage data button created. All components exported.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Redesigned Settings page with compact 4-row layout</what-built>
  <how-to-verify>
    1. Run: cd web && npm run dev
    2. Visit: http://localhost:5173/settings
    3. Verify layout:
       - Row 1: Scheduler control and Scraping interval side-by-side
       - Row 2: Platform selection full-width with horizontal toggles
       - Row 3: Odds retention and Match retention side-by-side
       - Row 4: Cleanup frequency and Manage Data button side-by-side
    4. Test interactions:
       - Change retention days (should save)
       - Change cleanup frequency (should save)
       - Click Manage Data (shows placeholder dialog)
    5. Check responsive: Cards should stack on mobile
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Settings page has 4-row compact layout
- [ ] All existing settings still work (scheduler, interval, platforms)
- [ ] Retention selectors update settings correctly
- [ ] Cleanup frequency selector works
- [ ] Manage Data button opens placeholder dialog
- [ ] Layout is responsive (stacks on mobile)
- [ ] No TypeScript errors
</verification>

<success_criteria>

- Settings page compact and organized in 4 rows
- All settings accessible and functional
- New retention/cleanup controls integrated
- Visual polish maintained
- Human verified layout looks correct
</success_criteria>

<output>
After completion, create `.planning/phases/22-history-retention/22-04-SUMMARY.md`
</output>
