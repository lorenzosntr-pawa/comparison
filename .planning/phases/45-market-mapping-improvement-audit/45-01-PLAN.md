---
phase: 45-market-mapping-improvement-audit
plan: 01
type: execute
---

<objective>
Measure improvements from Phase 44 market mapping fixes and identify remaining gaps for potential Phase 46.

Purpose: Quantify the impact of TMGHO/TMGAW fixes, 20 new mappings, and combo market parameter handling - then determine if additional fix phases are needed.
Output: Improvement report with before/after metrics and prioritized recommendations.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase 43 baseline (for comparison)
@.planning/phases/43-market-mapping-audit/AUDIT-FINDINGS.md
@.planning/phases/43-market-mapping-audit/43-01-SUMMARY.md

# Phase 44 fixes applied
@.planning/phases/44-high-priority-market-mappings/44-01-SUMMARY.md
@.planning/phases/44-high-priority-market-mappings/44-02-SUMMARY.md
@.planning/phases/44-high-priority-market-mappings/44-03-SUMMARY.md

# Existing audit script
@src/scripts/audit_market_mapping.py

**Phase 43 Baseline Metrics (for comparison):**
- SportyBet: 47.3% success (8,323/17,605 markets)
- Bet9ja: 36.1% success (5,580/15,465 markets)
- 380 unique unmapped market types

**Phase 44 Fixes Applied:**
1. 44-01: TMGHO/TMGAW bet9ja outcomes corrected (+198 occurrences)
2. 44-02: 20 new MarketMapping entries (~1,800 occurrences)
3. 44-03: 6 combo markets added to O/U handling (~1,500 occurrences)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Re-run market mapping audit</name>
  <files>src/scripts/audit_market_mapping.py, .planning/phases/45-market-mapping-improvement-audit/audit_results.json</files>
  <action>
Run the existing audit_market_mapping.py script against current database to generate fresh metrics. Save raw output to audit_results.json in phase directory.

Command: `python -m src.scripts.audit_market_mapping`

Capture:
- Total events analyzed
- Platform coverage (total/mapped/failed for SportyBet and Bet9ja)
- Error code breakdown (UNKNOWN_MARKET, UNKNOWN_PARAM_MARKET, NO_MATCHING_OUTCOMES, UNSUPPORTED_PLATFORM)
- Unique unmapped market types count
  </action>
  <verify>Audit script completes without errors and generates output</verify>
  <done>Fresh audit data available showing current mapping success rates</done>
</task>

<task type="auto">
  <name>Task 2: Generate improvement comparison report</name>
  <files>.planning/phases/45-market-mapping-improvement-audit/IMPROVEMENT-REPORT.md</files>
  <action>
Create IMPROVEMENT-REPORT.md comparing Phase 43 baseline vs current metrics:

1. **Platform Success Rate Changes:**
   - SportyBet: 47.3% → X% (delta)
   - Bet9ja: 36.1% → X% (delta)

2. **Error Code Improvements:**
   - UNKNOWN_MARKET: Phase 43 count → current (expected -~1,800 from 44-02)
   - UNKNOWN_PARAM_MARKET: Phase 43 count → current (expected -~1,500 from 44-03)
   - NO_MATCHING_OUTCOMES: Phase 43 count → current (expected -198 from 44-01)

3. **Phase 44 Fix Verification:**
   - Verify TMGHO/TMGAW no longer appear as NO_MATCHING_OUTCOMES
   - Verify new mappings (home_no_bet, first_goal, etc.) now succeed
   - Verify combo markets (1X2OU, DCOU, 37, 547) now succeed with line params

4. **Remaining Gap Analysis:**
   - Top 10 remaining UNKNOWN_MARKET by frequency
   - Top 5 remaining UNKNOWN_PARAM_MARKET if any
   - Assessment: is Phase 46 needed?
  </action>
  <verify>IMPROVEMENT-REPORT.md created with before/after comparison</verify>
  <done>Clear quantified improvement metrics and remaining gap analysis documented</done>
</task>

<task type="auto">
  <name>Task 3: Update STATE.md and recommend next steps</name>
  <files>.planning/STATE.md, .planning/ROADMAP.md</files>
  <action>
Based on improvement report:

1. **Update STATE.md:**
   - Record Phase 45 completion with improvement metrics
   - Update "Key Patterns" if new mapping patterns discovered
   - Update "Next" field based on findings

2. **Determine Phase 46 recommendation:**
   - If success rates > 70%: v1.8 likely complete, mark milestone ready to ship
   - If success rates 50-70%: Recommend Phase 46 for remaining HIGH priority gaps
   - If success rates < 50%: Major gaps remain, prioritize critical markets

3. **Update ROADMAP.md Phase 45:**
   - Mark 45-01 as complete
   - Add Phase 46 details if recommended (or mark v1.8 complete if not needed)
  </action>
  <verify>STATE.md updated, ROADMAP.md updated, next steps clear</verify>
  <done>Project state reflects Phase 45 findings with clear recommendation for v1.8 completion or continuation</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Audit script ran successfully with current data
- [ ] IMPROVEMENT-REPORT.md shows before/after comparison
- [ ] Phase 44 fixes verified (TMGHO/TMGAW, new mappings, combo params)
- [ ] STATE.md updated with Phase 45 results
- [ ] ROADMAP.md updated with Phase 46 recommendation or v1.8 completion status
</verification>

<success_criteria>
- All tasks completed
- Clear quantified improvement from Phase 44 (expected: +3,500 occurrences mappable)
- Remaining gaps identified and prioritized
- Next steps documented (Phase 46 or v1.8 ship)
</success_criteria>

<output>
After completion, create `.planning/phases/45-market-mapping-improvement-audit/45-01-SUMMARY.md`:

# Phase 45 Plan 01: Market Mapping Improvement Audit Summary

**[Substantive one-liner - e.g., "Market mapping improved from X% to Y%, remaining gaps identified for Phase 46"]**

## Accomplishments
- [Key metrics improvement]
- [Phase 44 fixes verified]
- [Remaining gaps identified]

## Files Created/Modified
- `IMPROVEMENT-REPORT.md` - Before/after comparison
- `STATE.md` - Updated with Phase 45 results
- `ROADMAP.md` - Updated with next steps

## Decisions Made
[Phase 46 recommendation or v1.8 completion decision]

## Issues Encountered
[Any unexpected findings]

## Next Step
[Phase 46 plan or v1.8 ship preparation]
</output>
