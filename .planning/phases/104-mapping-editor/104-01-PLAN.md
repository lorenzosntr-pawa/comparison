---
phase: 104-mapping-editor
plan: 01
type: execute
domain: react-ui
---

<objective>
Create the mapping editor page with routing and left panel showing source market details.

Purpose: Establish the editor foundation that users navigate to from the dashboard high-priority section.
Output: Working editor page accessible via /mappings/editor/:unmappedId with source market details displayed.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase summaries (dependencies)
@.planning/phases/103-mapping-dashboard/103-04-SUMMARY.md
@.planning/phases/101-backend-foundation/101-03-SUMMARY.md

# Key files
@web/src/features/mappings/index.tsx
@web/src/features/mappings/components/high-priority-unmapped.tsx
@src/api/routes/unmapped.py
@src/api/schemas/unmapped.py

**Tech stack available:** React, TanStack Query v5, shadcn/ui, Tailwind v4
**Established patterns:** Features in web/src/features/, hooks in hooks/, components in components/
**Constraining decisions:**
- High-priority click handlers stubbed with TODO for Phase 104 navigation (103-04)
- UnmappedMarketDetailResponse includes sample_outcomes for editor context
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create mapping editor page and route</name>
  <files>web/src/features/mappings/editor/index.tsx, web/src/features/mappings/editor/hooks/use-unmapped-detail.ts, web/src/App.tsx</files>
  <action>
Create the mapping editor feature structure:
1. Create `web/src/features/mappings/editor/index.tsx` - main editor page component
2. Create `web/src/features/mappings/editor/hooks/use-unmapped-detail.ts` - hook for GET /api/unmapped/:id
3. Add route `/mappings/editor/:unmappedId` in App.tsx

Editor page structure:
- Two-column layout: left (source market) and right (target mapping) - right panel placeholder for now
- Left panel shows: source platform badge, market name, external ID, occurrence count, sample outcomes
- Loading and error states using existing shadcn patterns

Hook should:
- Accept unmappedId as param
- Return useQuery with UnmappedMarketDetailResponse type
- Match existing hook patterns (useMappingStats, etc.)

Route pattern: match existing `/historical-analysis/:eventId` dynamic route pattern.
  </action>
  <verify>Navigate to /mappings/editor/1 shows editor page layout (may 404 if ID doesn't exist, but route works)</verify>
  <done>Editor page accessible via route, displays loading state, fetches unmapped detail on valid ID</done>
</task>

<task type="auto">
  <name>Task 2: Create left panel source market component</name>
  <files>web/src/features/mappings/editor/components/source-market-panel.tsx, web/src/features/mappings/editor/components/index.ts</files>
  <action>
Create SourceMarketPanel component displaying:
1. Header with platform badge (reuse getSourceBadge pattern from high-priority-unmapped.tsx)
2. Market name prominently displayed
3. External market ID in muted text
4. Stats row: occurrence count, first seen, last seen (relative time using date-fns or simple format)
5. Sample outcomes section:
   - Card or bordered section
   - Display each outcome from sample_outcomes array
   - Show outcome name/desc and any available fields
   - Handle empty/null sample_outcomes gracefully

Props interface:
```typescript
interface SourceMarketPanelProps {
  market: UnmappedMarketDetailResponse;
}
```

Use Card component from shadcn for consistent styling. Left panel is informational only - no form inputs here.
  </action>
  <verify>npm run build passes, SourceMarketPanel renders sample outcomes correctly</verify>
  <done>SourceMarketPanel shows all unmapped market details including sample outcomes</done>
</task>

<task type="auto">
  <name>Task 3: Wire navigation from dashboard high-priority section</name>
  <files>web/src/features/mappings/components/high-priority-unmapped.tsx</files>
  <action>
Update HighPriorityRow to navigate to mapping editor on click:
1. Import useNavigate from react-router-dom
2. Replace the TODO console.log in handleClick with:
   ```typescript
   navigate(`/mappings/editor/${item.id}`)
   ```
3. Add visual affordance indicating clickable (already has cursor-pointer, hover state)

This completes the flow from dashboard â†’ editor that was stubbed in Phase 103.
  </action>
  <verify>Click high-priority item in dashboard, navigates to /mappings/editor/:id, editor loads with correct market</verify>
  <done>Clicking high-priority unmapped market navigates to editor with market details displayed</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Route /mappings/editor/:unmappedId renders editor page
- [ ] Editor fetches and displays unmapped market details
- [ ] Sample outcomes display in left panel
- [ ] Dashboard high-priority items navigate to editor
- [ ] Back navigation works (browser back button)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Editor foundation in place for subsequent plans
</success_criteria>

<output>
After completion, create `.planning/phases/104-mapping-editor/104-01-SUMMARY.md`
</output>
