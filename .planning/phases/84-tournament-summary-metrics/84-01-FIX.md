---
phase: 84-tournament-summary-metrics
plan: 84-01-FIX
type: fix
---

<objective>
Fix 1 UAT blocker issue from plan 84-01.

Source: 84-01-ISSUES.md
Priority: 1 blocker (UAT-001: page_size validation error)

The useTournaments hook requests page_size=1000 but the API maximum is 100, causing 422 validation errors on page load.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

**Issues being fixed:**
@.planning/phases/84-tournament-summary-metrics/84-01-ISSUES.md

**Original plan for reference:**
@.planning/phases/84-tournament-summary-metrics/84-01-PLAN.md

**Key file to fix:**
@web/src/features/historical-analysis/hooks/use-tournaments.ts
</context>

<tasks>
<task type="auto">
  <name>Fix UAT-001: Implement paginated fetching in useTournaments hook</name>
  <files>web/src/features/historical-analysis/hooks/use-tournaments.ts</files>
  <action>
Fix the page_size validation error by implementing paginated fetching:

1. Change initial page_size from 1000 to 100 (the API maximum)
2. Implement a loop that fetches all pages until all events are retrieved:
   - Start with page 1
   - After each response, check if there are more pages (response.events.length === page_size)
   - Continue fetching subsequent pages until all events are collected
   - Concatenate all events before processing
3. The rest of the logic (tournament extraction, metrics calculation) remains the same

Pattern to follow:
```typescript
let allEvents: MatchedEvent[] = []
let page = 1
const pageSize = 100

while (true) {
  const response = await api.getEvents({
    page,
    page_size: pageSize,
    kickoff_from: kickoffFrom,
    kickoff_to: kickoffTo,
  })

  allEvents = allEvents.concat(response.events)

  // If we got fewer events than requested, we've reached the end
  if (response.events.length < pageSize) break

  page++
}

// Then process allEvents instead of response.events
```

This ensures all events are fetched regardless of total count while respecting API limits.
  </action>
  <verify>
1. Navigate to /historical-analysis
2. Page should load without 422 error
3. Tournament list should display correctly with all tournaments from the date range
  </verify>
  <done>
- Historical Analysis page loads successfully
- No 422 validation errors
- Tournaments are displayed with correct event counts and metrics
- Pagination fetches all events when more than 100 exist in the date range
  </done>
</task>
</tasks>

<verification>
Before declaring plan complete:
- [ ] Page loads without errors
- [ ] Tournament list displays
- [ ] API calls use page_size â‰¤ 100
- [ ] Build succeeds without TypeScript errors
</verification>

<success_criteria>
- UAT-001 resolved: page_size validation error fixed
- Historical Analysis page functional
- Ready for re-verification
</success_criteria>

<output>
After completion, create `.planning/phases/84-tournament-summary-metrics/84-01-FIX-SUMMARY.md`
</output>
