---
phase: 84.2-tournament-detail-page
plan: 01-FIX
subsystem: ui
tags: [tanstack-query, historical-analysis, api]

# Dependency graph
requires:
  - phase: 84.2-tournament-detail-page
    provides: Tournament detail page with market cards
provides:
  - Fixed useTournamentMarkets to fetch ALL markets via event detail endpoint
affects: []

# Tech tracking
tech-stack:
  added: []
  patterns:
    - Concurrent API fetching with batch limit (CONCURRENT_FETCHES=5)
    - Full event detail fetch for complete market data

key-files:
  created: []
  modified:
    - web/src/features/historical-analysis/hooks/use-tournament-markets.ts

key-decisions:
  - "Fetch full event details instead of relying on inline_odds summary"
  - "Use Promise.all with batching (5 concurrent) to balance speed vs API load"

patterns-established:
  - "When inline_odds lacks data, fetch full EventDetailResponse for markets_by_bookmaker"

issues-created: []

# Metrics
duration: 5min
completed: 2026-02-11
---

# Phase 84.2 Plan 01 FIX Summary

**Fixed Tournament Detail to show ALL markets by fetching full event details instead of inline_odds summary**

## Performance

- **Duration:** 5 min
- **Started:** 2026-02-11
- **Completed:** 2026-02-11
- **Tasks:** 1 + 1 checkpoint
- **Files modified:** 1

## Accomplishments

- Fixed UAT-001: Tournament detail page now shows ALL markets (not just 4 tracked)
- Updated `useTournamentMarkets` hook to fetch full event details via `api.getEventDetail()`
- Extract markets from `markets_by_bookmaker` which contains complete market list
- Added concurrent fetching with 5 parallel requests to balance speed and API load

## Task Commits

1. **Task 1: Update useTournamentMarkets hook** - `efe9885` (fix)

## Files Created/Modified

- `web/src/features/historical-analysis/hooks/use-tournament-markets.ts` - Changed to fetch EventDetailResponse and use markets_by_bookmaker

## Decisions Made

- Used `markets_by_bookmaker` from EventDetailResponse instead of `inline_odds` from MatchedEvent
- Set CONCURRENT_FETCHES=5 to balance API load with performance
- Increased staleTime to 10 minutes since we now make more API calls

## Root Cause Analysis

The original implementation extracted markets from `betpawa.inline_odds`, which is a **summary field** designed for event list views containing only the 4 main markets (1X2, Over/Under 2.5, BTTS, Double Chance).

The complete market data is only available via the event detail endpoint (`/api/events/{id}`) in the `markets_by_bookmaker` array, which contains ALL markets offered by each bookmaker.

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None

## Next Phase Readiness

Ready for re-verification via `/gsd:verify-work 84.2` or proceeding to Phase 85.

---
*Phase: 84.2-tournament-detail-page*
*Plan: 01-FIX*
*Completed: 2026-02-11*
