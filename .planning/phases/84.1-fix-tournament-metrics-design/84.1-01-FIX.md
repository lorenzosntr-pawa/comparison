---
phase: 84.1-fix-tournament-metrics-design
plan: 84.1-01-FIX
type: fix
---

<objective>
Fix 5 UAT issues from plan 84.1-01: simplify tournament card display.

Source: 84.1-01-ISSUES.md
Priority: 0 critical, 5 major, 0 minor

All issues stem from over-engineered display that confuses rather than informs. The fix is to simplify: remove visual clutter and present only essential data clearly.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

**Issues being fixed:**
@.planning/phases/84.1-fix-tournament-metrics-design/84.1-01-ISSUES.md

**Original plan for reference:**
@.planning/phases/84.1-fix-tournament-metrics-design/84.1-01-PLAN.md

**Key file:**
@web/src/features/historical-analysis/components/tournament-list.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix UAT-001 - Remove CoverageBar from tournament cards</name>
  <files>web/src/features/historical-analysis/components/tournament-list.tsx</files>
  <action>
1. In TournamentCard component (~line 232-238), remove the CoverageBar component from the metrics row.

2. The CoverageBar component definition can stay in the file (may be useful for other views later), but remove its usage in TournamentCard.

3. Remove the entire line:
```tsx
<CoverageBar coverageByBookmaker={tournament.coverageByBookmaker} />
```

This addresses UAT-001: The 3 colored coverage rows at bottom of each card are removed.
  </action>
  <verify>npm run type-check passes, tournament cards no longer show coverage bars</verify>
  <done>Tournament cards show only margin breakdown, no coverage bar rows</done>
</task>

<task type="auto">
  <name>Task 2: Fix UAT-002/003/004 - Simplify MarginBadge display</name>
  <files>web/src/features/historical-analysis/components/tournament-list.tsx</files>
  <action>
1. Simplify the MarginBadge component (lines 124-163) to show only the margin value without:
   - Color coding (remove green/red text classes) → fixes UAT-002
   - Delta in parentheses (remove comparison logic) → fixes UAT-003
   - Trend indicator (remove TrendIndicator) → fixes UAT-004

2. Replace the MarginBadge component with a simplified version:
```tsx
function MarginBadge({
  avgMargin,
}: {
  avgMargin: number | null
}) {
  if (avgMargin === null) {
    return <span className="text-muted-foreground">—</span>
  }

  return (
    <span className="font-medium">
      {avgMargin.toFixed(1)}%
    </span>
  )
}
```

3. Update MarketBreakdown to only pass avgMargin (remove competitorAvgMargin and trend props).

This addresses:
- UAT-002: No more color coding
- UAT-003: No more confusing parenthesis values
- UAT-004: No more unclear trend arrows
  </action>
  <verify>npm run type-check passes, margins show as plain text values only</verify>
  <done>Margin values display as plain "X.X%" without colors, deltas, or trend indicators</done>
</task>

<task type="auto">
  <name>Task 3: Fix UAT-005 - Handle negative margins</name>
  <files>web/src/features/historical-analysis/hooks/use-tournaments.ts</files>
  <action>
1. In the margin calculation, negative margins should not occur for bookmaker overround. If a margin is calculated as negative, it likely means:
   - Bad data (odds that don't make sense)
   - Calculation error

2. Add a guard in the MarginBadge component OR the hook to filter out negative margins:

Option A (in component - simpler): If avgMargin < 0, treat as null (show "—")
Option B (in hook - cleaner): Filter out negative margin values during aggregation

Implement Option A in MarginBadge:
```tsx
function MarginBadge({
  avgMargin,
}: {
  avgMargin: number | null
}) {
  // Negative margins indicate bad data - treat as no data
  if (avgMargin === null || avgMargin < 0) {
    return <span className="text-muted-foreground">—</span>
  }

  return (
    <span className="font-medium">
      {avgMargin.toFixed(1)}%
    </span>
  )
}
```

This addresses UAT-005: Negative values no longer displayed, shown as "—" instead.
  </action>
  <verify>npm run type-check passes, negative margin values render as "—"</verify>
  <done>Negative margins handled gracefully (shown as dash, not confusing negative numbers)</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All 5 UAT issues addressed
- [ ] `npm run type-check` passes
- [ ] Tournament cards show clean, simple margin display
- [ ] No colored coverage bars
- [ ] No colored margin text
- [ ] No parenthesis delta values
- [ ] No trend arrows
- [ ] Negative margins shown as "—"
</verification>

<success_criteria>
- UAT-001: CoverageBar removed from cards
- UAT-002: No color coding on margins
- UAT-003: No parenthesis/delta values
- UAT-004: No trend indicators
- UAT-005: Negative margins handled as no-data
- Tests pass
- Ready for re-verification
</success_criteria>

<output>
After completion, create `.planning/phases/84.1-fix-tournament-metrics-design/84.1-01-FIX-SUMMARY.md`
</output>
