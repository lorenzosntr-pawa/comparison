---
phase: 91-event-details-ui
plan: 01
type: execute
---

<objective>
Apply availability styling to Event Details page for consistency with Odds Comparison.

Purpose: Users see consistent unavailable market styling across both list and detail views.
Output: OddsBadge component with three-state availability rendering, MarketRow passing availability data.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/90-odds-comparison-ui/90-01-SUMMARY.md

# Key files from Phase 90 (availability patterns established)
@web/src/features/matches/lib/market-utils.ts
@web/src/features/matches/components/match-table.tsx

# Files to modify
@web/src/features/matches/components/odds-badge.tsx
@web/src/features/matches/components/market-row.tsx
@web/src/features/matches/components/market-grid.tsx

# Types with availability fields
@web/src/types/api.ts

**Tech stack available:**
- radix-ui Tooltip for hover states
- formatUnavailableSince() utility in market-utils.ts
- getMarketAvailabilityState() utility in market-utils.ts

**Established patterns (Phase 90):**
- Three-state availability rendering: available (normal), unavailable (strikethrough + tooltip), never_offered (plain dash)
- OutcomeOddsResult pattern: return object with odds + availability state from getter
- Optional fields with defaults for backward compatibility

**Constraining decisions:**
- Phase 90: OddsValue established three-state pattern: available shows odds, unavailable shows strikethrough dash with tooltip, never_offered shows plain dash
- Phase 90: formatUnavailableSince() and getMarketAvailabilityState() utilities already exist in market-utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update OddsBadge component with availability props</name>
  <files>web/src/features/matches/components/odds-badge.tsx</files>
  <action>
Add availability props to OddsBadge interface:
- available?: boolean (default true via logic)
- unavailableSince?: string | null

Update rendering logic:
1. If odds is null AND available is undefined/true → return plain dash (never_offered)
2. If odds is null AND available is false → return strikethrough dash with Tooltip showing formatUnavailableSince(unavailableSince)
3. If odds is number AND available is false → return strikethrough odds value with Tooltip
4. If odds is number AND available is true/undefined → current behavior (normal rendering)

Import Tooltip and TooltipContent, TooltipTrigger from @/components/ui/tooltip.
Import formatUnavailableSince from ../lib/market-utils.

Note: OddsBadge already handles isSuspended with strikethrough - the unavailable state is different (market was removed entirely vs just suspended selection). Unavailable uses tooltip, suspended doesn't.
  </action>
  <verify>npx tsc --noEmit passes in web/ directory</verify>
  <done>OddsBadge renders unavailable markets with strikethrough dash and tooltip, TypeScript compiles without errors</done>
</task>

<task type="auto">
  <name>Task 2: Update MarketRow to pass availability data and wrap with TooltipProvider</name>
  <files>web/src/features/matches/components/market-row.tsx, web/src/features/matches/components/market-grid.tsx</files>
  <action>
In market-row.tsx:
1. Update getOutcomeForBookmaker() to also return availability fields from the market:
   - Check market.available and market.unavailable_since
   - Return { name, odds, isActive, available, unavailableSince } object
2. Update OutcomeDisplay interface to include available?: boolean and unavailableSince?: string | null
3. Pass available and unavailableSince props to OddsBadge component

In market-grid.tsx:
1. Import TooltipProvider from @/components/ui/tooltip
2. Wrap the table (inside CardContent) with TooltipProvider so tooltips work

Note: MarketOddsDetail already has available and unavailable_since fields from Phase 89.
  </action>
  <verify>cd web && npm run build succeeds without errors</verify>
  <done>MarketRow passes availability data to OddsBadge, TooltipProvider wraps table, build succeeds</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `cd web && npx tsc --noEmit` passes
- [ ] `cd web && npm run build` succeeds
- [ ] OddsBadge handles three states: available (normal), unavailable (strikethrough + tooltip), never_offered (plain dash)
- [ ] MarketRow extracts and passes availability data from market
- [ ] TooltipProvider wraps the market grid table
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Event Details page shows unavailable markets with same styling as Odds Comparison page
</success_criteria>

<output>
After completion, create `.planning/phases/91-event-details-ui/91-01-SUMMARY.md`
</output>
