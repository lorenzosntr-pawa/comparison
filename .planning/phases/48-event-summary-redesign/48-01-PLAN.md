---
phase: 48-event-summary-redesign
plan: 01
type: execute
---

<objective>
Redesign the event details summary section with actionable metrics: market counts per bookmaker, mapping success rate, and categorized best odds indicators.

Purpose: Transform the summary from basic competitive stats into a useful diagnostic showing data quality and bookmaker coverage at a glance.
Output: Redesigned SummarySection component with three metric cards.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Current implementation:**
@web/src/features/matches/components/summary-section.tsx
@web/src/features/matches/components/market-grid.tsx
@web/src/types/api.ts

**Key patterns from codebase:**
- Uses shadcn Card components for sections
- Color coding: green for good (>60%), yellow for neutral, red for poor (<40%)
- Market data available in `marketsByBookmaker: BookmakerMarketData[]`
- Each BookmakerMarketData has: bookmaker_slug, bookmaker_name, markets[]
- Each market has: betpawa_market_id, betpawa_market_name, line, outcomes[], margin

**Data available for new metrics:**
1. **Market counts** - count of `markets[]` per bookmaker
2. **Mapping success** - competitor markets have `betpawa_market_id` when mapped (already mapped by backend)
3. **Best odds by category** - can group markets by betpawa_market_id ranges or name patterns
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Bookmaker Market Coverage Card</name>
  <files>web/src/features/matches/components/summary-section.tsx</files>
  <action>
Add a "Market Coverage" card showing:
- Market count per bookmaker (betpawa, sportybet, bet9ja) as horizontal bars
- Betpawa as the reference (100%), competitors as percentage of Betpawa's count
- Use existing shadcn Card, Progress or custom bar visualization
- Show exact counts and percentages

Layout: Card with title "Market Coverage", three rows (one per bookmaker):
```
Betpawa     [███████████████] 45 markets
SportyBet   [████████████   ] 38 (84%)
Bet9ja      [█████████      ] 32 (71%)
```

Calculation: Simple count of markets array per bookmaker. No deduplication needed since we display raw coverage.
  </action>
  <verify>
Run `npm run dev` in web/, visit an event detail page, verify:
- Market Coverage card appears
- Shows count for each bookmaker
- Bars scale relative to Betpawa
  </verify>
  <done>Market Coverage card displays count and percentage for each bookmaker with visual bars</done>
</task>

<task type="auto">
  <name>Task 2: Add Mapping Success Stats Card</name>
  <files>web/src/features/matches/components/summary-section.tsx</files>
  <action>
Add a "Mapping Quality" card showing:
- Total competitor markets (sportybet + bet9ja markets count)
- Successfully mapped count (markets with betpawa_market_id !== null and !== '')
- Mapping success percentage
- Color coding: green >= 80%, yellow 50-80%, red < 50%

This metric shows how well competitor data integrates with Betpawa's taxonomy.

Note: The backend already performs mapping. Markets that couldn't be mapped would have empty/null betpawa_market_id. Check current API response to see how unmapped markets appear (they might be filtered out entirely, in which case mapping success = 100% always and we should show "matched markets" vs "total competitor raw markets" if available, or skip this metric if all data is pre-filtered).

If all markets in API response already have betpawa_market_id (pre-filtered), show a simpler "Matched Markets" stat: "38 SportyBet / 32 Bet9ja markets matched" without percentage.
  </action>
  <verify>
Inspect API response for an event to understand what data is available.
Check if unmapped markets appear in response.
Verify card displays appropriate stats based on data structure.
  </verify>
  <done>Mapping Quality or Matched Markets card shows competitor integration stats</done>
</task>

<task type="auto">
  <name>Task 3: Enhance Best Odds Display by Category</name>
  <files>web/src/features/matches/components/summary-section.tsx</files>
  <action>
Replace the current "Competitive Position" single percentage with a breakdown by market category:

Categories (based on betpawa_market_id or market name patterns):
- **Main** (1X2, Double Chance, Draw No Bet): IDs 1, 10, 3
- **Goals** (Over/Under, BTTS, Total Goals): IDs 18, 29, 21, 16, etc.
- **Handicaps** (Asian/European Handicap): IDs containing "handicap" in name or specific IDs

For each category:
- Show best odds count / total outcomes
- Show percentage
- Use compact inline display: "Main: 12/15 (80%) | Goals: 8/12 (67%) | Handicaps: 3/4 (75%)"

Keep the overall summary (X% best odds overall) but add category breakdown below it.

Market category detection:
- Check `betpawa_market_name` for keywords: "1X2", "Double Chance", "Draw No Bet" → Main
- Keywords: "Over", "Under", "Goals", "Score" → Goals
- Keywords: "Handicap" → Handicaps
- Everything else → "Other"

Reuse existing `calculateCompetitiveStats` logic but extend to return per-category breakdown.
  </action>
  <verify>
Visit event detail page, verify:
- Overall best odds percentage still shows
- Category breakdown appears below
- Categories sum up correctly
- Colors match threshold rules
  </verify>
  <done>Best odds display shows overall percentage plus breakdown by Main/Goals/Handicaps/Other categories</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` in web/ succeeds without errors
- [ ] Event detail page loads without console errors
- [ ] All three summary cards display with correct data
- [ ] Visual styling is consistent with existing components
- [ ] Works for events with varied bookmaker coverage (some missing bookmakers)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Summary section shows: Market Coverage, Mapping Quality, Best Odds by Category
- Metrics are useful and actionable (can identify data quality issues at a glance)
</success_criteria>

<output>
After completion, create `.planning/phases/48-event-summary-redesign/48-01-SUMMARY.md`
</output>
