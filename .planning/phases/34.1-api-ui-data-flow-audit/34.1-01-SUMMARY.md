---
phase: 34.1-api-ui-data-flow-audit
plan: 01
subsystem: api, frontend
tags: [audit, sql, api, frontend, data-flow]

# Dependency graph
requires:
  - phase: 34-investigation-matching-audit
    provides: Confirmed 99.9% backend matching accuracy, identified UI discrepancy
provides:
  - Root cause analysis of API/UI data issues
  - API-001: Coverage count deduplication bug
  - API-002: Event detail uses legacy odds architecture
affects: [35]

# Tech tracking
tech-stack:
  added: []
  patterns: []

key-files:
  created:
    - .planning/phases/34.1-api-ui-data-flow-audit/AUDIT-FINDINGS.md

key-decisions:
  - "API bugs identified, not frontend issues - UI correctly displays what API provides"
  - "Two distinct issues: count deduplication (API-001) and dual architecture (API-002)"
  - "Phase 35 should prioritize API-001 as quick win before API-002"

patterns-established:
  - "SQL-based verification of API response correctness"
  - "Cross-endpoint consistency checking"

issues-created: []

# Metrics
duration: ~30min
completed: 2026-01-28
---

# Phase 34.1 Plan 01: API/UI Data Flow Audit Summary

**Identified 2 API bugs causing incorrect coverage stats and stale odds display - backend data is healthy, query layer is the problem**

## Performance

- **Duration:** ~30 min
- **Started:** 2026-01-28
- **Completed:** 2026-01-28
- **Tasks:** 3/3
- **Files created:** 1

## Accomplishments

- Audited `/events` and `/palimpsest` API endpoints with SQL query verification
- Identified API-001: `/palimpsest/coverage` inflates competitor_only_count by 92% (254 vs 132)
- Identified API-002: Event detail uses legacy odds system (506 events vs 2400+ in new system)
- Confirmed frontend has no bugs - UI correctly displays what API provides
- Resolved UAT-001 root cause from Phase 34
- Created comprehensive audit report with specific fix locations and approaches

## Files Created/Modified

- `.planning/phases/34.1-api-ui-data-flow-audit/AUDIT-FINDINGS.md` - Full audit report
- `.planning/phases/34-investigation-matching-audit/34-01-ISSUES.md` - Updated UAT-001 as resolved

## Decisions Made

- **Frontend is not the problem:** All data issues trace back to API layer
- **Two distinct bugs:** API-001 is a one-line fix, API-002 requires moderate refactoring
- **Fix priority:** API-001 first (quick win), then API-002

## Deviations from Plan

None - plan executed as designed.

## Issues Encountered

None - investigation completed smoothly.

## Next Phase Readiness

Phase 35 has clear scope:
1. Fix API-001: Change line 119-127 in palimpsest.py to use distinct count
2. Fix API-002: Modify event detail endpoint to also query new competitor tables

Estimated effort: API-001 (15 min), API-002 (2-4 hours)

---

*Phase: 34.1-api-ui-data-flow-audit*
*Completed: 2026-01-28*
