---
phase: 110-cross-page-integration
plan: 01
type: execute
---

<objective>
Add alert indicators to Odds Comparison and Event Details pages with navigation links to Risk Monitoring.

Purpose: Enable users to see at a glance which events have risk alerts without navigating to the dedicated Risk Monitoring page.
Output: Alert badges on event rows and event detail header with click-to-navigate functionality.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context (real-time updates complete):
@.planning/phases/109-realtime-updates/109-01-SUMMARY.md
@.planning/phases/109-realtime-updates/109-02-SUMMARY.md

# Key existing files:
@web/src/features/risk-monitoring/hooks/use-alerts.ts
@web/src/features/matches/index.tsx
@web/src/features/matches/components/match-table.tsx
@src/api/routes/events.py (has GET /{event_id}/alerts endpoint at line 1562)

**Tech stack available:**
- TanStack Query v5 hooks
- shadcn/ui Badge component
- React Router useNavigate

**Established patterns:**
- useAlerts/useAlertStats hooks pattern in risk-monitoring feature
- Badge component usage in sidebar (red badge for alert count)
- Tooltip for additional info display
- Navigation via useNavigate with URL params

**Constraining decisions:**
- Phase 109: Lightweight notification pattern (frontend fetches full data from API)
- Phase 108: Event grouping with max severity propagation
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useEventAlerts hook</name>
  <files>web/src/features/matches/hooks/use-event-alerts.ts, web/src/features/matches/hooks/index.ts</files>
  <action>
Create hook to fetch alerts for a specific event using the existing `GET /events/{event_id}/alerts` endpoint.

1. Create `useEventAlerts(eventId: number | undefined)` hook:
   - Use TanStack Query with queryKey: ['events', eventId, 'alerts']
   - Call api.get(`/events/${eventId}/alerts`) returning RiskAlertsResponse type
   - enabled: !!eventId to avoid fetching when no event
   - staleTime: 30 seconds (same as other alert queries)

2. Create `useEventAlertSummary(eventId)` derived hook or helper:
   - Returns { count: number, maxSeverity: 'warning' | 'elevated' | 'critical' | null, hasAlerts: boolean }
   - Compute maxSeverity from alerts array (critical > elevated > warning)

3. Export from index.ts barrel file.

Use RiskAlert and RiskAlertsResponse types from @/features/risk-monitoring/hooks/use-alerts.
  </action>
  <verify>TypeScript compiles: npx tsc --noEmit</verify>
  <done>Hook exports available, types correct, builds without errors</done>
</task>

<task type="auto">
  <name>Task 2: Create AlertIndicator component</name>
  <files>web/src/features/matches/components/alert-indicator.tsx, web/src/features/matches/components/index.ts</files>
  <action>
Create reusable alert indicator component showing alert count with severity-colored badge.

1. Create AlertIndicator component props:
   - count: number
   - maxSeverity: 'warning' | 'elevated' | 'critical' | null
   - eventId: number (for navigation)
   - size?: 'sm' | 'md' (default 'sm')

2. Render logic:
   - If count === 0 or maxSeverity === null, render null (no indicator)
   - Use shadcn Badge with severity colors:
     - warning: bg-yellow-500 text-yellow-950
     - elevated: bg-orange-500 text-orange-950
     - critical: bg-red-500 text-white
   - Display count (cap at 99+)
   - Wrap in Tooltip showing "X alerts - click to view"

3. Navigation on click:
   - Use useNavigate to go to `/risk-monitoring?event_id=${eventId}`
   - Add e.stopPropagation() to prevent row click when clicking indicator

4. Export from components/index.ts.
  </action>
  <verify>TypeScript compiles: npx tsc --noEmit</verify>
  <done>AlertIndicator component renders badge with correct colors, navigates on click</done>
</task>

<task type="auto">
  <name>Task 3: Integrate alerts into MatchDetail header</name>
  <files>web/src/features/matches/index.tsx, web/src/features/matches/components/match-header.tsx</files>
  <action>
Add alert banner to event detail view (MatchDetail component).

1. In MatchDetail component:
   - Import and call useEventAlerts(eventId) hook
   - Pass alert data to MatchHeader component

2. In MatchHeader component:
   - Add optional props: alertCount?: number, maxSeverity?: string
   - If alertCount > 0, render alert banner below event info:
     - Use Alert component (shadcn) with destructive variant for critical, warning for others
     - Show: "âš  {count} risk alert(s) detected" with AlertIndicator badge
     - Add "View Alerts" link button navigating to /risk-monitoring?event_id={eventId}
   - Position: Below the tournament/kickoff info, above summary section

3. Keep existing header layout intact - just add alert section when alerts exist.
  </action>
  <verify>Run dev server, navigate to event detail for event with alerts, confirm banner displays and link works</verify>
  <done>Alert banner appears on event detail page when event has alerts, navigation works</done>
</task>

<task type="auto">
  <name>Task 4: Integrate alerts into MatchTable rows</name>
  <files>web/src/features/matches/components/match-table.tsx, web/src/features/matches/hooks/use-event-alerts.ts</files>
  <action>
Add alert indicators to event rows in the Odds Comparison table.

1. Create useEventAlertCounts hook for batch fetching:
   - Accept eventIds: number[]
   - Use useQueries to batch fetch alerts for visible events
   - Return Record<eventId, { count: number, maxSeverity: string | null }>
   - Only fetch for events on current page (avoid excessive API calls)

2. In MatchTable component:
   - Extract event IDs from events prop
   - Call useEventAlertCounts(eventIds)
   - Add AlertIndicator to each row, positioned after event name or in dedicated column

3. Row integration:
   - Add small AlertIndicator (size="sm") next to event name
   - Only render if that event has alerts (count > 0)
   - Use absolute positioning or flex to avoid layout shift

4. Performance consideration:
   - Batch queries are more efficient than N individual queries
   - Use enabled: eventIds.length > 0 to avoid empty fetches
  </action>
  <verify>Run dev server, view Odds Comparison page with events that have alerts, confirm indicators appear</verify>
  <done>Alert indicators appear on event rows with alerts, clicking navigates to Risk Monitoring filtered by event</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Alert indicators on Odds Comparison table and Event Details page with navigation to Risk Monitoring</what-built>
  <how-to-verify>
    1. Run: npm run dev (from web/ directory)
    2. Navigate to Odds Comparison page (/)
    3. Find events with risk alerts (may need to trigger some via backend)
    4. Confirm: Alert badges appear next to event names with severity color
    5. Click an alert badge - confirm navigation to /risk-monitoring?event_id=X
    6. Navigate to an event detail page (/odds-comparison/:id) for event with alerts
    7. Confirm: Alert banner appears in header
    8. Click "View Alerts" button - confirm navigation works
    9. Test event with NO alerts - confirm no indicator/banner appears
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds in web/ directory
- [ ] TypeScript compiles without errors
- [ ] Alert indicators render on Odds Comparison page for events with alerts
- [ ] Alert banner renders on Event Details page for events with alerts
- [ ] Navigation to Risk Monitoring with event_id filter works from both pages
- [ ] Events without alerts show no indicator/banner
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Cross-page alert visibility working end-to-end
</success_criteria>

<output>
After completion, create `.planning/phases/110-cross-page-integration/110-01-SUMMARY.md`:

# Phase 110 Plan 01: Cross-Page Integration Summary

**[One-liner describing what shipped]**

## Accomplishments

- [Key outcomes]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

[Ready for Phase 111: Settings & Configuration]
</output>
