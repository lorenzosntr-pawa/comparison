---
phase: 24-country-filters-ux
plan: 01
type: execute
---

<objective>
Implement searchable multi-select country filter for the Coverage Comparison page.

Purpose: Enable fast country filtering with type-to-filter, multi-select, and bulk selection capabilities.
Output: Working country combobox with search, multi-select, select/deselect all functionality.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/24-country-filters-ux/24-CONTEXT.md

# Prior phase context
@.planning/phases/23-fix-match-rate-bug/23-01-SUMMARY.md

# Source files to modify
@web/src/features/coverage/components/filter-bar.tsx
@web/src/features/coverage/index.tsx

# Available UI components
@web/src/components/ui/command.tsx
@web/src/components/ui/popover.tsx
@web/src/components/ui/checkbox.tsx

**Tech stack available:** React, shadcn/ui with cmdk, Tailwind v4
**Established patterns:** shadcn Command + Popover for combobox pattern
**From CONTEXT.md:**
- Type-to-filter for fast country finding
- Multi-select with dropdown staying open
- Select/deselect all capability
- Clear visibility of selected countries
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CountryMultiSelect component</name>
  <files>web/src/features/coverage/components/country-multi-select.tsx</files>
  <action>
Create a reusable multi-select combobox component for countries using shadcn Command + Popover pattern.

Component requirements:
- Props: `countries: string[]` (available options), `selected: string[]` (current selections), `onSelectedChange: (selected: string[]) => void`
- Trigger button shows: "[N] countries" when selected, "All Countries" when none selected
- Popover contains:
  - CommandInput for type-to-filter search
  - "Select All" / "Clear All" buttons at top (use CommandGroup with heading)
  - CommandList with CommandItem for each country
  - Each item has Checkbox + country name, clicking toggles selection
  - Items show checkmark/checked state for selected countries
- Dropdown stays open after selection (don't close on item click)
- Use `shouldFilter={true}` (default) for built-in cmdk filtering
- Match existing shadcn styling patterns from command.tsx

Import from existing components: Command, CommandInput, CommandList, CommandEmpty, CommandGroup, CommandItem from ui/command, Popover/PopoverTrigger/PopoverContent from ui/popover, Checkbox from ui/checkbox, Button from ui/button, cn from lib/utils.

Export the component for use in filter-bar.
  </action>
  <verify>File exists with proper TypeScript types, imports compile correctly</verify>
  <done>CountryMultiSelect component created with type-to-filter, multi-select, select all/clear all functionality</done>
</task>

<task type="auto">
  <name>Task 2: Integrate multi-select into filter bar and update filter logic</name>
  <files>web/src/features/coverage/components/filter-bar.tsx, web/src/features/coverage/components/index.ts, web/src/features/coverage/index.tsx</files>
  <action>
Update the filter bar and coverage page to use multi-select countries:

1. **filter-bar.tsx:**
   - Import CountryMultiSelect from ./country-multi-select
   - Update CoverageFilters interface: change `country?: string` to `countries: string[]`
   - Replace the Select component with CountryMultiSelect
   - Pass countries prop as available options, filters.countries as selected, onSelectedChange updates filters

2. **index.ts (components barrel):**
   - Export CountryMultiSelect if needed for type access

3. **index.tsx (CoveragePage):**
   - Update DEFAULT_FILTERS: change `country: undefined` to `countries: []`
   - Update filteredTournaments useMemo:
     - If filters.countries is empty array, show all (no filter)
     - Otherwise filter to tournaments where tournament_country is IN the selected countries array
   - Update header text: show "in [country1], [country2]..." or "in N countries" when multiple selected

Note: The existing search functionality and availability filter remain unchanged.
  </action>
  <verify>npm run build passes, coverage page loads without errors, country filter works with multi-select</verify>
  <done>
- Country filter supports multi-select
- Type-to-filter works
- Select all/clear all work
- Filtered tournaments correctly show only selected countries
- Empty selection shows all countries
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Coverage page loads without console errors
- [ ] Type-to-filter filters country list as user types
- [ ] Multiple countries can be selected
- [ ] Select All selects all countries
- [ ] Clear All clears all selections
- [ ] Tournament table filters correctly by selected countries
- [ ] Empty selection shows all tournaments
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Country filter provides fast multi-select UX as specified in CONTEXT.md
</success_criteria>

<output>
After completion, create `.planning/phases/24-country-filters-ux/24-01-SUMMARY.md`
</output>
