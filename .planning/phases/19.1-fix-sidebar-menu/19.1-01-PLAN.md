---
phase: 19.1-fix-sidebar-menu
plan: 01
type: execute
---

<objective>
Fix the sidebar overlay behavior so it slides over content with backdrop dimming instead of overlapping/pushing content.

Purpose: Urgent UX fix - sidebar currently overlaps content at full screen, making the app annoying to use.
Output: Sidebar that overlays content smoothly with backdrop, closes on backdrop click, no content shifting.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/19.1-fix-sidebar-menu/19.1-CONTEXT.md

**Key files:**
@web/src/components/ui/sidebar.tsx
@web/src/components/layout/app-layout.tsx
@web/src/components/layout/app-sidebar.tsx

**Established patterns:**
- shadcn/ui with Tailwind v4
- Existing sidebar uses SidebarProvider, Sidebar, SidebarInset components
- Mobile uses Sheet component with backdrop (we'll replicate for desktop)

**Vision from CONTEXT.md:**
- Overlay sidebar slides over content (not push)
- Backdrop/dimming effect when open
- Content remains full width, doesn't shift
- Smooth animation
- Clear toggle trigger (already exists via SidebarTrigger)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add overlay backdrop to Sidebar component</name>
  <files>web/src/components/ui/sidebar.tsx</files>
  <action>
Modify the desktop Sidebar rendering (the non-mobile branch starting ~line 223) to add:

1. Add a backdrop overlay div that appears when sidebar is expanded:
   - Position: fixed, inset-0, z-[9] (below sidebar z-10)
   - Background: bg-black/50 or bg-background/80 with backdrop-blur
   - Only visible when state === "expanded" (use data-state attribute)
   - Animate with transition-opacity
   - onClick handler calls toggleSidebar to close

2. For `collapsible="offcanvas"` mode on desktop:
   - The sidebar should slide in from left (already does via left-[calc(var(--sidebar-width)*-1)])
   - When expanded, position at left-0 (already does)
   - The spacer div should remain w-0 when offcanvas (already does)

3. Add the backdrop div inside the desktop sidebar render, between the spacer and the fixed sidebar:
   ```tsx
   {/* Backdrop overlay for desktop */}
   <div
     className={cn(
       "fixed inset-0 z-[9] bg-black/50 transition-opacity duration-200",
       state === "expanded" ? "opacity-100" : "opacity-0 pointer-events-none"
     )}
     onClick={toggleSidebar}
     aria-hidden="true"
   />
   ```

Do NOT modify the mobile Sheet behavior - it already works correctly.
Do NOT change any of the collapsible="icon" or collapsible="none" behaviors.
Only add backdrop for desktop offcanvas mode when expanded.
  </action>
  <verify>TypeScript compiles: cd web && npx tsc --noEmit</verify>
  <done>Backdrop overlay div added to desktop sidebar, appears/fades based on expanded state, clicking it triggers toggleSidebar</done>
</task>

<task type="auto">
  <name>Task 2: Update app-layout to use offcanvas overlay pattern</name>
  <files>web/src/components/layout/app-layout.tsx, web/src/components/layout/app-sidebar.tsx</files>
  <action>
1. In app-sidebar.tsx:
   - Change `collapsible="icon"` to `collapsible="offcanvas"` (line 28)
   - This makes the sidebar fully hide when collapsed instead of showing icons

2. In app-layout.tsx:
   - Ensure SidebarInset doesn't have peer-based margin rules that cause content shifting
   - The content should always be full width since sidebar overlays it
   - Remove or override the margin classes that respond to sidebar state
   - Add `className="w-full"` to SidebarInset if needed to ensure full width

3. Verify the SidebarTrigger remains visible and functional in the header

The result: sidebar is hidden by default, clicking trigger slides it over content with backdrop, clicking backdrop or trigger closes it.
  </action>
  <verify>cd web && npm run build -- passes without errors</verify>
  <done>Sidebar uses offcanvas mode, content takes full width, no margin shifts when sidebar opens/closes</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Overlay sidebar with backdrop dimming</what-built>
  <how-to-verify>
    1. Run: cd web && npm run dev
    2. Open browser to http://localhost:5173 (or wherever Vite runs)
    3. Observe: Page content should take full width (no sidebar visible initially)
    4. Click the hamburger/panel icon in the header
    5. Verify: Sidebar slides in from left smoothly
    6. Verify: Dark backdrop appears behind sidebar, dimming the content
    7. Verify: Content does NOT shift or change width
    8. Click the backdrop (not the sidebar)
    9. Verify: Sidebar closes smoothly, backdrop fades out
    10. Resize to mobile width and verify Sheet-based mobile sidebar still works
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `cd web && npx tsc --noEmit` passes
- [ ] `cd web && npm run build` succeeds
- [ ] Sidebar slides over content (doesn't push)
- [ ] Backdrop dimming appears when sidebar opens
- [ ] Clicking backdrop closes sidebar
- [ ] Content remains full-width at all times
- [ ] Mobile sidebar (Sheet) still works correctly
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Sidebar overlay behavior matches user vision from CONTEXT.md
- No regressions to mobile sidebar behavior
</success_criteria>

<output>
After completion, create `.planning/phases/19.1-fix-sidebar-menu/19.1-01-SUMMARY.md`
</output>
