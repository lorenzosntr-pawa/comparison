---
phase: 66-odds-comparison-history
plan: 01
type: execute
---

<objective>
Add click handlers on odds/margins in Odds Comparison page to open HistoryDialog.

Purpose: Enable users to view historical price movements by clicking any odds or margin value in the main comparison table.
Output: Clickable odds and margin cells that open HistoryDialog with appropriate context.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context:
@.planning/phases/65-history-dialog-component/65-01-SUMMARY.md
@.planning/phases/64-chart-library-integration/64-01-SUMMARY.md

# Source files to modify:
@web/src/features/matches/components/match-table.tsx

# Component to integrate:
@web/src/features/matches/components/history-dialog.tsx

**Established patterns:**
- Tab-conditional data fetching: only fetch when both dialog open AND tab active
- HistoryDialog props: open, onOpenChange, eventId, marketId, bookmakerSlug, marketName, bookmakerName

**Key considerations:**
- MARKET_CONFIG already has labels for market names
- BOOKMAKER_LABELS maps slugs to display names (BP, SB, B9)
- Need full bookmaker names for dialog title: betpawa → BetPawa, sportybet → SportyBet, bet9ja → Bet9ja
- Row click navigates to detail view - need to stop propagation when clicking odds/margin
- OddsValue and MarginValue are inline components within match-table.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add HistoryDialog state and click handlers to MatchTable</name>
  <files>web/src/features/matches/components/match-table.tsx</files>
  <action>
1. Import HistoryDialog from './history-dialog'
2. Add BOOKMAKER_NAMES constant mapping slugs to display names (betpawa → 'BetPawa', sportybet → 'SportyBet', bet9ja → 'Bet9ja')
3. Create HistoryDialogState interface: { eventId: number; marketId: string; bookmakerSlug: string; marketName: string; bookmakerName: string } | null
4. Add useState for historyDialog: HistoryDialogState
5. Modify OddsValue to accept onClick prop and add cursor-pointer + onClick handler
6. Modify MarginValue to accept onClick prop and add cursor-pointer + onClick handler
7. In the table cells, pass onClick to OddsValue/MarginValue with e.stopPropagation() to prevent row navigation
8. Set historyDialog state with eventId, marketId, bookmakerSlug, marketName (from MARKET_CONFIG label), bookmakerName (from BOOKMAKER_NAMES)
  </action>
  <verify>npm run type-check passes, no TypeScript errors</verify>
  <done>OddsValue and MarginValue have onClick handlers that set history dialog state, e.stopPropagation prevents row click navigation</done>
</task>

<task type="auto">
  <name>Task 2: Render HistoryDialog in MatchTable</name>
  <files>web/src/features/matches/components/match-table.tsx</files>
  <action>
1. At the end of MatchTable component (after the table div, before final closing tag), render HistoryDialog:
   - open={historyDialog !== null}
   - onOpenChange={(open) => !open && setHistoryDialog(null)}
   - Spread historyDialog props using: {...(historyDialog ?? { eventId: 0, marketId: '', bookmakerSlug: '', marketName: '', bookmakerName: '' })}
2. Ensure HistoryDialog only renders when state is set (conditional rendering or fallback props)
  </action>
  <verify>npm run build succeeds, manually click an odds cell and verify dialog opens with correct title</verify>
  <done>HistoryDialog opens when clicking any odds/margin cell, shows correct market and bookmaker in title, closes properly</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run type-check` passes
- [ ] `npm run build` succeeds
- [ ] Clicking odds cell opens history dialog
- [ ] Clicking margin cell opens history dialog
- [ ] Dialog shows correct market name (1X2, O/U 2.5, BTTS, DC)
- [ ] Dialog shows correct bookmaker name (BetPawa, SportyBet, Bet9ja)
- [ ] Clicking row elsewhere still navigates to detail view
- [ ] Dialog closes when clicking outside or X button
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Click handlers work on both odds and margin cells
- Row navigation still works when clicking non-cell areas
</success_criteria>

<output>
After completion, create `.planning/phases/66-odds-comparison-history/66-01-SUMMARY.md` following summary template.
</output>
