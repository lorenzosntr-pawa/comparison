---
phase: 50-market-filtering
plan: 01
type: execute
---

<objective>
Add a compact filter bar to the market grid with instant text search and competitor comparison selector.

Purpose: Enable quick market discovery through fuzzy search and focused side-by-side comparison against a selected competitor.
Output: Filter bar component with search input, competitor dropdown, fuzzy filtering, and dynamic column reordering.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/50-market-filtering/50-CONTEXT.md
@.planning/phases/49-market-grouping/49-01-FIX2-SUMMARY.md

**Tech stack available:** React 19, TanStack Query v5, shadcn/ui, Tailwind v4, cmdk, Radix UI Select
**Established patterns:** useMemo for filtered data, controlled components, cn() for conditional classes
**Key files:**
@web/src/features/matches/components/market-grid.tsx
@web/src/features/matches/components/market-row.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create filter bar component</name>
  <files>web/src/features/matches/components/market-filter-bar.tsx, web/src/features/matches/components/market-grid.tsx</files>
  <action>
Create new MarketFilterBar component with:
1. Search input (controlled, placeholder "Search markets...", Search icon from lucide-react)
2. Competitor selector using Radix Select with options: "None", "vs SportyBet", "vs Bet9ja"
3. Style as compact inline bar: flex row, gap-3, items-center, single line height
4. Export props interface: { searchQuery, onSearchChange, selectedCompetitor, onCompetitorChange }

Integrate into market-grid.tsx:
- Add useState for searchQuery (string) and selectedCompetitor (string | null)
- Place MarketFilterBar between MarketTabs and the table
- Pass state and handlers to the component

Do NOT implement filtering logic yet - just the UI structure.
  </action>
  <verify>npm run build passes, filter bar renders above market table with input and dropdown</verify>
  <done>Filter bar visible with working input and dropdown (no filtering effect yet)</done>
</task>

<task type="auto">
  <name>Task 2: Implement fuzzy search filtering</name>
  <files>web/src/features/matches/components/market-grid.tsx</files>
  <action>
Create fuzzyMatch function for subsequence matching:
- Normalize both query and target (lowercase, remove spaces)
- Check if all query characters appear in target in order (subsequence)
- Example: "o25" matches "over2.5goals" because o-2-5 appear in order
- Empty query matches everything

Integrate into filteredMarkets useMemo:
- First apply tab filter (existing)
- Then apply fuzzy search filter on market.name + market.line
- Ensure search is case-insensitive and handles line values (e.g., "over 2.5" or "2.5")

Test cases to handle:
- "o25" finds "Over 2.5 Goals"
- "handi" finds "Handicap"
- "btts" finds "Both Teams to Score"
- Empty search shows all markets
  </action>
  <verify>npm run build passes, typing in search filters markets in real-time with fuzzy matching</verify>
  <done>Fuzzy search filters markets as user types, handles abbreviations and partial matches</done>
</task>

<task type="auto">
  <name>Task 3: Implement competitor comparison mode</name>
  <files>web/src/features/matches/components/market-grid.tsx, web/src/features/matches/components/market-row.tsx</files>
  <action>
Update market-row.tsx:
- Add bookmakerOrder prop: string[] (replaces hardcoded BOOKMAKER_ORDER constant for rendering)
- Use bookmakerOrder prop for column iteration instead of BOOKMAKER_ORDER constant
- Keep BOOKMAKER_ORDER as fallback default if prop not provided

Update market-grid.tsx:
- Create getBookmakerOrder function: when selectedCompetitor is set, return [betpawa, selectedCompetitor, ...others]
- When selectedCompetitor is null, return default order [betpawa, sportybet, bet9ja]
- Compute bookmakerOrder with useMemo based on selectedCompetitor
- Pass bookmakerOrder to both table header and MarketRow components

Column order logic:
- "sportybet" selected → [betpawa, sportybet, bet9ja]
- "bet9ja" selected → [betpawa, bet9ja, sportybet]
- None selected → [betpawa, sportybet, bet9ja] (default)
  </action>
  <verify>npm run build passes, selecting competitor reorders columns to place them next to Betpawa</verify>
  <done>Competitor dropdown reorders table columns, Betpawa always first, selected competitor second</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Filter bar renders above market table with search input and competitor dropdown
- [ ] Typing in search filters markets in real-time with fuzzy matching
- [ ] Selecting a competitor reorders columns (Betpawa first, selected competitor second)
- [ ] Search and competitor filter work together
- [ ] Tab filtering still works alongside new filters
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Filter bar is compact single-row layout
- Fuzzy search handles partial matches and abbreviations
- Column reordering puts selected competitor adjacent to Betpawa
</success_criteria>

<output>
After completion, create `.planning/phases/50-market-filtering/50-01-SUMMARY.md`:

# Phase 50 Plan 01: Market Filter Bar Summary

**[Substantive one-liner describing what shipped]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

[Status for next phase]
</output>
