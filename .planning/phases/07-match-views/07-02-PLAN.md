---
phase: 07-match-views
plan: 02
type: execute
---

<objective>
Build the match list view with sortable table, inline odds comparison, and configurable columns.

Purpose: Primary view for browsing matches and quickly seeing competitive position across key markets.
Output: Functional match list page with filtering, sorting, and column configuration persisted to localStorage.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-match-views/07-CONTEXT.md
@.planning/phases/07-match-views/07-01-SUMMARY.md

**Key source files:**
@web/src/features/matches/index.tsx
@web/src/lib/api.ts
@web/src/types/api.ts
@web/src/features/dashboard/hooks/use-events-stats.ts

**Established patterns:**
- Feature hooks in features/{name}/hooks/ with index.ts re-export
- Feature components in features/{name}/components/ with index.ts re-export
- TanStack Query: staleTime=5min, gcTime=10min for dashboard data
- TanStack Query polling: 60s for events based on volatility
- cn() utility for conditional class merging
- shadcn/ui components already installed: card, badge, button, input, skeleton, tooltip

**From 07-CONTEXT.md:**
- Table with configurable inline markets via settings panel
- Color coding: green = Betpawa better, red = Betpawa worse, gradient intensity by margin size
- Filters: competition and time
- Sorting: kickoff, margin, competition
- Settings persisted to localStorage
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create match list table with odds columns</name>
  <files>web/src/features/matches/components/match-table.tsx, web/src/features/matches/components/odds-cell.tsx, web/src/features/matches/components/index.ts, web/src/features/matches/hooks/use-matches.ts, web/src/features/matches/hooks/index.ts, web/src/types/api.ts, web/src/lib/api.ts</files>
  <action>
Build the core match list table with odds comparison cells.

1. Update TypeScript types in web/src/types/api.ts:
   - Add `InlineOdds` interface: { market_id: string, market_name: string, outcomes: {name: string, odds: number}[] }
   - Add `BookmakerInlineOdds` extending BookmakerOdds with inline_odds: InlineOdds[]
   - Update MatchedEvent.bookmakers to use BookmakerInlineOdds

2. Create TanStack Query hook in web/src/features/matches/hooks/use-matches.ts:
   - useMatches(params) hook calling api.getEvents with filters
   - 60s polling interval (refetchInterval)
   - staleTime: 30000, gcTime: 60000

3. Create OddsCell component (web/src/features/matches/components/odds-cell.tsx):
   - Props: betpawaOdds (number | null), competitorOdds (number | null), showDelta (boolean)
   - Display odds value with color coding:
     - Green gradient when Betpawa odds > competitor (better for punter)
     - Red gradient when Betpawa odds < competitor (worse for punter)
     - Neutral when equal or within 0.02 tolerance
   - Gradient intensity: Math.min(Math.abs(delta) * 20, 100) for bg-opacity
   - Show dash (-) for missing odds
   - Use Tailwind classes: bg-green-500/X, bg-red-500/X where X is opacity

4. Create MatchTable component (web/src/features/matches/components/match-table.tsx):
   - Use native HTML table with Tailwind styling (not a heavy table library)
   - Columns: Match (teams), Kickoff, Tournament, then dynamic odds columns
   - Odds columns grouped by market: "1X2" shows 1/X/2 for each bookmaker
   - Row click navigates to /matches/{id}
   - Loading state with skeleton rows
   - Empty state when no matches

5. Wire up in matches/index.tsx:
   - Replace placeholder with MatchTable
   - Pass data from useMatches hook

Table structure example:
| Match | Kickoff | League | 1X2 (BP) | 1X2 (SB) | 1X2 (B9) | O/U 2.5 (BP) | ... |

Avoid: Using TanStack Table or other heavy libraries. Native table is sufficient and lighter.
  </action>
  <verify>
npm run dev in web/, visit http://localhost:5173/matches
Table displays with match rows and odds columns
Odds cells show color coding (green/red gradient)
  </verify>
  <done>
Match table renders with odds columns. Color-coded cells show Betpawa competitive position. Loading and empty states work.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add filters and sorting controls</name>
  <files>web/src/features/matches/components/match-filters.tsx, web/src/features/matches/components/index.ts, web/src/features/matches/hooks/use-tournaments.ts, web/src/features/matches/hooks/index.ts, web/src/lib/api.ts, web/src/types/api.ts</files>
  <action>
Add filtering and sorting controls above the match table.

1. Add tournaments endpoint to API client (web/src/lib/api.ts):
   - getTournaments() fetching from /api/tournaments (if exists) or extract unique from events
   - Note: May need to add backend endpoint if not exists - check first

2. Create useTournaments hook for tournament dropdown options.

3. Create MatchFilters component (web/src/features/matches/components/match-filters.tsx):
   - Tournament dropdown (shadcn Select or native select)
   - Kickoff date range (two date inputs: from/to)
   - Min bookmakers filter (1/2/3 dropdown)
   - Sort by dropdown: Kickoff (default), Tournament
   - Clear filters button

4. Update useMatches hook to accept filter params:
   - tournament_id, kickoff_from, kickoff_to, min_bookmakers
   - page, page_size for pagination

5. Update api.getEvents to support all filter params:
   - tournament_id, sport_id, kickoff_from, kickoff_to, min_bookmakers

6. Wire filters to MatchList page:
   - Use React state for filter values
   - Debounce date inputs (300ms)
   - Immediate update for dropdowns

7. Add pagination controls below table:
   - Previous/Next buttons
   - Page X of Y display
   - Page size selector (25/50/100)

Install shadcn select component if needed: npx shadcn@latest add select --yes

Avoid: Over-engineering with complex state management. Simple useState is sufficient.
  </action>
  <verify>
Filter by tournament narrows results
Date range filter works
Pagination navigates through results
Sort changes result order
  </verify>
  <done>
Filters functional: tournament, date range, min bookmakers. Pagination works. Sort by kickoff/tournament.
  </done>
</task>

<task type="auto">
  <name>Task 3: Column configuration with localStorage persistence</name>
  <files>web/src/features/matches/components/column-settings.tsx, web/src/features/matches/hooks/use-column-settings.ts, web/src/features/matches/components/index.ts, web/src/features/matches/hooks/index.ts</files>
  <action>
Add settings panel for choosing which market columns to display.

1. Create useColumnSettings hook (web/src/features/matches/hooks/use-column-settings.ts):
   - Default visible columns: ['1x2', 'ou25', 'btts']
   - Available columns: { id: '1x2', label: '1X2' }, { id: 'ou25', label: 'O/U 2.5' }, { id: 'btts', label: 'BTTS' }
   - Load from localStorage key 'match-list-columns' on mount
   - Save to localStorage on change
   - Return { visibleColumns, toggleColumn, isColumnVisible }

2. Create ColumnSettings component (web/src/features/matches/components/column-settings.tsx):
   - Button that opens a popover/dropdown
   - Checkbox list of available columns
   - "Show all" / "Hide all" quick actions
   - Use shadcn Popover or DropdownMenu

3. Integrate with MatchTable:
   - Pass visibleColumns to table
   - Only render columns that are in visibleColumns
   - Maintain column order based on settings

4. Add settings button to filters bar (right side):
   - Icon: Settings2 or Columns from lucide-react
   - Tooltip: "Configure columns"

Install shadcn popover if needed: npx shadcn@latest add popover --yes
Install shadcn checkbox if needed: npx shadcn@latest add checkbox --yes

localStorage schema:
```json
{
  "match-list-columns": ["1x2", "ou25", "btts"]
}
```

Avoid: Complex drag-and-drop reordering. Simple checkbox toggle is sufficient for MVP.
  </action>
  <verify>
Settings popover opens with column checkboxes
Toggling column hides/shows it in table
Refresh page - settings persist
  </verify>
  <done>
Column configuration works with localStorage persistence. Users can toggle which market columns appear.
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Match table displays with odds data
- [ ] Color coding shows green/red based on Betpawa vs competitors
- [ ] Filters narrow results correctly
- [ ] Pagination works
- [ ] Column settings toggle visibility
- [ ] Settings persist across page refresh
- [ ] npm run build passes without errors
</verification>

<success_criteria>
- Match list shows all matched events with inline odds
- Green/red color coding indicates Betpawa competitive position
- Filtering by tournament and date range functional
- Column visibility configurable and persisted
- Clicking row navigates to match detail
</success_criteria>

<output>
After completion, create `.planning/phases/07-match-views/07-02-SUMMARY.md`
</output>
