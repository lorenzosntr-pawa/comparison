---
phase: 44-high-priority-market-mappings
plan: 02
type: execute
domain: market-mapping
---

<objective>
Add new MarketMapping entries for HIGH priority UNKNOWN_MARKET errors - markets that don't exist in market_ids.py at all.

Purpose: These markets exist on competitors but have no mapping definition. Adding mappings will significantly improve coverage.

Output: New market mappings in market_ids.py for ~20 high-frequency markets, improving mapping success rate.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/43-market-mapping-audit/AUDIT-FINDINGS.md
@.planning/phases/43-market-mapping-audit/audit_raw_data.json
@.planning/phases/44-high-priority-market-mappings/44-CONTEXT.md
@src/market_mapping/mappings/market_ids.py
@src/market_mapping/types/normalized.py

**Scope:** HIGH priority UNKNOWN_MARKET errors only. Excludes:
- Player props (complex, separate phase)
- Markets requiring parameter handling (UNKNOWN_PARAM_MARKET - plan 44-03)
- Platform-specific markets with no BetPawa equivalent

**Target Markets (grouped by mappability):**

**Group A - Clear Mappings (highest priority):**
| Platform | Market ID | Description | Frequency | Notes |
|----------|-----------|-------------|-----------|-------|
| sportybet | 12 | Home No Bet | 66 | Same as DNB home outcome |
| sportybet | 13 | Away No Bet | 66 | Same as DNB away outcome |
| bet9ja | HOMENOBET | Home No Bet | 99 | Same as DNB |
| bet9ja | AWAYNOBET | Away No Bet | 99 | Same as DNB |
| sportybet | 8 | 1st Goal | 48 | Who scores first |
| bet9ja | 1STGOAL | 1st Goal | 65 | Who scores first |
| bet9ja | LASTSCORE | Last Goal | 65 | Who scores last |

**Group B - Time-Based Markets:**
| Platform | Market ID | Description | Frequency | Notes |
|----------|-----------|-------------|-----------|-------|
| sportybet | 900069 | 1X2 from 1-5 min | 312 | Early match result |
| sportybet | 60200 | 1X2 - 1UP | 76 | Home to win by 1+ |
| sportybet | 60100 | 1X2 - 2UP | 76 | Home to win by 2+ |
| bet9ja | 1X21 | 1X2 - Period 1 | 62 | Time-based 1X2 |
| bet9ja | 1X22 | 1X2 - Period 2 | 62 | Time-based 1X2 |

**Group C - Clean Sheet and Special Combos:**
| Platform | Market ID | Description | Frequency | Notes |
|----------|-----------|-------------|-----------|-------|
| sportybet | 863 | Home Team or Any Clean Sheet | 66 | Combo market |
| sportybet | 864 | Draw or Any Clean Sheet | 66 | Combo market |
| sportybet | 865 | Away Team or Any Clean Sheet | 66 | Combo market |
| bet9ja | 3CM | 3-Way Combo Market | 95 | Needs investigation |
| bet9ja | CHANCEMIX | Chance Mix | 95 | Needs investigation |

**Group D - Goal Scoring Markets:**
| Platform | Market ID | Description | Frequency | Notes |
|----------|-----------|-------------|-----------|-------|
| sportybet | 900015 | Home Team To Score Yes/No | 61 | Team-specific BTTS |
| sportybet | 900014 | Away Team To Score Yes/No | 61 | Team-specific BTTS |
| bet9ja | GOALSHOME | Home Team Goals | 95 | Exact goals home |
| bet9ja | GOALSAWAY | Away Team Goals | 95 | Exact goals away |

**Estimated Total Impact:** ~1,800+ market occurrences
</context>

<tasks>

<task type="auto">
  <name>Task 1: Research market structures from raw API data</name>
  <files>.planning/phases/44-high-priority-market-mappings/new-market-research.md</files>
  <action>
Analyze audit_raw_data.json to understand the structure of target markets:

For each market in Groups A-D:
1. Find sample occurrences in raw data
2. Document: outcome names/suffixes, number of outcomes, any specifiers
3. Determine BetPawa equivalent (if any) by name/description matching
4. Note if market has parameterized variants (defer to plan 03)

Key research questions:
- Home No Bet (12, HOMENOBET): What outcomes? Likely just "Home wins" at adjusted odds
- 1st Goal (8, 1STGOAL): Outcomes "Home/Draw/Away" or "Home/None/Away"?
- 900069 (1X2 1-5 min): Standard 1/X/2 outcomes in early window?
- Clean sheet combos: What outcome structure?
- Team to Score: Yes/No outcomes?

Create new-market-research.md with findings. For each market document:
- Market ID/key
- Actual outcomes from API
- Proposed canonical_id
- Proposed BetPawa mapping (if exists)
- Outcome mapping table
  </action>
  <verify>new-market-research.md exists with documented structures for all 20+ target markets</verify>
  <done>Each target market has: actual outcome structure, proposed mapping, or marked as unmappable with reason</done>
</task>

<task type="auto">
  <name>Task 2: Add new MarketMapping entries to market_ids.py</name>
  <files>src/market_mapping/mappings/market_ids.py</files>
  <action>
Based on new-market-research.md, add MarketMapping entries for mappable markets:

Structure for each new mapping:
```python
MarketMapping(
    canonical_id="market_name_scope",  # e.g., "home_no_bet_ft"
    name="Market Display Name",
    betpawa_id="XXXX",  # BetPawa marketType.id, or None if no equivalent
    sportybet_id="XX",  # Sportybet market.id, or None
    bet9ja_key="S_KEY",  # Bet9ja key prefix, or None
    outcome_mapping=(
        OutcomeMapping(canonical_id="...", betpawa_name="...", sportybet_desc="...", bet9ja_suffix="...", position=0),
        # ... more outcomes
    ),
),
```

Rules:
- Follow existing naming conventions (see file header)
- Group with related markets (e.g., add time-based 1X2 near existing 1X2 markets)
- Set betpawa_id=None for markets BetPawa doesn't offer (still useful for competitor-only data)
- Include both sportybet_id and bet9ja_key where both platforms have the market

For markets that are subsets of existing markets (like Home No Bet being DNB-home):
- Create separate mapping pointing to same betpawa_id if appropriate
- Or document as "maps to existing" in research doc

Add ~15-20 new mappings based on research findings.
  </action>
  <verify>
grep -c "MarketMapping(" src/market_mapping/mappings/market_ids.py shows increased count
New markets can be found: grep -n "home_no_bet\|1st_goal\|900069\|clean_sheet" src/market_mapping/mappings/market_ids.py
  </verify>
  <done>15-20 new MarketMapping entries added for HIGH priority UNKNOWN_MARKET items</done>
</task>

<task type="auto">
  <name>Task 3: Verify new mappings with import and spot-check</name>
  <files>tests/test_sportybet_mapper.py, tests/test_bet9ja_mapper.py</files>
  <action>
Verify the new mappings work correctly:

1. **Syntax check:** Import the module to verify no Python errors
```bash
python -c "from market_mapping.mappings import market_ids; print(f'{len(market_ids.MARKET_MAPPINGS)} mappings')"
```

2. **Lookup check:** Verify find_by_* functions return new mappings
```python
from market_mapping.mappings import find_by_sportybet_id, find_by_bet9ja_key
# Test a few new mappings
assert find_by_sportybet_id("12") is not None, "Home No Bet not found"
assert find_by_bet9ja_key("S_HOMENOBET") is not None, "Bet9ja Home No Bet not found"
```

3. **Existing tests:** Run existing tests to ensure no regressions
```bash
python -m pytest tests/test_sportybet_mapper.py tests/test_bet9ja_mapper.py -v
```

4. **Quick audit spot-check:** Test one sample event with new markets
- Load one event from audit_raw_data.json
- Attempt to map using map_sportybet_to_betpawa() / map_bet9ja_market_to_betpawa()
- Verify UNKNOWN_MARKET error no longer occurs for newly mapped markets

Document any issues found for follow-up.
  </action>
  <verify>
python -c "from market_mapping.mappings import market_ids" succeeds
pytest tests/test_*_mapper.py passes
Spot-check shows new markets are recognized
  </verify>
  <done>New mappings verified: importable, findable, pass existing tests, work in spot-check</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] new-market-research.md documents all target markets
- [ ] market_ids.py has 15-20 new MarketMapping entries
- [ ] No Python syntax errors (module imports successfully)
- [ ] find_by_sportybet_id() and find_by_bet9ja_key() return new mappings
- [ ] Existing mapper tests still pass
- [ ] Spot-check shows reduced UNKNOWN_MARKET for newly mapped markets
</verification>

<success_criteria>
- 15-20 HIGH priority markets added to market_ids.py
- New mappings are findable via lookup functions
- No regression in existing functionality
- Research documented for future reference
</success_criteria>

<output>
After completion, create `.planning/phases/44-high-priority-market-mappings/44-02-SUMMARY.md`:

# Phase 44 Plan 02: UNKNOWN_MARKET Fixes Summary

**[One-liner: How many new markets added]**

## Accomplishments
- [Number of new mappings added]
- [Categories covered]

## Files Created/Modified
- `src/market_mapping/mappings/market_ids.py` - New market mappings
- `.planning/phases/44-high-priority-market-mappings/new-market-research.md` - Research doc

## Markets Added
| canonical_id | Name | Platforms |
|--------------|------|-----------|
| ... | ... | ... |

## Markets Deferred
[Any markets that couldn't be mapped and why]

## Issues Encountered
[Any issues]

## Next Step
Ready for 44-03-PLAN.md (UNKNOWN_PARAM_MARKET fixes)
</output>
