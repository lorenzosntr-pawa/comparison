---
phase: 104-monitoring-prevention
plan: 02
type: execute
domain: frontend
---

<objective>
Create Storage dashboard page to visualize database sizes, trends, and cleanup history.

Purpose: Give operators visibility into database health and growth patterns.
Output: New Storage page with size cards, trend chart, and cleanup history table.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/104-monitoring-prevention/104-01-SUMMARY.md

**Frontend patterns:**
@web/src/routes.tsx - routing setup
@web/src/features/settings/index.tsx - page structure with cards
@web/src/features/historical-analysis/index.tsx - recharts usage pattern

**Key decisions from prior phases:**
- React with TanStack Query v5
- shadcn/ui components with Tailwind
- recharts for data visualization
- Feature-based folder structure (features/xxx/index.tsx, hooks/, components/)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Storage page with size overview and cleanup history</name>
  <files>web/src/features/storage/index.tsx, web/src/features/storage/hooks/index.ts, web/src/features/storage/hooks/use-storage.ts, web/src/routes.tsx, web/src/App.tsx</files>
  <action>
1. Create web/src/features/storage/hooks/use-storage.ts:
   - useStorageSizes(): TanStack Query hook calling GET /api/storage/sizes
   - useStorageHistory(): TanStack Query hook calling GET /api/storage/history
   - useCleanupHistory(): TanStack Query hook calling GET /api/cleanup/history
   - Type definitions for StorageSizes, StorageSample, CleanupRun responses

2. Create web/src/features/storage/hooks/index.ts - export hooks

3. Create web/src/features/storage/index.tsx:
   - StoragePage component with:
     - Header: "Storage" title
     - Top row: Total database size card (large, prominent)
     - Second row: Grid of table size cards (top 6 tables by size)
       - Each card shows: table name, size (human readable), row count
       - Color coding: green (<1GB), yellow (1-5GB), red (>5GB)
     - Third section: Cleanup History table
       - Columns: Date, Trigger (manual/scheduled), Duration, Records Deleted, Status
       - Use shadcn Table component
       - Show last 10 cleanup runs

4. Update web/src/routes.tsx:
   - Import StoragePage from features/storage
   - Add route: /storage -> StoragePage

5. Update sidebar navigation in web/src/App.tsx:
   - Add "Storage" link under system section (after Settings)
   - Use Database icon from lucide-react

Follow existing patterns:
- Use Card, CardHeader, CardTitle, CardContent from shadcn
- Loading skeletons while data fetches
- Error handling with user-friendly message
  </action>
  <verify>Navigate to /storage, verify size cards display with human-readable sizes and cleanup history table shows data</verify>
  <done>
- Storage page accessible at /storage
- Database size cards showing current sizes
- Cleanup history table with last 10 runs
- Navigation link in sidebar
  </done>
</task>

<task type="auto">
  <name>Task 2: Add storage trend chart</name>
  <files>web/src/features/storage/components/size-trend-chart.tsx, web/src/features/storage/components/index.ts, web/src/features/storage/index.tsx</files>
  <action>
1. Create web/src/features/storage/components/size-trend-chart.tsx:
   - SizeTrendChart component using recharts (already in project)
   - Line chart showing total_bytes over time from storage history
   - X-axis: Date (sampled_at)
   - Y-axis: Size in GB (convert bytes to GB for readability)
   - Tooltip showing exact size and date
   - Use ResponsiveContainer for proper sizing
   - Style: Use blue line matching project theme

2. Create web/src/features/storage/components/index.ts - export components

3. Update web/src/features/storage/index.tsx:
   - Add SizeTrendChart between size cards and cleanup history
   - Wrap in Card with title "Size Trend (Last 30 Days)"
   - Show "No history data yet" message if no samples

Chart configuration:
- Use Area chart (filled) for visual appeal
- Format Y-axis ticks to show "X GB"
- Format X-axis to show date only (no time)
- Use CartesianGrid with light dashed lines
  </action>
  <verify>Size trend chart renders with historical data points, axes labeled correctly, tooltip works on hover</verify>
  <done>
- Size trend chart displays storage history over time
- Proper formatting (GB on Y-axis, dates on X-axis)
- Interactive tooltip
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Storage dashboard with size cards, trend chart, and cleanup history</what-built>
  <how-to-verify>
    1. Run: cd web && pnpm dev
    2. Navigate to: http://localhost:5173/storage
    3. Verify: Database total size card shows at top
    4. Verify: Table size cards show individual table sizes
    5. Verify: Size trend chart displays (may show "no data" if no samples yet)
    6. Verify: Cleanup history table shows recent runs
    7. Check: Sidebar has "Storage" link in system section
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Storage page accessible at /storage
- [ ] Size cards display current database sizes
- [ ] Trend chart renders (or shows no-data message)
- [ ] Cleanup history table populated
- [ ] Sidebar navigation updated
- [ ] No TypeScript errors: pnpm tsc --noEmit
</verification>

<success_criteria>

- All tasks completed
- Storage dashboard provides clear visibility into database health
- User verified UI displays correctly
- No errors introduced
</success_criteria>

<output>
After completion, create `.planning/phases/104-monitoring-prevention/104-02-SUMMARY.md`
</output>
