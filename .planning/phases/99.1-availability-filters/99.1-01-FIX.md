---
phase: 99.1-availability-filters
plan: 99.1-01-FIX
type: fix
---

<objective>
Fix 1 UAT issue from plan 99.1-01.

Source: 99.1-01-ISSUES.md
Priority: 1 blocker
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

**Issues being fixed:**
@.planning/phases/99.1-availability-filters/99.1-01-ISSUES.md

**Original plan for reference:**
@.planning/phases/99.1-availability-filters/99.1-01-PLAN.md

**Key Files:**
@web/src/features/matches/index.tsx
@web/src/features/matches/hooks/use-matches.ts
@web/src/lib/api.ts
@src/api/routes/events.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Diagnose and fix Alerts toggle blank page</name>
  <files>web/src/features/matches/index.tsx</files>
  <action>
The user reports that clicking Alerts toggle causes a blank page with no API call being made.

Diagnosis steps:
1. Check the browser console for any JavaScript errors when clicking Alerts
2. Add console.log statements to trace the state changes:
   - Log when handleModeSwitch is called
   - Log the currentMode value after state change
   - Log the filters object being passed to useMatches

Likely issues to investigate:
1. State update race condition - the mode changes but filters might not be updating in sync
2. Query key not changing - TanStack Query might not see the change
3. Rendering crash - something in the render path might throw when data is undefined

Debug by adding temporary console.log:
```typescript
// In handleModeSwitch
console.log('handleModeSwitch called with:', mode)

// After mode selection
console.log('currentMode:', currentMode, 'filters:', filters)

// Before useMatches
console.log('useMatches params:', { availability: filters.availability })
```

Once root cause identified, fix the issue. Common fixes:
- If race condition: ensure filters object reference changes when mode changes
- If query key issue: verify availability is in the queryKey array
- If render crash: add defensive checks for undefined data

After fix, remove debug logging.
  </action>
  <verify>
1. Run `npm run dev`
2. Open browser console (F12)
3. Navigate to Odds Comparison page
4. Click Alerts toggle
5. Verify: API call is made to `/api/events?availability=alerts`
6. Verify: Page shows filtered events (or empty state if no alerts)
7. Verify: No console errors
8. Verify: Can toggle back to BetPawa and Competitors modes
  </verify>
  <done>
- Alerts toggle triggers API call with availability=alerts
- Page renders correctly (shows events or empty state)
- No blank page or crash
- All three toggles work correctly
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Alerts toggle triggers correct API call
- [ ] Page renders correctly when in Alerts mode
- [ ] No console errors
- [ ] All three modes (BetPawa, Competitors, Alerts) work correctly
</verification>

<success_criteria>
- UAT-001 resolved: Alerts filter no longer causes blank page
- Tests pass
- Ready for re-verification with /gsd:verify-work
</success_criteria>

<output>
After completion, create `.planning/phases/99.1-availability-filters/99.1-01-FIX-SUMMARY.md`
</output>
