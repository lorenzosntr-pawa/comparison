# UAT Issues: Phase 6.1 Plan 1

**Tested:** 2026-01-21
**Source:** .planning/phases/06.1-cross-platform-scraping/06.1-01-SUMMARY.md
**Tester:** User via /gsd:verify-work

## Open Issues

### UAT-007: SportyBet markets missing `lastOddsChangeTime` field

**Discovered:** 2026-01-21 during Phase 7.1 verification
**Phase/Plan:** 06.1-01
**Severity:** Minor
**Feature:** SportyBet market parsing
**Description:** Many SportyBet markets fail Pydantic validation because the `lastOddsChangeTime` field is missing. Also some markets have `marketExtendVOS` missing required fields (`rootMarketId`, `nodeMarketId`), and some markets missing `group`, `groupId`, `title`, `name` fields.
**Expected:** Markets parse successfully or gracefully skip with minimal logging
**Actual:** Validation errors are logged for each failed market (spammy logs), but scraping continues
**Impact:** Log noise; affected markets skipped (no data loss for core markets)
**Repro:** Run a full scrape and observe SportyBet market parsing logs

## Resolved Issues

### UAT-006: BetPawa scrape times out - 60s insufficient for 60+ competitions

**Discovered:** 2026-01-21
**Resolved:** 2026-01-21 - Fixed in 06.1-01-FIX3.md
**Phase/Plan:** 06.1-01
**Severity:** ~~Blocker~~ Resolved
**Feature:** BetPawa full scrape
**Description:** ~~BetPawa scrape consistently times out when scraping all competitions.~~ Fixed by increasing timeout defaults.
**Fix:**
1. Increased timeout default from 30s to 300s, max from 300s to 600s
2. Added special TimeoutError handling to provide descriptive error message
**Result:** Full scrape completes in ~110s with 2133 events (1056 BetPawa + 1077 Bet9ja)

### UAT-003: Bet9ja scraping fails - external API unreachable

**Discovered:** 2026-01-21
**Resolved:** 2026-01-21 - API is reachable with correct endpoint
**Phase/Plan:** 06.1-01
**Severity:** ~~Major~~ Resolved
**Feature:** Bet9ja scraping
**Description:** ~~Bet9ja scraping reports `success: false` with an empty error message.~~
**Resolution:** API is actually reachable. The test script was using the wrong endpoint. The correct endpoint `/desktop/feapi/PalimpsestAjax/GetSports` works and returns valid JSON data.

### UAT-005: Missing sports seed data - Football (ID 1) doesn't exist

**Discovered:** 2026-01-21
**Resolved:** 2026-01-21 - Fixed in 06.1-01-FIX2.md
**Commit:** 6e75080
**Severity:** Blocker
**Feature:** BetPawa scraping / event storage
**Description:** BetPawa scraping successfully fetches events but storage failed with `ForeignKeyViolationError` - sports table was empty.
**Fix:** Created Alembic migration to seed sports table with Football (id=1, name='Football', slug='football')

### UAT-004: Database transaction error when logging scrape errors

**Discovered:** 2026-01-21
**Resolved:** 2026-01-21 - Fixed in 06.1-01-FIX2.md
**Commit:** 03441a0
**Severity:** Major
**Feature:** Scrape error logging
**Description:** Orchestrator crashed with `InFailedSQLTransactionError` when trying to log scrape errors.
**Fix:** Added `await db.rollback()` before `_log_error()` calls to clear failed transaction state.

### UAT-001: BetPawa competition parsing fails - wrong response key

**Discovered:** 2026-01-21
**Resolved:** 2026-01-21 - Fixed in 06.1-01-FIX.md
**Commit:** bf04d5d
**Severity:** Blocker
**Feature:** BetPawa scraping
**Description:** The orchestrator failed to extract competition IDs from BetPawa API response. The code looked for `regions` key at the top level, but the API returns data under `withRegions[0].regions`.
**Fix:** Changed `categories_data.get("regions", [])` to `categories_data.get("withRegions", [])[0].get("regions", [])`

### UAT-002: SportyBet health check endpoint returns 404

**Discovered:** 2026-01-21
**Resolved:** 2026-01-21 - Fixed in 06.1-01-FIX.md
**Commit:** 1aa882c
**Severity:** Minor
**Feature:** SportyBet health check
**Description:** The health check endpoint `/api/ng/factsCenter/sportsMenu/list` returned 404, causing SportyBet to report as "unhealthy" even though the event fetch endpoint worked correctly.
**Fix:** Changed health check to use `/api/ng/factsCenter/event` with dummy ID; accepts 200/400/404 as healthy (any response = API reachable)

---

*Phase: 06.1-cross-platform-scraping*
*Plan: 01*
*Tested: 2026-01-21*
*Fixed: 2026-01-21*
