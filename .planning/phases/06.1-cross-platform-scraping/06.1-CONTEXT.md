# Phase 6.1: Cross-Platform Scraping - Context

**Gathered:** 2026-01-21
**Status:** Ready for planning

<vision>
## How This Should Work

BetPawa is the base. Every scrape run starts with BetPawa to discover all football events with their SportRadar IDs. Then SportyBet and Bet9ja are scraped sequentially in the same run to find matching events.

For SportyBet: Use the SportRadar ID directly with `fetch_event(sportradar_id)` since their API accepts it as the event identifier.

For Bet9ja: Scrape all football tournaments to get events, extract the SportRadar ID from the `EXTID` field, and match to existing BetPawa events. No tournament mapping needed - just direct SportRadar ID matching.

**The flow depends on whether events are already linked:**
- **Unlinked events**: Find and create the bookmaker link
- **Already linked events**: Fetch fresh odds for comparison

Every scrape run captures odds from all platforms using each platform's event details API (not listing endpoints). Store raw API responses - apply market mapping on read, not on capture. This keeps data integrity for debugging and allows mapping improvements without re-scraping.

**Error handling:**
- Retry failed platforms a few times, then continue with what succeeded
- Skip individual events with malformed/unexpected data, log error, continue with others
- For 404s on events: if event hasn't started (check kickoff time AND API status), leave link unchanged but flag for confidence review. If event has started, archive for historical analysis and stop scraping it.

</vision>

<essential>
## What Must Be Nailed

- **Reliable matching** - Every event that exists on all platforms must be correctly linked via SportRadar ID. This is the foundation for comparison.
- **Full odds capture** - All available markets from each platform, stored as raw data for maximum flexibility
- **Coverage visibility** - Track which BetPawa events are missing from competitors, and flag competitor events that don't exist on BetPawa for review

</essential>

<boundaries>
## What's Out of Scope

- Non-football sports - football only for now
- Odds comparison UI - that's Phase 7, this phase just gets the data
- Tournament/competition mapping - rely purely on SportRadar ID matching
- Live/in-play events - prematch only, archive events once they start

</boundaries>

<specifics>
## Specific Ideas

- All football competitions treated equally - no priority leagues
- Per-platform snapshots (not unified) - allows independent tracking and future different scrape frequencies
- Dashboard should show: match count per platform, coverage percentage, recent scrape results/timing/errors
- Competitor events without BetPawa match: store and flag for review, not ignored
- Event state determined by: kickoff time comparison + API status field confirmation

</specifics>

<notes>
## Additional Context

The scraping clients already exist and work:
- `BetPawaClient.fetch_event()`, `fetch_events()`, `fetch_categories()`
- `SportyBetClient.fetch_event(sportradar_id)` - accepts SportRadar ID directly
- `Bet9jaClient.fetch_event()`, `fetch_events(tournament_id)`, `fetch_sports()`

The orchestrator has stub implementations for SportyBet/Bet9ja returning empty arrays - this phase replaces those stubs with real implementations.

Existing `odds_snapshots` table has `raw_data` JSONB column ready for storing raw API responses.

All three platforms use SportRadar IDs:
- BetPawa: `widgets[type=SPORTRADAR].id`
- SportyBet: `eventId` parameter accepts SportRadar ID directly
- Bet9ja: `EXTID` field contains SportRadar ID

</notes>

---

*Phase: 06.1-cross-platform-scraping*
*Context gathered: 2026-01-21*
