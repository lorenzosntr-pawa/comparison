---
phase: 33.1-fix-issue-iss-003
type: execute
---

<objective>
Fix job ID mismatch causing scheduler UI to show 2-minute watchdog interval instead of actual scrape interval.

Purpose: ISS-003 — the frontend references a stale job ID `'scrape_odds'` and uses `jobs[0]` index which may resolve to the wrong job, causing misleading interval display.
Output: Scheduler control and recent runs display the correct scrape interval from settings.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/ISSUES.md

@web/src/features/settings/components/scheduler-control.tsx
@web/src/features/dashboard/components/recent-runs.tsx
@src/scheduling/scheduler.py

**Constraining decisions:**
- Backend job ID is `'scrape_all_platforms'` (src/scheduling/scheduler.py:56)
- Stale detection watchdog is `'detect_stale_runs'` with hardcoded 2-min interval (scheduler.py:66)
- Scheduler API returns all jobs via `scheduler.get_jobs()` — order is non-deterministic

**Issues being addressed:** ISS-003
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix job ID references in frontend components</name>
  <files>web/src/features/settings/components/scheduler-control.tsx, web/src/features/dashboard/components/recent-runs.tsx</files>
  <action>
1. In `scheduler-control.tsx:14`: change `j.id === 'scrape_odds'` to `j.id === 'scrape_all_platforms'`.

2. In `recent-runs.tsx`: replace all `scheduler?.jobs[0]` references (lines 294, 297, 302, 304) with a named lookup. Add a const like:
   ```
   const scrapeJob = scheduler?.jobs?.find((j) => j.id === 'scrape_all_platforms')
   ```
   Then use `scrapeJob?.interval_minutes` and `scrapeJob?.next_run` instead of `scheduler?.jobs[0]?.interval_minutes` etc.

Do NOT change any backend code — the backend job IDs are correct.
  </action>
  <verify>Run `npm run build --prefix web` — no TypeScript errors. Grep for `scrape_odds` and `jobs[0]` in web/src — zero matches.</verify>
  <done>Both components reference `'scrape_all_platforms'` by ID lookup. No hardcoded index access for job data. Build passes.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Fixed scheduler interval display to show correct scrape interval</what-built>
  <how-to-verify>
    1. Start the app (backend + frontend)
    2. Open Settings page — scheduler control should show the configured interval (e.g. 15m), NOT 2m
    3. Open Dashboard — recent runs header badge should show the correct interval (e.g. 15m)
    4. Confirm next run time looks reasonable for the configured interval
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build --prefix web` succeeds
- [ ] No references to `'scrape_odds'` remain in frontend code
- [ ] No `jobs[0]` index access remains in recent-runs.tsx
- [ ] UI displays correct scrape interval
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Scheduler UI shows configured scrape interval, not watchdog interval
- ISS-003 resolved
  </success_criteria>

<output>
After completion, create `.planning/phases/33.1-fix-issue-iss-003/33.1-01-SUMMARY.md`
</output>
