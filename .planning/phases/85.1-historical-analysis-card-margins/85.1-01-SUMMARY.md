---
phase: 85.1-historical-analysis-card-margins
plan: 01
subsystem: ui
tags: [historical-analysis, margins, tournament-cards]

# Dependency graph
requires:
  - phase: 85-time-to-kickoff-charts
    provides: TimelineDialog with margin history visualization
provides:
  - Opening/closing margins on tournament cards
  - MarginMetrics interface with opening/closing/delta fields
affects: [historical-analysis, tournament-detail]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - Opening/closing from kickoff-sorted margin history (first=opening, last=closing)
    - Delta color coding (green=improved, red=worsened, muted=stable)

key-files:
  created: []
  modified:
    - web/src/features/historical-analysis/hooks/use-tournaments.ts
    - web/src/features/historical-analysis/components/tournament-list.tsx

key-decisions:
  - "Delta threshold 0.1% for color coding (avoid flickering between colors for tiny changes)"

patterns-established:
  - "Opening/closing from sorted eventMargins: first element = opening, last = closing"
  - "DeltaDisplay component for consistent delta coloring across app"

issues-created: []

# Metrics
duration: 5min
completed: 2026-02-11
---

# Phase 85.1 Plan 01: Historical Analysis Card Margins Summary

**Tournament cards now display opening→closing margins with color-coded deltas for each tracked market (1X2, O/U 2.5, BTTS, DC)**

## Performance

- **Duration:** 5 min
- **Started:** 2026-02-11T10:30:00Z
- **Completed:** 2026-02-11T10:35:00Z
- **Tasks:** 2
- **Files modified:** 2

## Accomplishments

- Extended MarginMetrics interface with openingMargin, closingMargin, and marginDelta fields
- Added opening/closing calculation from kickoff-sorted eventMargins array in useTournaments hook
- Updated MarketBreakdown component to display "X.X% → Y.Y% (±delta%)" below avgMargin
- Added DeltaDisplay component with color coding: green (improved), red (worsened), muted (stable)

## Task Commits

Each task was committed atomically:

1. **Task 1: Add opening/closing margins to MarginMetrics** - `c6e7304` (feat)
2. **Task 2: Display opening/closing margins on tournament cards** - `99510e4` (feat)

**Plan metadata:** (this commit)

## Files Created/Modified

- `web/src/features/historical-analysis/hooks/use-tournaments.ts` - Extended MarginMetrics interface, added opening/closing calculation
- `web/src/features/historical-analysis/components/tournament-list.tsx` - Added DeltaDisplay component, updated MarketBreakdown

## Decisions Made

- Delta threshold of 0.1% for color coding to avoid color flickering on tiny margin differences
- Opening/closing calculated by sorting eventMargins by kickoff and taking first/last elements

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None

## Next Phase Readiness

- Phase 85.1 complete (1/1 plans)
- Ready for Phase 86: Betpawa vs Competitor Comparison

---
*Phase: 85.1-historical-analysis-card-margins*
*Completed: 2026-02-11*
