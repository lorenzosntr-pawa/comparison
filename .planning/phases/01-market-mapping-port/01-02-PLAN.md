---
phase: 01-market-mapping-port
plan: 02
type: execute
---

<objective>
Port the 111+ market mappings registry to Python frozen Pydantic models.

Purpose: Provide the static mapping data that enables cross-platform market identification.
Output: Complete `src/market_mapping/mappings/` package with all market mappings and lookup functions.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-market-mapping-port/01-RESEARCH.md

# Prior plan summary (types must exist):
@.planning/phases/01-market-mapping-port/01-01-SUMMARY.md

# TypeScript source to port:
@mapping_markets/src/mappings/market-ids.ts

**Key patterns from research:**
- Use `tuple` for immutable sequences (not list)
- Build lookup dicts at module load time for O(1) access
- Use `frozenset` for set-based market classification
</context>

<tasks>

<task type="auto">
  <name>Task 1: Port market mappings registry</name>
  <files>src/market_mapping/mappings/__init__.py, src/market_mapping/mappings/market_ids.py</files>
  <action>
Port the entire MARKET_MAPPINGS array from TypeScript `market-ids.ts` to Python.

In `market_ids.py`:
- Import `MarketMapping`, `OutcomeMapping` from `..types.normalized`
- Define `MARKET_MAPPINGS: tuple[MarketMapping, ...]` with ALL 111+ mappings
- Each mapping is a MarketMapping instance with:
  - `canonical_id`: str (snake_case)
  - `name`: str
  - `betpawa_id`: str | None
  - `sportybet_id`: str | None
  - `bet9ja_key`: str | None
  - `outcome_mapping`: tuple[OutcomeMapping, ...]

Port ALL markets from the TypeScript file - do not skip any. The file has ~1550 lines because it includes Full Time, First Half, Second Half, Corner, Booking, and other market categories.

Use Python naming: `canonical_id` not `canonicalId`, `betpawa_id` not `betpawaId`, etc.
  </action>
  <verify>python -c "from market_mapping.mappings.market_ids import MARKET_MAPPINGS; print(f'{len(MARKET_MAPPINGS)} markets loaded')"</verify>
  <done>MARKET_MAPPINGS tuple contains 100+ market definitions matching TypeScript source</done>
</task>

<task type="auto">
  <name>Task 2: Create lookup functions and market classifications</name>
  <files>src/market_mapping/mappings/market_ids.py</files>
  <action>
Add lookup infrastructure to `market_ids.py`:

1. Build lookup dicts at module load time:
```python
_BY_BETPAWA_ID: dict[str, MarketMapping] = {}
_BY_SPORTYBET_ID: dict[str, MarketMapping] = {}
_BY_CANONICAL_ID: dict[str, MarketMapping] = {}
_BY_BET9JA_KEY: dict[str, MarketMapping] = {}

def _build_lookups() -> None:
    for mapping in MARKET_MAPPINGS:
        _BY_CANONICAL_ID[mapping.canonical_id] = mapping
        if mapping.betpawa_id:
            _BY_BETPAWA_ID[mapping.betpawa_id] = mapping
        if mapping.sportybet_id:
            _BY_SPORTYBET_ID[mapping.sportybet_id] = mapping
        if mapping.bet9ja_key:
            _BY_BET9JA_KEY[mapping.bet9ja_key] = mapping

_build_lookups()
```

2. Lookup functions:
- `find_by_betpawa_id(market_id: str) -> MarketMapping | None`
- `find_by_sportybet_id(market_id: str) -> MarketMapping | None`
- `find_by_canonical_id(canonical_id: str) -> MarketMapping | None`
- `find_by_bet9ja_key(bet9ja_key: str) -> MarketMapping | None`

3. Market classification sets (from TypeScript):
```python
OVER_UNDER_MARKET_IDS: frozenset[str] = frozenset({
    "18", "68", "90", "19", "20", ...  # All O/U market IDs
})

HANDICAP_MARKET_IDS: frozenset[str] = frozenset({
    "14", "16", "65", "66", ...  # All handicap market IDs
})

VARIANT_MARKET_IDS: frozenset[str] = frozenset({
    "21", "23", "24", ...  # Exact goals, winning margin
})
```

4. Helper functions:
- `is_over_under_market(sportybet_id: str) -> bool`
- `is_handicap_market(sportybet_id: str) -> bool`
- `is_variant_market(sportybet_id: str) -> bool`

Update `mappings/__init__.py` to export all public functions and MARKET_MAPPINGS.
  </action>
  <verify>python -c "from market_mapping.mappings import find_by_sportybet_id, OVER_UNDER_MARKET_IDS; m = find_by_sportybet_id('1'); print(f'1X2 FT: {m.name if m else None}')"</verify>
  <done>All lookup functions work, market classification sets populated, O(1) lookups verified</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `MARKET_MAPPINGS` contains 100+ markets
- [ ] `find_by_sportybet_id("1")` returns 1X2 Full Time
- [ ] `find_by_betpawa_id("3743")` returns 1X2 Full Time
- [ ] `find_by_bet9ja_key("S_1X2")` returns 1X2 Full Time
- [ ] `is_over_under_market("18")` returns True
- [ ] `is_handicap_market("14")` returns True
- [ ] All markets from TypeScript source are present
</verification>

<success_criteria>

- All 111+ market mappings ported
- Lookup functions return correct mappings
- Market classification sets match TypeScript
- Module loads without errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-market-mapping-port/01-02-SUMMARY.md`
</output>
