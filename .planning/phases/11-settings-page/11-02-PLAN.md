---
phase: 11-settings-page
plan: 02
type: execute
---

<objective>
Build the Settings page frontend with scheduler controls.

Purpose: Provide a user-friendly interface for configuring scraping behavior.
Output: Functional Settings page with interval selector, platform toggles, and pause/resume controls.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-settings-page/11-CONTEXT.md
@.planning/phases/11-settings-page/11-01-SUMMARY.md

# Key source files (read after 11-01 complete):
@web/src/lib/api.ts
@web/src/types/api.ts
@web/src/features/settings/index.tsx
@web/src/features/dashboard/hooks/use-scheduler.ts

**Tech stack available:**
- TanStack Query v5 with gcTime/staleTime patterns
- shadcn/ui components (Card, Switch, Select, Button)
- TypeScript with explicit property declarations

**Established patterns:**
- Feature hooks in features/{name}/hooks/ with index.ts re-export
- API client with fetchJson helper and typed methods
- TanStack Query: useMutation with onSuccess invalidation
- Polling intervals: 10s (scheduler status), 30s (health), 60s (events)

**From 11-CONTEXT.md:**
- Use existing shadcn components to match UI style
- Keep consistent with established design patterns
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create settings hooks and API types</name>
  <files>web/src/types/api.ts, web/src/lib/api.ts, web/src/features/settings/hooks/use-settings.ts, web/src/features/settings/hooks/use-scheduler-control.ts, web/src/features/settings/hooks/index.ts</files>
  <action>
Add TypeScript types to web/src/types/api.ts:
- SettingsResponse: { scrapeIntervalMinutes: number, enabledPlatforms: string[], updatedAt: string | null }
- SettingsUpdate: { scrapeIntervalMinutes?: number, enabledPlatforms?: string[] }
- Extend SchedulerStatus to include `paused: boolean` field

Add API methods to web/src/lib/api.ts:
- getSettings(): Promise<SettingsResponse>
- updateSettings(data: SettingsUpdate): Promise<SettingsResponse>
- pauseScheduler(): Promise<void>
- resumeScheduler(): Promise<void>

Create use-settings.ts hook:
- useSettings() query with 30s staleTime (settings don't change often)
- useUpdateSettings() mutation with invalidation of ['settings'] and ['scheduler', 'status']

Create use-scheduler-control.ts hook:
- usePauseScheduler() mutation with invalidation of ['scheduler', 'status']
- useResumeScheduler() mutation with invalidation of ['scheduler', 'status']

Create index.ts re-exporting all hooks.
  </action>
  <verify>
1. TypeScript compiles without errors: `cd web && npm run build`
2. Hooks import correctly: `import { useSettings } from '@/features/settings/hooks'`
  </verify>
  <done>
- API types defined for settings endpoints
- API client methods added for all settings/scheduler control endpoints
- useSettings query hook created
- useUpdateSettings mutation hook created
- usePauseScheduler and useResumeScheduler mutation hooks created
- All hooks re-exported from index.ts
  </done>
</task>

<task type="auto">
  <name>Task 2: Build Settings page UI</name>
  <files>web/src/features/settings/index.tsx, web/src/features/settings/components/interval-selector.tsx, web/src/features/settings/components/platform-toggles.tsx, web/src/features/settings/components/scheduler-control.tsx, web/src/features/settings/components/index.ts</files>
  <action>
Create IntervalSelector component (interval-selector.tsx):
- Use shadcn Select component
- Options: 5, 10, 15, 30 minutes
- Display current value from settings
- On change, call updateSettings mutation
- Show loading state during mutation

Create PlatformToggles component (platform-toggles.tsx):
- Use shadcn Switch components for each platform
- Platforms: SportyBet, BetPawa, Bet9ja
- Display current enabled state from settings
- On toggle, call updateSettings mutation with updated enabledPlatforms array
- Prevent disabling all platforms (at least one must remain enabled)
- Show loading state during mutation

Create SchedulerControl component (scheduler-control.tsx):
- Use existing useSchedulerStatus hook from dashboard (or import from api)
- Display scheduler status: Running / Paused with status badge
- Display next run time when running
- Pause button (disabled when already paused)
- Resume button (disabled when already running)
- Show loading states during mutations

Update Settings page (index.tsx):
- Import and compose all components
- Use shadcn Card for each section
- Sections: "Scheduler Control", "Scraping Interval", "Platform Selection"
- Add loading skeleton when settings are loading
- Add error state if settings fail to load

Install any missing shadcn components if needed (use `npx shadcn@latest add <component> --yes`).
  </action>
  <verify>
1. `cd web && npm run dev` - Settings page loads without errors
2. Navigate to /settings in browser
3. Verify interval dropdown works and persists
4. Verify platform toggles work and persist
5. Verify pause/resume buttons work correctly
6. Verify at least one platform must remain enabled
  </verify>
  <done>
- IntervalSelector shows current interval and allows changes
- PlatformToggles shows enabled platforms with working switches
- SchedulerControl shows status and pause/resume buttons
- Settings page composes all components in organized sections
- Loading and error states display appropriately
- Changes persist after page refresh
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds in web/ directory
- [ ] Settings page accessible at /settings route
- [ ] All three control sections (scheduler, interval, platforms) functional
- [ ] Settings changes persist after page refresh
- [ ] No console errors in browser
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Full scraping control available from Settings page
- Phase 11 complete
</success_criteria>

<output>
After completion, create `.planning/phases/11-settings-page/11-02-SUMMARY.md`
</output>
