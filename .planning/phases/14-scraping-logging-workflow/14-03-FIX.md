---
phase: 14-scraping-logging-workflow
plan: 14-03-FIX
type: fix
---

<objective>
Fix 1 UAT issue from plan 14-03.

Source: 14-03-ISSUES.md
Priority: 0 critical, 1 major, 0 minor
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

**Issues being fixed:**
@.planning/phases/14-scraping-logging-workflow/14-03-ISSUES.md

**Original plan for reference:**
@.planning/phases/14-scraping-logging-workflow/14-03-PLAN.md
</context>

<tasks>

<task type="auto">
  <name>Fix UAT-001: Add SSE streaming to detail page live progress</name>
  <files>
    - web/src/features/scrape-runs/detail.tsx
    - web/src/features/scrape-runs/hooks/index.ts (if hook needed)
  </files>
  <action>
The detail page's "Live Progress Panel" (lines 166-234) currently infers platform status
from polled platform_timings data only. It doesn't show real-time phase transitions
(scraping → storing → completed).

Fix by adding SSE streaming to the detail page when a scrape is running:

1. Create or reuse an SSE hook that:
   - Connects to `/api/scrape/stream` when run is active
   - Parses progress events to track per-platform phase state
   - Returns platformProgress map: { platform: { phase, eventsCount } }

2. Update detail.tsx Live Progress Panel to:
   - Use SSE-derived phase state instead of just platform_timings presence
   - Show current phase text: "Scraping...", "Storing...", "Completed"
   - Update progress bar width based on actual phase (scraping=50%, storing=80%, done=100%)

Reference the working implementation in:
- web/src/features/scrape-runs/components/live-progress.tsx (uses EventSource correctly)
- web/src/features/dashboard/components/recent-runs.tsx (has getPlatformStatuses helper)
  </action>
  <verify>
1. Start a new scrape
2. Navigate to scrape run detail page during active scrape
3. Verify phase text updates in real-time (not stuck on "Scraping...")
4. Verify progress matches dashboard widget progression
  </verify>
  <done>
- Detail page shows real-time phase transitions matching dashboard widget
- Progress text updates: "Scraping..." → "Storing..." → "Completed"
- Progress bar animates correctly through phases
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Critical issues fixed (none)
- [ ] Major issues fixed (UAT-001)
- [ ] Minor issues fixed or documented as deferred (none)
- [ ] Original acceptance criteria from issues met
</verification>

<success_criteria>
- UAT-001 addressed: Detail page shows current phase for each platform as scraping progresses
- Dashboard widget and detail page show consistent progress state
- Tests pass
- Ready for re-verification
</success_criteria>

<output>
After completion, create `.planning/phases/14-scraping-logging-workflow/14-03-FIX-SUMMARY.md`
</output>
