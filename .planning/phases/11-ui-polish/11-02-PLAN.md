---
phase: 12-ui-polish
plan: 02
type: execute
domain: react
---

<objective>
Restructure dashboard layout into three-tier design with integrated scheduler controls.

Purpose: Consolidate dashboard widgets into a cleaner, more professional layout with scheduler controls embedded in the scrape runs widget.
Output: Dashboard with top stats row, middle scrape runs section with integrated controls, and bottom compact status bar.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/12-ui-polish/12-CONTEXT.md
@.planning/phases/12-ui-polish/12-01-PLAN.md

# Key files for this plan:
@web/src/features/dashboard/index.tsx
@web/src/features/dashboard/components/recent-runs.tsx
@web/src/features/dashboard/components/status-card.tsx
@web/src/features/dashboard/components/platform-health.tsx
@web/src/features/dashboard/components/stats-cards.tsx

**Current layout (to replace):**
```
[StatsCards - 2 items]
[StatusCard: System] [StatusCard: Scheduler] [PlatformHealth]
[RecentRuns]
```

**Target layout:**
```
┌─────────────────────────────────────────────────────┐
│  [Total Events]         [Matched Events]            │  <- Top row (keep)
├─────────────────────────────────────────────────────┤
│  Recent Scrape Runs                                 │
│  ┌──────────────────────────────────────────────┐   │
│  │ [Interval: 15m] [Scheduler: Running] (header)│   │  <- Integrated controls
│  │ Run list...                                  │   │
├─────────────────────────────────────────────────────┤
│  [DB: ●] [Scheduler: ●] [BP: ●] [SB: ●] [B9: ●]    │  <- Single status bar
└─────────────────────────────────────────────────────┘
```

**Key integration:**
- Scheduler status and interval from useSchedulerStatus() hook
- Scheduler must reflect settings from DB (useSettings from settings feature)
- Remove separate StatusCard components
- Combine system health + platform health into single compact row

**Established patterns:**
- useSchedulerStatus() returns { running, paused, jobs: [{ interval_minutes }] }
- useHealth() returns { status, database, platforms: [{ platform, status }] }
- Badge component for status indicators
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create compact status bar component</name>
  <files>web/src/features/dashboard/components/status-bar.tsx, web/src/features/dashboard/components/index.ts</files>
  <action>
Create a new StatusBar component that combines all status indicators in a single horizontal row:

```tsx
// status-bar.tsx
import { Badge } from '@/components/ui/badge'
import { useHealth, useSchedulerStatus } from '../hooks'
import { cn } from '@/lib/utils'
import { Database, Clock, Loader2 } from 'lucide-react'

// Platform abbreviations
const PLATFORM_ABBREV: Record<string, string> = {
  betpawa: 'BP',
  sportybet: 'SB',
  bet9ja: 'B9',
}

// Platform colors
const PLATFORM_COLORS: Record<string, string> = {
  betpawa: 'bg-green-500',
  sportybet: 'bg-blue-500',
  bet9ja: 'bg-orange-500',
}

export function StatusBar() {
  const { data: health, isPending: healthLoading } = useHealth()
  const { data: scheduler, isPending: schedulerLoading } = useSchedulerStatus()

  const isLoading = healthLoading || schedulerLoading

  if (isLoading) {
    return (
      <div className="flex items-center justify-center py-2 px-4 bg-muted/50 rounded-lg">
        <Loader2 className="h-4 w-4 animate-spin text-muted-foreground" />
      </div>
    )
  }

  const schedulerStatus = scheduler?.paused ? 'paused' : scheduler?.running ? 'running' : 'stopped'

  return (
    <div className="flex items-center gap-4 py-2 px-4 bg-muted/50 rounded-lg text-sm">
      {/* Database status */}
      <div className="flex items-center gap-1.5">
        <Database className="h-3.5 w-3.5 text-muted-foreground" />
        <span
          className={cn(
            'h-2 w-2 rounded-full',
            health?.database === 'connected' ? 'bg-green-500' : 'bg-red-500'
          )}
        />
        <span className="text-muted-foreground">DB</span>
      </div>

      {/* Scheduler status */}
      <div className="flex items-center gap-1.5">
        <Clock className="h-3.5 w-3.5 text-muted-foreground" />
        <span
          className={cn(
            'h-2 w-2 rounded-full',
            schedulerStatus === 'running' ? 'bg-green-500' :
            schedulerStatus === 'paused' ? 'bg-yellow-500' : 'bg-gray-500'
          )}
        />
        <span className="text-muted-foreground">Scheduler</span>
      </div>

      {/* Separator */}
      <div className="h-4 w-px bg-border" />

      {/* Platform statuses */}
      {health?.platforms.map((platform) => (
        <div key={platform.platform} className="flex items-center gap-1.5">
          <span
            className={cn(
              'h-2 w-2 rounded-full',
              platform.status === 'healthy'
                ? PLATFORM_COLORS[platform.platform] || 'bg-green-500'
                : 'bg-red-500'
            )}
          />
          <span className="text-muted-foreground">
            {PLATFORM_ABBREV[platform.platform] || platform.platform.slice(0, 2).toUpperCase()}
          </span>
        </div>
      ))}
    </div>
  )
}
```

Export from index.ts.
  </action>
  <verify>Component created, no TypeScript errors</verify>
  <done>StatusBar component created with DB, scheduler, and platform status indicators</done>
</task>

<task type="auto">
  <name>Task 2: Add scheduler controls to RecentRuns header</name>
  <files>web/src/features/dashboard/components/recent-runs.tsx</files>
  <action>
Modify RecentRuns component to show scheduler interval and status in the card header:

1. Import useSettings from settings feature (need to check if hook exists and is exported)
2. In CardHeader, add a row showing:
   - Interval badge: "[clock icon] 15m" (from scheduler.jobs[0].interval_minutes)
   - Scheduler status badge: "Running" / "Paused" / "Stopped"

The header should look like:
```
Recent Scrape Runs                    [15m] [Running ●]  [View All →]
```

Implementation:
- Add useSchedulerStatus to the existing imports (already imported)
- In CardHeader, before the "View All" button, add:

```tsx
<div className="flex items-center gap-2">
  {/* Interval badge */}
  {scheduler?.jobs[0]?.interval_minutes && (
    <Badge variant="outline" className="gap-1 text-xs">
      <Clock className="h-3 w-3" />
      {scheduler.jobs[0].interval_minutes}m
    </Badge>
  )}

  {/* Scheduler status */}
  <Badge
    variant={scheduler?.paused ? 'secondary' : scheduler?.running ? 'default' : 'outline'}
    className={cn(
      'gap-1 text-xs',
      scheduler?.running && !scheduler?.paused && 'bg-green-500 hover:bg-green-600'
    )}
  >
    <span
      className={cn(
        'h-1.5 w-1.5 rounded-full',
        scheduler?.paused ? 'bg-yellow-500' :
        scheduler?.running ? 'bg-green-100' : 'bg-gray-500'
      )}
    />
    {scheduler?.paused ? 'Paused' : scheduler?.running ? 'Running' : 'Stopped'}
  </Badge>
</div>
```

Add Clock icon import from lucide-react if not present.
  </action>
  <verify>Recent Runs card header shows interval and scheduler status badges</verify>
  <done>Scheduler controls integrated into RecentRuns card header</done>
</task>

<task type="auto">
  <name>Task 3: Update Dashboard layout</name>
  <files>web/src/features/dashboard/index.tsx, web/src/features/dashboard/components/index.ts</files>
  <action>
1. Update component exports in index.ts to include StatusBar

2. Rewrite Dashboard component with new three-tier layout:

```tsx
import { StatsCards, RecentRuns, StatusBar } from './components'

export function Dashboard() {
  return (
    <div className="space-y-6">
      <div>
        <h1 className="text-2xl font-bold tracking-tight">Dashboard</h1>
        <p className="text-muted-foreground">
          System status and scraping overview
        </p>
      </div>

      {/* Top row: Quick Stats */}
      <StatsCards />

      {/* Middle section: Recent Scrape Runs (with integrated scheduler controls) */}
      <RecentRuns />

      {/* Bottom row: Compact Status Bar */}
      <StatusBar />
    </div>
  )
}
```

This removes:
- StatusCard components (System Status, Scheduler)
- PlatformHealth card
- All the hooks previously used (useHealth, useSchedulerStatus) since they're now in child components

The layout becomes cleaner with just three visual sections.
  </action>
  <verify>Dashboard shows three-tier layout: stats cards, recent runs with controls, status bar</verify>
  <done>Dashboard restructured into clean three-tier layout</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Dashboard restructure with integrated scheduler controls and compact status bar</what-built>
  <how-to-verify>
    1. Run: cd web && npm run dev
    2. Visit dashboard (/)
    3. Verify layout:
       - Top: Total Events and Matched Events cards
       - Middle: Recent Scrape Runs card with [15m] [Running ●] badges in header
       - Bottom: Compact status bar with DB, Scheduler, BP, SB, B9 indicators
    4. Check scheduler badges match actual settings:
       - Visit /settings and note the interval and scheduler state
       - Return to dashboard and verify badges match
    5. Verify all status indicators are colored correctly:
       - Green for healthy/running
       - Yellow for paused/degraded
       - Red for unhealthy/stopped/failed
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] StatusBar component shows all status indicators horizontally
- [ ] RecentRuns header shows interval and scheduler status badges
- [ ] Dashboard has three-tier layout (stats → runs → status)
- [ ] Scheduler status reflects actual scheduler state
- [ ] Platform status colors are correct
- [ ] No console errors
</verification>

<success_criteria>

- Dashboard shows clean three-tier layout
- Scheduler controls integrated in RecentRuns header
- Single compact status bar at bottom
- All status indicators work correctly
</success_criteria>

<output>
After completion, create `.planning/phases/12-ui-polish/12-02-SUMMARY.md`
</output>
